<script type="text/javascript">
    // convert to i18 text
    function c_ui_group(x) {
        return RED._("node-red-dashboard/ui_group:ui_group." + x);
    }

    RED.nodes.registerType('ui.group', {
        category: 'config',
        defaults: {
            name: { value: '' },
            tab: { type: "ui.tab", required: true },
            icon: { value: '' },
            order: { value: 0 },
            disp: { value: true },
            width: { value: 6 },
            disabled: { value: false },
            hidden: { value: false },
            maximize: { value: false },
            remove: { value: false },
            collapse: { value: false },
            datepicker: { value: false },
            header: { value: false },
            footer: { value: false },
        },
        paletteLabel: 'dashboard group',

        oneditprepare: function () {


            $('#node-config-input-name').val(this.name);
            $('#node-config-input-icon').val(this.icon);
            $('#node-config-input-width').val(this.width);

            $("#node-input-size").elementSizer({
                width: "#node-config-input-width",
                maxWidth: 12,
                maxHeight: 1,
                fixedHeight: true,
                fixedWidth: true,
                auto: false
            });




            $("#node-config-input-maximize-btn").on("click", function (e) {
                var i = $(this).find("i");
                var active = i.hasClass("fa-toggle-on");
                var newCls = "fa fa-toggle-" + (active ? "off" : "on");
                i.attr("class", newCls);
                $("#node-config-input-maximize").prop('checked', active);

                var newTxt = active ? "Off" : "On";
                $("#node-config-input-maximize-label").text(newTxt);

                var info = $("#node-config-input-maximize-info");
                var done = active ? info.show() : info.hide();
            });
            if (this.maximize) {
                $("#node-config-input-maximize-btn").click();
            }
            else {
                $("#node-config-input-maximize-label").text("On");
            }

            $("#node-config-input-remove-btn").on("click", function (e) {
                var i = $(this).find("i");
                var active = i.hasClass("fa-toggle-on");
                var newCls = "fa fa-toggle-" + (active ? "off" : "on");
                i.attr("class", newCls);
                $("#node-config-input-remove").prop('checked', active);

                var newTxt = active ? "Off" : "On";
                $("#node-config-input-remove-label").text(newTxt);

                var info = $("#node-config-input-remove-info");
                var done = active ? info.show() : info.hide();
            });
            if (this.remove) {
                $("#node-config-input-remove-btn").click();
            }
            else {
                $("#node-config-input-remove-label").text("On");
            }


            $("#node-config-input-collapse-btn").on("click", function (e) {
                var i = $(this).find("i");
                var active = i.hasClass("fa-toggle-on");
                var newCls = "fa fa-toggle-" + (active ? "off" : "on");
                i.attr("class", newCls);
                $("#node-config-input-collapse").prop('checked', active);

                var newTxt = active ? "Off" : "On";
                $("#node-config-input-collapse-label").text(newTxt);

                var info = $("#node-config-input-collapse-info");
                var done = active ? info.show() : info.hide();
            });
            if (this.collapse) {
                $("#node-config-input-collapse-btn").click();
            }
            else {
                $("#node-config-input-collapse-label").text("On");
            }


            $("#node-config-input-datepicker-btn").on("click", function (e) {
                var i = $(this).find("i");
                var active = i.hasClass("fa-toggle-on");
                var newCls = "fa fa-toggle-" + (active ? "off" : "on");
                i.attr("class", newCls);
                $("#node-config-input-datepicker").prop('checked', active);

                var newTxt = active ? "Off" : "On";
                $("#node-config-input-datepicker-label").text(newTxt);

                var info = $("#node-config-input-datepicker-info");
                var done = active ? info.show() : info.hide();
            });
            if (this.datepicker) {
                $("#node-config-input-datepicker-btn").click();
            }
            else {
                $("#node-config-input-datepicker-label").text("On");
            }


            $("#node-config-input-header-btn").on("click", function (e) {
                var i = $(this).find("i");
                var active = i.hasClass("fa-toggle-on");
                var newCls = "fa fa-toggle-" + (active ? "off" : "on");
                i.attr("class", newCls);
                $("#node-config-input-header").prop('checked', active);

                var newTxt = active ? "Off" : "On";
                $("#node-config-input-header-label").text(newTxt);

                var info = $("#node-config-input-header-info");
                var done = active ? info.show() : info.hide();
            });
            if (this.header) {
                $("#node-config-input-header-btn").click();
            }
            else {
                $("#node-config-input-header-label").text("On");
            }

            $("#node-config-input-footer-btn").on("click", function (e) {
                var i = $(this).find("i");
                var active = i.hasClass("fa-toggle-on");
                var newCls = "fa fa-toggle-" + (active ? "off" : "on");
                i.attr("class", newCls);
                $("#node-config-input-footer").prop('checked', active);

                var newTxt = active ? "Off" : "On";
                $("#node-config-input-footer-label").text(newTxt);

                var info = $("#node-config-input-footer-info");
                var done = active ? info.show() : info.hide();
            });
            if (this.footer) {
                $("#node-config-input-footer-btn").click();
            }
            else {
                $("#node-config-input-footer-label").text("On");
            }




        },
        oneditsave: function () {
            this.collapse = $("#node-config-input-collapse").prop("checked");
            this.remove = $("#node-config-input-remove").prop("checked");
            this.maximize = $("#node-config-input-maximize").prop("checked");
            this.datepicker = $("#node-config-input-datepicker").prop("checked");

            this.header = $("#node-config-input-header").prop("checked");
            this.footer = $("#node-config-input-footer").prop("checked");


            this.name = $('#node-config-input-name').val();
            this.icon = $('#node-config-input-icon').val();
            this.width = $('#node-config-input-width').val();

            var node = RED.nodes.node(this.tab)
            var node = RED.nodes.node(this.tab)
            node._def.onwsprepare.call(node);


        },
        onwsprepare: function () {
            var node = RED.nodes.node(this.tab)

            if (node._def.onwsprepare) {
                node._def.onwsprepare.call(node);
            }

            var card = $(`
                            <div class="col-md-${this.width} col-sm-${this.width / 2}">
                                <div class="card">
                                    <div class="card-header">
									    <h3 class="card-title"><i class="fas fa-globe"></i>  PLC : Production</h3>
										<div class="card-tools">
												<button type="button" class="btn btn-tool" data-card-widget="card-refresh" data-source="/pages/widgets.html" data-source-selector="#card-refresh-content"><i class="fas fa-sync-alt"></i></button> 
												${!this.maximize ? `<button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i></button>` : ''}
												${!this.collapse ? `<button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>` : ''}
												${!this.remove ? `<button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>` : ''}
										</div>
                                     </div>
                                     
                                     <div class="card-footer"></div>  
                                </div> 
                            </div> 
                        `);
            var container = $(`<div class="col-md-${this.width} col-sm-${this.width / 2}"></div>`);
            var card = $(`<div class="card">`);
            var card_header = $(`<div class="card-header">
									<h3 class="card-title"><i class="fas fa-globe"></i>  PLC : Production</h3>
										<div class="card-tools">
												<button type="button" class="btn btn-tool" data-card-widget="card-refresh" data-source="/pages/widgets.html" data-source-selector="#card-refresh-content"><i class="fas fa-sync-alt"></i></button> 
												${!this.maximize ? `<button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i></button>` : ''}
												${!this.collapse ? `<button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>` : ''}
												${!this.remove ? `<button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>` : ''}
										</div>
                                 </div>`);
            var card_footer = $(`<div class="card-footer"></div>`);

            var card_body = $(`<div class="card-body"></div>`);
            var datapicker = $(`<div class="row">
									<div class="col-md-12">
										<div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
										<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
										<span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
										</div>
									</div>
								</div>`)
            var row = $(`<div class="row"></div>`);
            RED.nodes.eachNode((nn) => {
                if (nn.group === this.id) {
                    console.log('nn :', nn);
                    if (nn._def.onwsprepare) {
                        row.append(nn._def.onwsprepare.call(nn));
                    }
                }

            })

            if (!this.datepicker) { card_body.append(datapicker); }

            card_body.append(row);



            card.append(card_header);
            card.append(card_body);
            card.append(card_footer);

            container.append(card);
            return container;
        },

    });
</script>

<script type="text/html" data-template-name="ui.group">


    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="ui_group.label.name">Name</span></label>
        <input type="text" id="node-config-input-name">
    </div>

    <div class="form-row">
        <label for="node-config-input-icon"><i class="fa fa-table"></i> <span data-i18n="ui_group.label.tab">Icon</span></label>
        <input type="text" id="node-config-input-icon">
    </div>

    <div class="form-row">
        <label for="node-config-input-width"><i class="fa fa-object-group"></i> <span data-i18n="ui_group.label.width">Width</span></label>
        <input type="hidden" id="node-config-input-width">
        <button class="editor-button" id="node-input-size"></button>
    </div>

    <hr>
    <div class="form-row">
        <label for="node-config-input-header-btn"><i class="fa fa-header"></i> <span>Header</span></label>
        <button id="node-config-input-header-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-header-label"></span></button>
        <input type="checkbox" id="node-config-input-header" style="display:none;"/>
        <span id="node-config-input-header-info" data-i18n="[html]ui_tab.info.header" style="display:none;"></span>
    </div>

    <div class="form-row">
        <label for="node-config-input-footer-btn"><i class="fa fa-footer"></i> <span>Footer</span></label>
        <button id="node-config-input-footer-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-footer-label"></span></button>
        <input type="checkbox" id="node-config-input-footer" style="display:none;"/>
        <span id="node-config-input-footer-info" data-i18n="[html]ui_tab.info.footer" style="display:none;"></span>
    </div>

    <hr>
    <div class="form-row">
        <label for="node-config-input-remove-btn"><i class="fa fa-remove"></i> <span>Remove</span></label>
        <button id="node-config-input-remove-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-remove-label"></span></button>
        <input type="checkbox" id="node-config-input-remove" style="display:none;"/>
        <span id="node-config-input-remove-info" data-i18n="[html]ui_tab.info.remove" style="display:none;"></span>
    </div>

    <div class="form-row">
        <label for="node-config-input-collapse-btn"><i class="fa fa-expand"></i> <span>Collapse</span></label>
        <button id="node-config-input-collapse-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-collapse-label"></span></button>
        <input type="checkbox" id="node-config-input-collapse" style="display:none;"/>
        <span id="node-config-input-collapse-info" data-i18n="[html]ui_tab.info.collapse" style="display:none;"></span>
    </div>

    <div class="form-row">
        <label for="node-config-input-maximize-btn"><i class="fa fa-window-maximize"></i> <span>Maximize</span></label>
        <button id="node-config-input-maximize-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-maximize-label"></span></button>
        <input type="checkbox" id="node-config-input-maximize" style="display:none;"/>
        <span id="node-config-input-maximize-info" data-i18n="[html]ui_tab.info.maximize" style="display:none;"></span>
    </div>

    <div class="form-row">
        <label for="node-config-input-datepicker-btn"><i class="fa fa-calendar"></i> <span>Date Picker</span></label>
        <button id="node-config-input-datepicker-btn" class="editor-button" style="width:100px; margin-right:6px;"><i class="fa fa-toggle-on"></i> <span id="node-config-input-datepicker-label"></span></button>
        <input type="checkbox" id="node-config-input-datepicker" style="display:none;"/>
        <span id="node-config-input-datepicker-info" data-i18n="[html]ui_tab.info.datepicker" style="display:none;"></span>
    </div>

    
    
    
</script>

<script type="text/x-red" data-help-name="ui.group">
    <p>Group</p>
</script>