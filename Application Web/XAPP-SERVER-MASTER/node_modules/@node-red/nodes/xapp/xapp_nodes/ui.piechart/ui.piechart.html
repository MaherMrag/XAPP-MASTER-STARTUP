<style>
    input.series-color {
        width: 100px;
        text-align: center;
    }

    input.series-color::-webkit-color-swatch {
        border: none;
    }
</style>
<script type="text/javascript">
    RED.nodes.registerType('ui.piechart', {
        category: 'dashboard',
        color: 'rgb(119, 198, 204)',
        autoedit: true,
        defaults: {
            name: { value: '_PeiChart' },
            order: { value: 0 },
            payload: { value: {} },
            parentid: {},
            z: {},
            datapoints: { value: {} },
            width: { value: 5 },
            height: { value: 5 },
            x: { value: 0 },
            y: { value: 0 },
            class: { value: "icon-ui-piechart" },
            startdate: { value: moment().startOf('day') },
            enddate: { value: moment().endOf('day') },
            charttheme: { value: "infographic" }, // infograpphic // macarons // roma // shine // vintage
            title: { value: "title" },
            subtitle: { value: 'subtitle' },
            title_alignvertical: { value: 'top' },
            title_alignhorizontal: { value: 'left' },
            show_title: { value: true },
            show_toolbox: { value: true },
            toolbox_alignvertical: { value: 'top' },
            toolbox_alignhorizontal: { value: 'right' },
            toolbox_orientation: { value: 'vertical' },

            show_legend: { value: true },
            legend_alignvertical: { value: 'bottom' },
            legend_alignhorizontal: { value: 'center' },
            legend_orientation: { value: 'horizontal' },


            chartType: { value: 'pie' },
            radius: { value: '20' },
            chartsize: { value: '50' },
            center_horizontal: { value: '50' },
            center_vertical: { value: '50' },
            roseType: { value: 'radius' },

            colors: { value: ['#1F77B4', '#AEC7E8', '#FF7F0E', '#2CA02C', '#98DF8A', '#D62728', '#FF9896', '#9467BD', '#C5B0D5'] },

            outputs: { value: 1 }
        },
        inputs: 1,
        outputs: 1,
        inputLabels: function () { return this.chartType; },
        outputLabels: ["chart state"],
        align: "right",
        icon: "ui_chart.png",
        paletteLabel: 'chart',
        label: function () { return this.name || (~this.label.indexOf("{{") ? null : this.label) || 'chart'; },
        labelStyle: function () { return this.name ? "node_label_italic" : ""; },
        oneditprepare: function () {
            var node = this;

            var datepicker_id = node.id.replace(".", "-");
            var container_datepicker = $('#datepicker-peichart');

            var _datapicker = $(`<button id="${datepicker_id}-peichart" type="button" class="btn btn-default float-right" style="height:34px;width:70%" >
									<i class="far fa-calendar-alt"></i> 
									<span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
								</button>`).appendTo(container_datepicker);



            node.startdate = node.startdate || moment().startOf('day');
            node.enddate = node.enddate || moment().endOf('day');

            $(`#${datepicker_id}-peichart  span`).html(moment(new Date(node.startdate)).format('MMMM D, YYYY') + ' - ' + moment(new Date(node.enddate)).format('MMMM D, YYYY'))


            $(`#${datepicker_id}-peichart`).daterangepicker(
                {
                    ranges: {
                        'Today': [moment().startOf('day'), moment().endOf('day')],
                        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                        'This Month': [moment().startOf('month'), moment().endOf('month')],
                        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    },
                    startDate: new Date(node.startdate) || moment(),
                    endDate: new Date(node.enddate) || moment(),
                    minDate: '01/01/2011',
                    maxDate: '12/31/2050',
                    dateLimit: {
                        days: 60
                    },
                    showDropdowns: true,
                    showWeekNumbers: true,
                    timePicker: true,
                    timePickerIncrement: 1,
                    timePicker24Hour: true,
                    timePicker12Hour: false,
                    opens: 'left',
                    buttonClasses: ['btn btn-default'],
                    applyClass: 'btn-small btn-primary',
                    cancelClass: 'btn-small',
                    format: 'MM/DD/YYYY',
                    separator: ' to ',
                    locale: {
                        applyLabel: 'Submit',
                        cancelLabel: 'Clear',
                        fromLabel: 'From',
                        toLabel: 'To',
                        customRangeLabel: 'Custom',
                        daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                        monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                        firstDay: 1
                    }
                },
                function (start, end) {
                    $(`#${datepicker_id}-peichart  span`).html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
                }
            )

            $(`#${datepicker_id}-peichart`).on('apply.daterangepicker', function (ev, picker) {
                $("#node-input-startdate").val(picker.startDate);
                $("#node-input-enddate").val(picker.endDate);

                node.startdate = picker.startDate;
                node.enddate = picker.endDate;

            });



            $("#node-input-size").elementSizer({
                width: "#node-input-width",
                height: "#node-input-height",
                maxWidth: 12,
                maxHeight: 7,

                fixedHeight: false,
                fixedWidth: true,
                /* maxheight :2, */
                /* auto:false, */
                /* group: "#node-input-group", */
                /* maxWidth = 12,
                maxHeight = 12,

                 */
                /* group: "#node-input-group",  */
            });


            var defaultColors = ['#1F77B4', '#AEC7E8', '#FF7F0E', '#2CA02C', '#98DF8A', '#D62728', '#FF9896', '#9467BD', '#C5B0D5'];
            var setColour = function (id, value) {
                console.log("id :", id);
                $(id).val(value);
                $(id).css("background-color", value);
                var rgb = tinycolor(value).toRgb();
                var level = ((rgb.r * 299) + (rgb.g * 587) + (rgb.b * 114)) / 1000;
                var textColor = (level >= 128) ? '#111111' : '#eeeeee';
                $(id).css("color", textColor);
            }




            var i = 0;
            var container = $('#series-items');
            for (id in this.datapoints) {

                if (node.datapoints.hasOwnProperty(id)) {
                    /* var data = node.payload[id]; */
                    i++;
                    var item = $(`<div class="form-row" id="${id}" style="margin-bottom: 5px;" ></div>`);
                    var label = $(`<label for="node-input-removeOlder">Serie 0${i} : </label>`);
                    var name = $(`<select id="node-input-removeOlderUnit" disabled style="width:40%;">
                        <option value=${node.datapoints[id].id}>${node.datapoints[id].name}</option>
                        </select>`);
                    var color = $(`<input type="color" id="node-input-color0${i}" class="series-color" style="margin-left:5px; margin-right:5px; width:100px;"/>`).val('#2CA02C');//node.payload[id].color);

                    item.append(label);
                    item.append(name);
                    item.append(color);

                    container.append(item);


                    if (node.datapoints[id].color) {
                        setColour("#node-input-color0" + i, node.datapoints[id].color);
                    }
                    else {
                        setColour("#node-input-color0" + i, defaultColors[i]);
                    }
                }
            }



            $(".series-color").on("change", function () {
                setColour("#" + $(this).attr("id"), $(this).val());
            });
        },
        oneditsave: function () {
            var nn = this;


            nn.datapoints = {};
            var id, name, color;
            $('#series-items').children().each((index, items) => {
                $(items).children().each((i, item) => {
                    switch (i) {
                        case 1: id = $(item).val(); name = $(item).text().trim();
                        case 2: color = $(item).val();
                    }
                })
                nn.datapoints[id] = { id: id, name: name, color: color };
            });

            nn.subtitle = moment(new Date(nn.startdate)).format('MMMM D, YYYY') + ' - ' + moment(new Date(nn.enddate)).format('MMMM D, YYYY');

            setTimeout(nn._def.oncomponentload.call(nn), 100);

        },
        onwsprepare: function () {
            var container = $(`
                            <div class="col-md-${this.width} col-sm-${this.width / 2}">

                            </div> 
                        `);

            /* var chart = $(`<div id="echart_pie" style="min-height: 300px; height: 100%;  max-width: 100%;"></div>`); */
            var chart = $(`<canvas id="donutChart1" style="min-height: 250px; height: 100%; max-height: 100%; max-width: 100%;"></canvas>`);
            container.append(chart);


            return container;
        },
        oncomponentload: function () {
            var nn = this;
            var item_id = nn.id.replace(".", "-");
            var pNode = RED.nodes.node(nn.parentid)
            var startdate, enddate;

            if (pNode) {
                startdate = (pNode.startdate) ? moment(new Date(pNode.startdate)) : moment().startOf('day').toString();
                enddate = (pNode.enddate) ? moment(new Date(pNode.enddate)) : moment().endOf('day').toString();
            } else {
                startdate = moment().startOf('day').toString();
                enddate = moment().endOf('day').toString();
            }

            startdate = nn.startdate || moment().startOf('day').toString();
            enddate = nn.enddate || moment().endOf('day').toString();


            var datapoints = nn.datapoints;

            var gridstack_item_content = $(`#${item_id}-item-content`);
            gridstack_item_content.empty();



            var box_item = $(`<div id='${item_id}-info-box'class="info-box">`).on("dblclick", function () {
                RED.editor.edit(nn);
                var n = XAPP.treelist.tree().getNodesByParam('id', nn.id)
                XAPP.treelist.tree().selectNode(n[0])


            }).appendTo(gridstack_item_content);
            var component_content = $(`<div class="info-box-content">`).appendTo(box_item);

            var chart_component = `<div id='${item_id}-chart' style='height: 100%;width: 100%; '></div>`


            function show_spinner() {
                component_content.empty();
                var spinner = $(`<div id ='${item_id}-spinner'  class='tp-spinner'>
                                            <span class='tb-spinner tb-spinner-is-centered'> </span>
                                        </div>`).appendTo(component_content)
            }

            function load_data() {
                var date = { startdate: startdate, enddate: enddate }
                var data = { date: date, datapoints: datapoints }
                show_spinner();


                $.ajax({
                    method: 'POST',
                    contentType: 'application/json',
                    url: "peichart/" + nn.id,
                    data: JSON.stringify(data),
                    success: function (data) {
                        console.log('RESPONSE :', data)
                        init(data)

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("Unexpected error saving user settings:", jqXHR.status, textStatus);
                    }
                });
            }

            function init(data) {
                var theme = {
                    color: [
                        '#26B99A', '#34495E', '#BDC3C7', '#3498DB',
                        '#9B59B6', '#8abb6f', '#759c6a', '#bfd3b7'
                    ],



                    title: {
                        text: nn.label,
                        itemGap: 8,
                        textStyle: {
                            fontWeight: 'normal',
                            color: '#408829'
                        }
                    },

                    dataRange: {
                        color: ['#1f610a', '#97b58d']
                    },

                    toolbox: {
                        color: ['#408829', '#408829', '#408829', '#408829']
                    },

                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.5)',
                        axisPointer: {
                            type: 'line',
                            lineStyle: {
                                color: '#408829',
                                type: 'dashed'
                            },
                            crossStyle: {
                                color: '#408829'
                            },
                            shadowStyle: {
                                color: 'rgba(200,200,200,0.3)'
                            }
                        }
                    },

                    dataZoom: {
                        dataBackgroundColor: '#eee',
                        fillerColor: 'rgba(64,136,41,0.2)',
                        handleColor: '#408829'
                    },
                    grid: {
                        borderWidth: 1
                    },

                    categoryAxis: {
                        axisLine: {
                            lineStyle: {
                                color: '#408829'
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: ['#eee']
                            }
                        }
                    },

                    valueAxis: {
                        axisLine: {
                            lineStyle: {
                                color: '#408829'
                            }
                        },
                        splitArea: {
                            show: true,
                            areaStyle: {
                                color: ['rgba(250,250,250,0.1)', 'rgba(200,200,200,0.1)']
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: ['#eee']
                            }
                        }
                    },
                    timeline: {
                        lineStyle: {
                            color: '#408829'
                        },
                        controlStyle: {
                            normal: { color: '#408829' },
                            emphasis: { color: '#408829' }
                        }
                    },

                    k: {
                        itemStyle: {
                            normal: {
                                color: '#68a54a',
                                color0: '#a9cba2',
                                lineStyle: {
                                    width: 1,
                                    color: '#408829',
                                    color0: '#86b379'
                                }
                            }
                        }
                    },
                    map: {
                        itemStyle: {
                            normal: {
                                areaStyle: {
                                    color: '#ddd'
                                },
                                label: {
                                    textStyle: {
                                        color: '#c12e34'
                                    }
                                }
                            },
                            emphasis: {
                                areaStyle: {
                                    color: '#99d2dd'
                                },
                                label: {
                                    textStyle: {
                                        color: '#c12e34'
                                    }
                                }
                            }
                        }
                    },
                    force: {
                        itemStyle: {
                            normal: {
                                linkStyle: {
                                    strokeColor: '#408829'
                                }
                            }
                        }
                    },
                    chord: {
                        padding: 4,
                        itemStyle: {
                            normal: {
                                lineStyle: {
                                    width: 1,
                                    color: 'rgba(128, 128, 128, 0.5)'
                                },
                                chordStyle: {
                                    lineStyle: {
                                        width: 1,
                                        color: 'rgba(128, 128, 128, 0.5)'
                                    }
                                }
                            },
                            emphasis: {
                                lineStyle: {
                                    width: 1,
                                    color: 'rgba(128, 128, 128, 0.5)'
                                },
                                chordStyle: {
                                    lineStyle: {
                                        width: 1,
                                        color: 'rgba(128, 128, 128, 0.5)'
                                    }
                                }
                            }
                        }
                    },
                    gauge: {
                        startAngle: 225,
                        endAngle: -45,
                        axisLine: {
                            show: true,
                            lineStyle: {
                                color: [[0.2, '#86b379'], [0.8, '#68a54a'], [1, '#408829']],
                                width: 8
                            }
                        },
                        axisTick: {
                            splitNumber: 10,
                            length: 12,
                            lineStyle: {
                                color: 'auto'
                            }
                        },
                        axisLabel: {
                            textStyle: {
                                color: 'auto'
                            }
                        },
                        splitLine: {
                            length: 18,
                            lineStyle: {
                                color: 'auto'
                            }
                        },
                        pointer: {
                            length: '90%',
                            color: 'auto'
                        },
                        title: {
                            textStyle: {
                                color: '#333'
                            }
                        },
                        detail: {
                            textStyle: {
                                color: 'auto'
                            }
                        }
                    },
                    textStyle: {
                        fontFamily: 'Arial, Verdana, sans-serif'
                    }
                };
                component_content.empty();
                component_content.append(chart_component);
                if (chart_component.length) {
                    var charttheme = nn.charttheme === 'default' ? theme : nn.charttheme;
                    nn.echartPieCollapse = echarts.init(document.getElementById(`${item_id}-chart`), charttheme);

                    nn.subtitle = moment(new Date(nn.startdate)).format('MMMM D, YYYY') + ' - ' + moment(new Date(nn.enddate)).format('MMMM D, YYYY');
                    nn.options = {
                        title: {
                            show: nn.show_title,
                            text: nn.title,
                            subtext: nn.subtitle,
                            left: nn.title_alignhorizontal,
                            top: nn.title_alignvertical,
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            show: nn.show_legend,
                            orient: nn.legend_orientation,
                            left: nn.legend_alignhorizontal,
                            top: nn.legend_alignvertical,
                            data: data.legend
                        },
                        toolbox: {
                            show: nn.show_toolbox,
                            orient: nn.toolbox_orientation,
                            left: nn.toolbox_alignhorizontal,
                            top: nn.toolbox_alignvertical,
                            feature: {
                                mark: { show: false },
                                dataView: { show: false, readOnly: false },
                                magicType: {
                                    show: true,
                                    type: ['pie', 'funnel']
                                },
                                restore: {
                                    show: true,
                                    title: "Restore"
                                },
                                saveAsImage: {
                                    show: true,
                                    title: "Save Image"
                                }
                            }
                        },
                        calculable: true,
                        series: [{
                            name: 'Area Mode',
                            type: nn.chartType,
                            radius: [nn.radius + '%', nn.chartsize + '%'],
                            center: [nn.center_horizontal + '%', nn.center_vertical + '%'],
                            roseType: nn.roseType === 'none' ? 0 : nn.roseType,
                            sort: 'ascending',
                            data: []
                        }]
                    }


                    //legent properties :
                    //x : center
                    //y : bottom
                    //orient : center vertical
                    //left : 10
                    nn.options.series[0].data.push(...data.datasets.data);

                    /*  theme.color = data.datasets.backgroundColor; */
                    /* options.legend = data.legend;
                    options.series[0].data = data.datasets.data; */

                    nn.echartPieCollapse.setOption(nn.options);

                    var timeout;
                    gridstack_item_content.parent().on("resize",  () => {
                        clearTimeout(timeout);
                        timeout = setTimeout(()=>{
                            nn.echartPieCollapse.resize()
                        }, 100);
                    });

                }
            }
            load_data();
        },
        onredrawnode: function () {
            var nn = this;
            var item_id = nn.id.replace('.', '-');


        }
    });
</script>

<script type="text/html" data-template-name="ui.piechart">
    <style>
        .red-ui-editor .stack  input[type="text"] {
             width: 100%;
             height: auto;
             border: none;
             margin: 0;
             padding: 0;
         }
 
         .red-ui-editor .stack  input[type="checkbox"] {
             height: auto;
             border: none;
             margin: 0;
             padding: 0;
         }
 
         .red-ui-editor .stack  select { 
             width: 100%;
             height: auto;
             border: 0;
             padding: 0;
             margin: 0;
         }
 
         .red-ui-editor .stack  table.red-ui-info-table tr:not(.blank) td:first-child {
     color: #444;
     vertical-align: top;
     width: 207px;
     padding: 3px 3px 3px 6px;
     background: #f7f7f7;
     border-right: 1px solid #ddd;
 }
 
         .red-ui-editor .stack table.red-ui-info-table tr:not(.blank) { border: 1px solid #ddd; }
 
     </style>
    <div class="form-row" id="datepicker-peichart">
		<label for="node-config-input-icon"><i class="far fa-calendar-alt"></i> Date range</label>
		<input type="hidden" id="node-input-startdate">
		<input type="hidden" id="node-input-enddate">
	</div>
    <hr>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name">
    </div>




    <div class="form-row">
        <label><i class="fa fa-object-group"></i> Size</label>
        <input type="hidden" id="node-input-width">
        <input type="hidden" id="node-input-height">
        <button class="editor-button" id="node-input-size"></button>
    </div>



    <hr> 

    <div class="stack">
        <table class="red-ui-info-table">
            <tbody>
                <tr class="red-ui-help-info-row">
                    <td colspan="2">Chart</td>
    
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Theme</td>
                    <td>
                        <select id="node-input-charttheme">
                            <option value="default">default</option>
                            <option value="infographic">infographic</option>
                            <option value="macarons">macarons</option>
                            <option value="roma">roma</option>
                            <option value="shine">shine</option>
                            <option value="vintage">vintage</option>
                        </select>
                    </td>
                </tr>

                <tr class="red-ui-help-info-row">
                    <td>Type</td>
                    <td>
                        <select id="node-input-chartType">
                            <option value="pie">Pie Chart</option>
                            <option value="funnel">Funnel</option>
                        </select>
                    </td>
                </tr>

                <tr class="red-ui-help-info-row">
                    <td>Roze Type</td>
                    <td>
                        <select id="node-input-roseType">
                            <option value="none">none</option>
                            <option value="radius">radius</option>
                            <option value="area">area</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>size</td>
                    <td>
                        <input type="text" id="node-input-chartsize"/>
                    </td>
                </tr>

                <tr class="red-ui-help-info-row">
                    <td>radius</td>
                    <td>
                        <input type="text" id="node-input-radius"/>
                    </td>
                </tr>

                <tr class="red-ui-help-info-row">
                    <td colspan="2">Position</td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Horizontal</td>
                    <td>
                        <input type="text" id="node-input-center_horizontal"/>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Vertical</td>
                    <td>
                        <input type="text" id="node-input-center_vertical"/>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td colspan="2">Title</td>

                </tr>
                <tr class="red-ui-help-info-row">
                    <td>show</td>
                    <td><input type="checkbox" id="node-input-show_title"/></td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Title</td>
                    <td><input type="text" id="node-input-title" placeholder="title"/></td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Sub title</td>
                    <td><input type="text" id="node-input-subtitle" placeholder="Sub title" /></td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Alignement vertical</td>
                    <td>
                        <select id="node-input-title_alignvertical">
                          <option value="top">top</option>
                          <option value="center">center</option>
                          <option value="bottom">bottom</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Alignement horizontal</td>
                    <td>
                        <select id="node-input-title_alignhorizontal">
                            <option value="left">left</option>
                            <option value="right">right</option>
                            <option value="center">center</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td colspan="2">Toolbox</td>
    
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Show</td>
                    <td><input type="checkbox" id="node-input-show_toolbox" /></td>
                </tr>

                <tr class="red-ui-help-info-row">
                    <td>Alignement vertical</td>
                    <td>
                    <select id="node-input-toolbox_alignvertical">
                        <option value="top">top</option>
                        <option value="center">center</option>
                        <option value="bottom">bottom</option>
                    </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Alignement horizontal</td>
                    <td>
                        <select id="node-input-toolbox_alignhorizontal">
                            <option value="left">left</option>
                            <option value="right">right</option>
                            <option value="center">center</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Orientation</td>
                    <td>
                        <select id="node-input-toolbox_orientation">
                            <option value="horizontal">horizontal</option>
                            <option value="vertical">vertical</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td colspan="2">Legend</td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Show</td>
                    <td>
                        <input type="checkbox" id="node-input-show_legend"/>
                    </td>
                    
                </tr>
                  <tr class="red-ui-help-info-row">
                    <td>Alignement vertical</td>
                    <td>
                        <select id="node-input-legend_alignvertical">
                            <option value="top">top</option>
                            <option value="center">center</option>
                            <option value="bottom">bottom</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Alignement horizontal</td>
                    <td>
                        <select id="node-input-legend_alignhorizontal">
                            <option value="left">left</option>
                            <option value="center">center</option>
                            <option value="right">right</option>
                        </select>
                    </td>
                </tr>
                <tr class="red-ui-help-info-row">
                    <td>Orientation</td>
                    <td>
                        <select id="node-input-legend_orientation">
                            <option value="horizontal">horizontal</option>
                            <option value="vertical">vertical</option>
                        </select>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>

    <div>Series Items : </div>
    <div class="form-row" id="series-items"></div>





</script>

<script type="text/x-red" data-help-name="ui.piechart">
    <p>Plots the input values on a chart. This can either be a time based line chart, a bar chart (vertical or horizontal),
    or a pie chart.</p>
    <p>Each input <code>msg.payload</code> value will be converted to a number. If the
    conversion fails, the message is ignored.</p>
    <p>Minimum and Maximum <b>Y</b> axis values are optional. The graph will auto-scale to any values received.</p>
    <p>Multiple series can be shown on the same chart by using a different <code>msg.topic</code>
    value on each input message. Multiple bars of the same series can be shown by using the <code>msg.label</code> property.</p>
    <p>The <b>X</b> axis defines a time window or a maximum number of points to display. Older data will be automatically removed from the graph.
    The axis labels can be formatted using a <a href="https://momentjs.com/docs/#/displaying/format/" target="_blank">
    Moment.js time formatted</a> string.</p>
    <p>Inputting a <code>msg.payload</code> containing a blank array <code>[]</code> will clear the chart.</p>
    <p>See <b><a href="https://github.com/node-red/node-red-dashboard/blob/master/Charts.md" target="_new">this information</a></b>
    for how to pre-format data to be passed in as a complete chart.</p>
    <p>The <b>Blank label</b> field can be used to display some text before any valid data is received.</p>
    <p>The label can also be set by a message property by setting
    the field to the name of the property, for example <code>{{msg.topic}}</code>.</p>
    <p>The node output contains an array of the chart state that can be persisted if needed. This can be passed
    into the chart node to re-display the persisted data.</p>
</script>