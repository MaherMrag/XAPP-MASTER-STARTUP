var XAPP=function(){var e=!1;var t={init:function(){var e=$('<div id="red-ui-loading-progress"></div>').hide(),t=$("<div>").appendTo(e),n=($("<div>",{class:"red-ui-loading-bar-label"}).appendTo(t),$("<div>",{class:"red-ui-loading-bar"}).appendTo(t));$("<span>").appendTo(n);return e},start:function(e,n){e&&t.reportProgress(e,n),$("#red-ui-loading-progress").show()},reportProgress:function(e,t){$(".red-ui-loading-bar-label").text(e),$(".red-ui-loading-bar span").width(t+"%")},end:function(){$("#red-ui-loading-progress").hide(),t.reportProgress("",0)}};return{init:function(t){if(e)throw new Error("XAPP already initialised");e=!0,e=!0,ace.require("ace/ext/language_tools"),(t=t||{}).apiRootUrl=t.apiRootUrl||"",t.apiRootUrl&&!/\/$/.test(t.apiRootUrl)&&(t.apiRootUrl=t.apiRootUrl+"/"),t.target=$("#red-ui-editor"),console.log("XAPP navbar init"),XAPP.navbar.init(t),console.log("XAPP toolbar init"),XAPP.toolbar.init(t),console.log("XAPP status init"),XAPP.status.init(t),console.log("XAPP dialog init"),XAPP.dialog.init(),console.log("XAPP treelist init"),XAPP.treelist.init(),console.log("XAPP menu init"),XAPP.menu.init()},loader:t}}();XAPP.events=function(){var e={};return{on:function(t,n){e[t]=e[t]||[],e[t].push(n)},off:function(t,n){var o=e[t];if(o)for(var a=0;a<o.length;a++)if(o[a]===n)return void o.splice(a,1)},emit:function(){var t=arguments[0],n=Array.prototype.slice.call(arguments,1);if(RED.events.DEBUG&&console.warn(t,n),e[t])for(var o=0;o<e[t].length;o++)try{e[t][o].apply(null,n)}catch(e){console.warn("RED.events.emit error: ["+t+"] "+e.toString()),console.warn(e)}}}}(),XAPP.actions=function(){var e={};return{add:function(t,n){e[t]=n},remove:function(t){delete e[t]},get:function(t){return e[t]},invoke:function(t,n){e.hasOwnProperty(t)&&e[t](n)},list:function(){var t=[];return Object.keys(e).forEach((function(e){var n=RED.keyboard.getShortcut(e),o=!1;o=n?n.user:!!RED.keyboard.getUserShortcut(e),t.push({id:e,scope:n?n.scope:void 0,key:n?n.key:void 0,user:o})})),t}}}(),XAPP.utils=function(){function e(e,t){let n="";switch(e.S7_Datatype){case"X":n="X";break;case"B":case"uint8":n=t&&"DB"===t?"BYTE":"B";break;case"W":case"uint16":n=t&&"DB"===t?"WORD":"W";break;case"D":case"uint32":n=t&&"DB"===t?"DWORD":"D";break;case"I":case"int16":n=t&&"DB"===t?"INT":"I";break;case"DI":case"int32":n=t&&"DB"===t?"DINT":"DI";break;case"CHAR":n=t&&"DB"===t?"CHAR":"C";break;case"STRING":n=t&&"DB"===t?"STRING":"S";break;case"R":n=t&&"DB"===t?"REAL":"R";break;case"TIMER":n="TIMER";break;case"COUNTER":n="COUNTER";break;default:n=void 0}return n}return{wrapData:function(t,n){let o=t;switch(t.S7_Type){case"I":case"Q":case"M":case"PI":case"PQ":"X"===t.S7_Datatype?o=t.S7_Type+t.S7_Offset+"."+t.S7_BitOffset:"CHAR"===t.S7_Datatype?o=t.S7_Type+e(t)+t.S7_Offset:t.S7_Quantity>1?o="path"===n?t.S7_Type+e(t)+t.S7_Offset+".."+(t.S7_Quantity-1):"data"===n?t.S7_Type+e(t)+t.S7_Offset+"."+t.S7_Quantity:null:(console.log("else"),o=t.S7_Type+e(t)+t.S7_Offset);break;case"DB":o="X"===t.S7_Datatype?t.S7_Type+t.S7_DBnum+"."+e(t,"DB")+t.S7_Offset+"."+t.S7_BitOffset:"CHAR"===t.S7_Datatype?t.S7_Type+t.S7_DBnum+"."+e(t,"DB")+t.S7_Offset:t.S7_Quantity>1?"path"===n?t.S7_Type+t.S7_DBnum+"."+e(t,"DB")+t.S7_Offset+".."+(t.S7_Quantity-1):"data"===n?t.S7_Type+t.S7_DBnum+"."+e(t,"DB")+t.S7_Offset+"."+t.S7_Quantity:null:t.S7_Type+t.S7_DBnum+"."+e(t,"DB")+t.S7_Offset;break;case"T":case"C":o=t.S7_Type+t.S7_Offset;break;default:o=null}return o}}}(),XAPP.nodes=function(){},XAPP.treelist=function(){var e,t,n={},o={saveSettings:()=>{var e=RED.trees.tree.getZTreeObj("tree").getNodes();RED.settings.set("treeNodes",e)},getWorkspaceId:()=>RED.nodes.defaultWorkspace(),getParentId:(e,t)=>{for(;e.type!==t;)e=n.getNodeByTId(e.parentTId);return e.id},getRoot:e=>{for(;1!==e.level;)e=n.getNodeByTId(e.parentTId);return e},getConnectionId:()=>{for(var e=n.getSelectedNode();"s7.config"!==e.type;)e=n.getNodeByTId(e.parentTId);return e.id},getDataBaseId:()=>{for(var e=n.getSelectedNode();"s7.db"!==e.type;)e=n.getNodeByTId(e.parentTId);return e.id},getSelectedNodeId:()=>{var e=n.getSelectedNode();if(e)return e.id},addstatemachine:()=>{var e={};e.id=RED.nodes.id(),e.type="s7.statemachine",e.name="state_"+e.id.substring(1,5),e.class="icon-statemachine",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.payload={},e.states={},e.datapoints={},e.x=0,e.y=0,e.width=5,e.height=5,o.addNode(e)},addNode:function(e){for(var t in XAPP.menu.hide(),e._def=RED.nodes.getType(e.type),console.log("nn._def :",e._def),e._def.defaults)e._def.defaults.hasOwnProperty(t)&&void 0!==e._def.defaults[t].value&&(e[t]=JSON.parse(JSON.stringify(e._def.defaults[t].value)));if(e._def.onadd)try{e._def.onadd.call(e)}catch(t){console.log("Definition error: "+e.type+".onadd:",t)}console.log("nn added :",e),n.addNodes(n.getSelectedNodes()[0],e),RED.nodes.add(e),RED.nodes.dirty(!0),e._def.autoedit&&RED.editor.edit(e)},addBatch:()=>{var e={};e.id=RED.nodes.id(),e.type="s7.batch",e.name="batch_"+e.id.substring(1,5),e.class="icon-ui-datapoint",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),o.addNode(e)},addAlarm:()=>{var e={};e.id=RED.nodes.id(),e.name="al_"+e.id.substring(1,5),e.type="s7.alarm",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.class="icon-alarm",e.payload={},e.x=0,e.y=0,o.addNode(e)},addStatus:()=>{var e={};e.id=RED.nodes.id(),e.name="st_"+e.id.substring(1,5),e.type="s7.status",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.class="icon-alarm",e.payload={},e.x=0,e.y=0,o.addNode(e)},addPhase:()=>{var e={};e.id=RED.nodes.id(),e.name="ph_"+e.id.substring(1,5),e.type="s7.phase",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.class="icon-alarm",e.payload={},e.x=0,e.y=0,o.addNode(e)},addTrend:()=>{var e={};e.id=RED.nodes.id(),e.name="ph_"+e.id.substring(1,5),e.type="s7.trend",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.class="icon-alarm",e.datapoints={},e.x=0,e.y=0,o.addNode(e)},addConnection:()=>{var e={};e.id=RED.nodes.id(),e.type="s7.config",e.name="con_"+e.id.substring(1,5),e.class="icon-connection",e.payload={},e.users=[],o.addNode(e)},addTag:()=>{var e={};e.id=RED.nodes.id(),e.type="s7.io",e.group=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.connection=o.getConnectionId(),e.name="tag_"+e.id.substring(1,5),e.topic="",e.class="icon-tag",e.x=0,e.y=0,o.addNode(e)},addGroup:()=>{var e={};e.id=RED.nodes.id(),e.name="gr_"+e.id.substring(1,5),e.z=o.getWorkspaceId(),e.type="s7.group",e.class="icon-group",e.users=[],e.connection=o.getConnectionId(),o.addNode(e)},addrpreport:()=>{var e={};e.id=RED.nodes.id(),e.type="rp.report",e.name="rp_"+e.id.substring(1,5),e.tab=o.getSelectedNodeId(),e.class="icon-ui-group",e.users=[],o.addNode(e)},addrpwidget:()=>{var e={};e.id=RED.nodes.id(),e.type="rp.widget",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="wd_"+e.id.substring(1,5),e.class="icon-ui-chart",e.width=1,e.height=1,e.x=0,e.y=0,o.addNode(e)},addrptemplate:()=>{var e={};e.id=RED.nodes.id(),e.type="rp.template",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="wd_"+e.id.substring(1,5),e.class="icon-ui-chart",e.width=1,e.height=1,e.x=0,e.y=0,o.addNode(e)},addrpchart:()=>{var e={};e.id=RED.nodes.id(),e.type="rp.chart",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="wd_"+e.id.substring(1,5),e.class="icon-ui-chart",e.width=1,e.height=1,e.x=0,e.y=0,o.addNode(e)},adduigroup:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.group",e.name="gr_"+e.id.substring(1,5),e.tab=o.getSelectedNodeId(),e.class="icon-ui-group",e.users=[],o.addNode(e)},adduitab:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.tab",e.order=1,e.name="tab_"+e.id.substring(1,5),e.class="icon-ui-tab",e.users=[],o.addNode(e)},adduipiechart:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.piechart",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="pie_"+e.id.substring(1,5),e.datapoints={},o.addNode(e)},adduispark:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.spark",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),o.addNode(e)},adduiprogressbox:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.progressBox",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="ProgBox_"+e.id.substring(1,5),e.class="icon-ui-progressbox",e.datapoints={},e.x="0",e.y="0",e.width="5",e.height="5",o.addNode(e)},adduiprogressbar:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.progressBar",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="ProgBar_"+e.id.substring(1,5),e.class="icon-ui-progressbar",e.datapoints={},e.x="0",e.y="0",e.width="5",e.height="5",o.addNode(e)},adduiinfobox:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.infoBox",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="info_"+e.id.substring(1,5),e.class="icon-ui-infobox",e.datapoints={},e.x="0",e.y="0",e.width="5",e.height="5",o.addNode(e)},adduiinline:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.inline",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="inline_"+e.id.substring(1,5),e.class="icon-ui-inline",e.datapoints={},e.x="0",e.y="0",e.width="5",e.height="5",o.addNode(e)},adduigauge:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.gauge",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="gauge_"+e.id.substring(1,5),o.addNode(e)},adduibarchart:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.barchart",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.datapoints={},o.addNode(e)},adduitemplate:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.template",e.parentid=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="bar_"+e.id.substring(1,5),e.class="icon-file",o.addNode(e)},adddatabase:()=>{var e={};e.id=RED.nodes.id(),e.type="s7.db",e.name="db_"+e.id.substring(1,5),e.class="icon-database",e.payload={},e.users=[],o.addNode(e)},addcollection:()=>{var e={};e.id=RED.nodes.id(),e.type="s7.db.in",e.z=o.getWorkspaceId(),e.configNode=o.getDataBaseId(),e.name="coll_"+e.id.substring(1,5),e.class="icon-collection",e.x=0,e.y=0,o.addNode(e)},addmobile:()=>{var e={};e.id=RED.nodes.id(),e.type="m.mmobile",e.group=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="mob_"+e.id.substring(1,5),e.class="icon-mobile",e.payload={},e.x=0,e.y=0,o.addNode(e)},addmwidget:()=>{var e={};e.id=RED.nodes.id(),e.type="m.widget",e.group=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="wid_"+e.id.substring(1,5),e.class="icon-mwidget",e.payload={},e.x=0,e.y=0,o.addNode(e)},addmpiechart:()=>{var e={};e.id=RED.nodes.id(),e.type="m.piechart",e.group=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="pie_"+e.id.substring(1,5),e.class="icon-ui-piechart",e.payload={},e.x=0,e.y=0,o.addNode(e)},addmbarchart:()=>{var e={};e.id=RED.nodes.id(),e.type="m.barchart",e.group=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="bar_"+e.id.substring(1,5),e.class="icon-ui-barchart",e.payload={},e.x=0,e.y=0,o.addNode(e)},adddatapoint:()=>{var e={};e.id=RED.nodes.id(),e.type="ui.datapoint",e.parent=o.getSelectedNodeId(),e.group=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.name="data_"+e.id.substring(1,5),e.payload={},e.class="icon-ui-datapoint",e.x=0,e.y=0,console.log("Tag :",e),o.addNode(e)},addcalculator:()=>{var e={};e.id=RED.nodes.id(),e.parent=o.getSelectedNodeId(),e.type="s7.calculator",e.group=o.getSelectedNodeId(),e.parentId=o.getSelectedNodeId(),e.z=o.getWorkspaceId(),e.payload={},e.name="calc_"+e.id.substring(1,5),e.class="icon-calculator",e.x=0,e.y=0,o.addNode(e)},importNodes:()=>{XAPP.menu.hide(),XAPP.dialog.import(n)},exportNodes:()=>{XAPP.menu.hide(),XAPP.dialog.export(n)},addTagLogging:()=>!1,linknodes:()=>{var e=RED.nodes.node(n.getSelectedNodes()[0].id),t=RED.nodes.node(n.getSelectedNodes()[0].children[0].id);if(!(0!==RED.nodes.filterLinks({source:e,target:t,sourcePort:0}).length)){console.log("source :",e.id),console.log("target :",t.id);var o={source:e,sourcePort:0,target:t};RED.nodes.addLink(o),[].push(o),RED.nodes.dirty(!0)}},replace:()=>!1,cut:()=>{XAPP.menu.hide();var e=n.getSelectedNodes(),t=RED.nodes.node(e[0].pId),o=e[0].id;if(t.datapoints&&delete t.datapoints[o],e&&e.length>0){var a=e[0];n.removeNode(a)}RED.nodes.dirty(!0)},fontCss:n=>{var o=$("#"+n.tId+"_a");o.removeClass("copy").removeClass("cut"),n===e&&o.addClass(t)},setCurSrcNode:t=>{if(e){delete e.isCur;var a=e;e=null,o.fontCss(a)}e=t,t&&(e.isCur=!0,n.cancelSelectedNode(),o.fontCss(e))},copy:e=>{XAPP.menu.hide();var a=n.getSelectedNodes();if(0!=a.length)t="copy",o.setCurSrcNode(a[0]);else var i=RED.notify("Please select one node at first...",{modal:!0,fixed:!0,buttons:[{text:"Cancel",click:function(){i.close(),i=null}}]})},paste:t=>{if(XAPP.menu.hide(),e){var a=n.getSelectedNodes(),i=a.length>0?a[0]:null,d=RED.nodes.node(a[0].id);if(d)if(d.datapoints[e.id])s="Copy failed, the target node already contains this node....",l=RED.notify(s,{modal:!0,fixed:!0,buttons:[{text:"Cancel",click:function(){l.close(),l=null}}]});else{(i=n.copyNode(i,e,"inner")).isCopy=!0,o.setCurSrcNode(),delete i.isCur,n.selectNode(i);var r=RED.nodes.node(i.id);d.datapoints[r.id]={id:r.id,name:r.name,color:r.color},RED.nodes.dirty(!0)}}else var s="Please select one node to copy or cut at first...",l=RED.notify(s,{modal:!0,fixed:!0,buttons:[{text:"Cancel",click:function(){l.close(),l=null}}]})},refresh:()=>{XAPP.menu.hide();var e=n.getSelectedNodes()[0].id,t=RED.nodes.node(e);if(t&&t._def.onwsprepare)try{t._def.onwsprepare.call(t)}catch(e){console.log("onwsprepare",t.id,t.type,e.toString())}},remove:function(){XAPP.menu.hide();var e=n.getSelectedNodes(),t=e[0].children,a="";if(e&&e.length>0){a=t&&t.length>0?$("<p>").text("If you delete this node will be deleted along with sub-nodes. \n\nPlease confirm!"):$("<p>").text("Are you sure to remove this node? \n\n Please confirm!");var i=RED.notify(a,{modal:!0,fixed:!0,buttons:[{text:RED._("deploy.confirm.button.ignore"),click:function(){i.close(),i=null}},{text:"Confirme",class:"primary",click:function(){o.removeNodes(e),n.removeNode(e[0]);var t=e[0].getParentNode();t.isParent=!0,n.updateNode(t),RED.nodes.dirty(!0),i.close(),i=null}}]})}},removeNodes:function(e){for(var t,n=0;n<e.length;n++)RED.nodes.node(e[n].id)&&(e[n].isCopy||RED.nodes.remove(e[n].id),(t=e[n].children)&&t.length>0&&o.removeNodes(t))}},a=e=>{var t=n.getNodesByParam("id",e.id)[0];t.name=e.name,n.updateNode(t),n.selectNode(t)};return{init:function(){var e={general:{beforeDrag:(e,t)=>t[0].level>1//!treeNodes[0].isParent
,onAsyncError:()=>null,onAsyncSuccess:()=>null,onNodeCreated:()=>null,onClick:(e,t,n,o)=>{n&&(console.log("Node orig :",RED.nodes.node(n.id)),console.log("Node Tree :",n),console.log("is copy :",n.isCopy),console.log("treeNode.type  :",n.type),n.type,"Demo 01"==n.name&&RED.demo.demo_echarts(n.id),"Demo 02"==n.name&&RED.demo.demo_tables(),"Demo 03"==n.name&&RED.demo.demo_synop(),"Demo 04"==n.name&&RED.demo.demo_dashboards(),"Demo 05"==n.name&&RED.demo.demo_widget(),"Demo 06"==n.name&&RED.demo.demo_templates(),"Demo 07"==n.name&&RED.demo.demo_gridstack(),"Demo 08"==n.name&&RED.demo.demo_datatable(),"Demo 09"==n.name&&RED.demo.demo_ztree(),"Demo 10"==n.name&&RED.demo.demo_io())},onDblClick:(e,t,n,o)=>{if(n){var a=RED.nodes.node(n.id);RED.editor.edit(a)}},onRightClick:(e,t,o)=>{XAPP.menu.load(o),o||"button"==e.target.tagName.toLowerCase()||0!=$(e.target).parents("a").length?o&&!o.noR&&(n.selectNode(o),XAPP.menu.show("node",e.clientX,e.clientY)):(n.cancelSelectedNode(),XAPP.menu.show("root",e.clientX,e.clientY))},onMouseDown:()=>null,onMouseUp:()=>null,onExpand:()=>null,onCollapse:()=>null,onRemove:()=>null,onDrag:()=>null,onDragMove:()=>null,onDrop:(e,t,n,o,a,i)=>{if(n[0].isCopy=!0,o){var d=RED.nodes.node(o.id);if(d.datapoints){var r=n[0].id,s=RED.nodes.node(r);d.datapoints[s.id]={id:s.id,name:s.name,color:s.color},RED.nodes.dirty(!0)}}}},view:{addHoverDom:(e,t)=>{},removeHoverDom:(e,t)=>{$("#addBtn_"+t.tId).unbind().remove()}},drag:{getPermission:(e,t,n)=>{var o={inner:{"s7.io":["s7.group","ui.piechart","ui.linechart","ui.barchart","s7.calculator","ui.infoBox","ui.progressBox","ui.spark","ui.inline","ui.progressBar","m.widget","m.piechart","m.barchart","s7.trend"],"s7.alarm":["s7.group"]},prev:{"s7.io":["s7.io","s7.alarm"],"s7.alarm":["s7.alarm","s7.io"],"ui.barchart":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.template":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.gauge":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.piechart":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.spark":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"]},next:{"s7.io":["s7.io","s7.alarm"],"s7.alarm":["s7.alarm","s7.io"],"ui.barchart":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.template":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.gauge":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.piechart":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"],"ui.spark":["ui.barchart","ui.template","ui.gauge","ui.piechart","ui.spark"]},copy:{"s7.io":["s7.io","ui.piechart","ui.barchart","ui.linechart","s7.mobile","s7.calculator","ui.infoBox","ui.progressBox","ui.spark","ui.inline","ui.progressBar","m.widget","m.piechart","m.barchart","s7.trend"],"s7.alarm":["s7.alarm","s7.io"]},move:{"s7.io":["s7.io","s7.alarm"],"s7.alarm":["s7.alarm","s7.io"]}}[e][t];if(o&&o.length>0)for(var a=0;a<o.length;a++)if(o[a]===n)return!0;return!1},prevTree:(t,n,o)=>(console.log("Prev :",e.drag.getPermission("prev",n[0].type,o.type)),e.drag.getPermission("prev",n[0].type,o.type)),nextTree:(t,n,o)=>(console.log("Next :",e.drag.getPermission("next",n[0].type,o.type)),e.drag.getPermission("next",n[0].type,o.type)),innerTree:(t,o,a)=>{var i=!1,d=RED.nodes.node(a.id);return d&&d.datapoints&&(i=!!d.datapoints[o[0].id]),n.setting.edit.drag.isCopy=e.drag.getPermission("copy",o[0].type,a.type),n.setting.edit.drag.isMove=e.drag.getPermission("move",o[0].type,a.type),!i&&e.drag.getPermission("inner",o[0].type,a.type)}}},t={view:{addHoverDom:e.view.addHoverDom,removeHoverDom:e.view.removeHoverDom,dblClickExpand:!1,showLine:!0,showIcon:!0,selectedMulti:!1},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{prev:e.drag.prevTree,next:e.drag.nextTree,inner:e.drag.innerTree,isCopy:e.drag.isCopy,isMove:e.drag.isMove}},check:{enable:!1},data:{simpleData:{enable:!0}},callback:{beforeDrag:e.general.beforeDrag,onNodeCreated:e.general.onNodeCreated,onClick:e.general.onClick,onDblClick:e.general.onDblClick,onRightClick:e.general.onRightClick,onMouseDown:e.general.onMouseDown,onMouseUp:e.general.onMouseUp,onExpand:e.general.onExpand,onCollapse:e.general.onCollapse,onRemove:e.general.onRemove,onDrag:e.general.onDrag,onDragMove:e.general.onDragMove,onDrop:e.general.onDrop}},i=RED.settings.get("treelist")||[{id:1,pId:0,name:"System",open:!0,isParent:!0,class:"icon-system"},{id:11,pId:1,name:"Configuration",class:"icon-config",isParent:!0},{id:12,pId:1,name:"Data Base",class:"icon-database",isParent:!0},{id:13,pId:1,name:"Data Point",class:"icon-datapoint",isParent:!0},{id:14,pId:1,name:"Dashboard",class:"icon-dashboard",isParent:!0},{id:15,pId:1,name:"Mobile",class:"icon-mobile",isParent:!0},{id:16,pId:1,name:"Report",class:"icon-report",isParent:!0},{id:17,pId:1,name:"Extras",class:"icon-demos",isParent:!0},{id:141,pId:17,name:"Demo 01",class:"icon-demos",isParent:!1},{id:142,pId:17,name:"Demo 02",class:"icon-demos",isParent:!1},{id:143,pId:17,name:"Demo 03",class:"icon-demos",isParent:!1},{id:144,pId:17,name:"Demo 04",class:"icon-demos",isParent:!1},{id:145,pId:17,name:"Demo 05",class:"icon-demos",isParent:!1},{id:146,pId:17,name:"Demo 06",class:"icon-demos",isParent:!1},{id:147,pId:17,name:"Demo 07",class:"icon-demos",isParent:!1},{id:148,pId:17,name:"Demo 08",class:"icon-demos",isParent:!1},{id:149,pId:17,name:"Demo 09",class:"icon-demos",isParent:!1},{id:150,pId:17,name:"Demo 10",class:"icon-demos",isParent:!1}];$('<ul id="xapptreelist" class="ztree" style="margin: 3px;"></ul>').appendTo("#red-ui-palette-content"),XAPP.trees.init($("#xapptreelist"),t,i),n=XAPP.trees.tree.getZTreeObj("xapptreelist"),XAPP.actions.add("core:tree-node-import",o.importNodes),XAPP.actions.add("core:tree-node-export",o.exportNodes),XAPP.actions.add("core:tree-new-database",o.adddatabase),XAPP.actions.add("core:tree-new-tag-archive",o.addTag),XAPP.actions.add("core:tree-new-group",o.addGroup),XAPP.actions.add("core:tree-new-tag-logging",o.addTagLogging),XAPP.actions.add("core:tree-node-refresh",o.refresh),XAPP.actions.add("core:tree-node-cut",o.cut),XAPP.actions.add("core:tree-node-copy",o.copy),XAPP.actions.add("core:tree-node-paste",o.paste),XAPP.actions.add("core:tree-node-delete",o.remove),XAPP.actions.add("core:tree-new-connection",o.addConnection),XAPP.actions.add("core:tree-new-ui-group",o.adduigroup),XAPP.actions.add("core:tree-new-ui-tab",o.adduitab),XAPP.actions.add("core:tree-new-ui-gauge",o.adduigauge),XAPP.actions.add("core:tree-new-ui-chart",o.adduichart),XAPP.actions.add("core:tree-new-ui-toast",o.adduitoast),XAPP.actions.add("core:tree-new-ui-piechart",o.adduipiechart),XAPP.actions.add("core:tree-new-ui-uispark",o.adduispark),XAPP.actions.add("core:tree-new-ui-uiprogressbar",o.adduiprogressbar),XAPP.actions.add("core:tree-new-ui-uiprogressbox",o.adduiprogressbox),XAPP.actions.add("core:tree-new-ui-uiinline",o.adduiinline),XAPP.actions.add("core:tree-new-ui-uiinfobox",o.adduiinfobox),XAPP.actions.add("core:tree-new-ui-barchart",o.adduibarchart),XAPP.actions.add("core:tree-new-ui-template",o.adduitemplate),XAPP.actions.add("core:tree-new-db",o.adddatabase),XAPP.actions.add("core:tree-new-coll",o.addcollection),XAPP.actions.add("core:tree-new-mmobile",o.addmobile),XAPP.actions.add("core:tree-new-mwidget",o.addmwidget),XAPP.actions.add("core:tree-new-mpiechart",o.addmpiechart),XAPP.actions.add("core:tree-new-mbarchart",o.addmbarchart),XAPP.actions.add("core:tree-new-datapoint",o.adddatapoint),XAPP.actions.add("core:tree-new-calculator",o.addcalculator),XAPP.actions.add("core:tree-new-batch",o.addBatch),XAPP.actions.add("core:tree-new-alarm",o.addAlarm),XAPP.actions.add("core:tree-new-status",o.addStatus),XAPP.actions.add("core:tree-new-phase",o.addPhase),XAPP.actions.add("core:tree-new-trend",o.addTrend),XAPP.actions.add("core:tree-new-statemachine",o.addstatemachine),XAPP.actions.add("core:tree-new-rpreport",o.addrpreport),XAPP.actions.add("core:tree-new-rpwidget",o.addrpwidget),XAPP.actions.add("core:tree-new-rptemplate",o.addrptemplate),XAPP.actions.add("core:tree-new-rpchart",o.addrpchart),RED.events.on("editor:save",a)},actions:o,tree:()=>n}}(),XAPP.trees=function(){var tree=function(){var settings={},roots={},caches={},consts={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch",NAME:"node_name"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove",SELECTED:"ztree_selected",UNSELECTED:"ztree_unselected"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!0,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!0,showIcon:!0,showLine:!0,showTitle:!0,txtSelectedEnable:!1},data:{key:{isParent:"isParent",children:"children",name:"name",title:"",url:"url",icon:"icon"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",headers:{},xhrFields:{},url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}};_initRoot=function(e){var t=data.getRoot(e);t||(t={},data.setRoot(e,t)),data.nodeChildren(e,t,[]),t.expandTriggerFlag=!1,t.curSelectedList=[],t.noSelection=!0,t.createdNodes=[],t.zId=0,t._ver=(new Date).getTime()},_initCache=function(e){var t=data.getCache(e);t||(t={},data.setCache(e,t)),t.nodes=[],t.doms=[]},_bindEvent=function(e){var t=e.treeObj,n=consts.event;t.bind(n.NODECREATED,(function(t,n,o){tools.apply(e.callback.onNodeCreated,[t,n,o])})),t.bind(n.CLICK,(function(t,n,o,a,i){tools.apply(e.callback.onClick,[n,o,a,i])})),t.bind(n.EXPAND,(function(t,n,o){tools.apply(e.callback.onExpand,[t,n,o])})),t.bind(n.COLLAPSE,(function(t,n,o){tools.apply(e.callback.onCollapse,[t,n,o])})),t.bind(n.ASYNC_SUCCESS,(function(t,n,o,a){tools.apply(e.callback.onAsyncSuccess,[t,n,o,a])})),t.bind(n.ASYNC_ERROR,(function(t,n,o,a,i,d){tools.apply(e.callback.onAsyncError,[t,n,o,a,i,d])})),t.bind(n.REMOVE,(function(t,n,o){tools.apply(e.callback.onRemove,[t,n,o])})),t.bind(n.SELECTED,(function(t,n,o){tools.apply(e.callback.onSelected,[n,o])})),t.bind(n.UNSELECTED,(function(t,n,o){tools.apply(e.callback.onUnSelected,[n,o])}))},_unbindEvent=function(e){var t=e.treeObj,n=consts.event;t.unbind(n.NODECREATED).unbind(n.CLICK).unbind(n.EXPAND).unbind(n.COLLAPSE).unbind(n.ASYNC_SUCCESS).unbind(n.ASYNC_ERROR).unbind(n.REMOVE).unbind(n.SELECTED).unbind(n.UNSELECTED)},_eventProxy=function(e){var t=e.target,n=data.getSetting(e.data.treeId),o="",a=null,i="",d="",r=null,s=null,l=null;if(tools.eqs(e.type,"mousedown")?d="mousedown":tools.eqs(e.type,"mouseup")?d="mouseup":tools.eqs(e.type,"contextmenu")?d="contextmenu":tools.eqs(e.type,"click")?tools.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+consts.id.SWITCH)?(o=tools.getNodeMainDom(t).id,i="switchNode"):(l=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(o=tools.getNodeMainDom(l).id,i="clickNode"):tools.eqs(e.type,"dblclick")&&(d="dblclick",(l=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(o=tools.getNodeMainDom(l).id,i="switchNode")),d.length>0&&0==o.length&&(l=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]))&&(o=tools.getNodeMainDom(l).id),o.length>0)switch(a=data.getNodeCache(n,o),i){case"switchNode":data.nodeIsParent(n,a)&&(tools.eqs(e.type,"click")||tools.eqs(e.type,"dblclick")&&tools.apply(n.view.dblClickExpand,[n.treeId,a],n.view.dblClickExpand))?r=handler.onSwitchNode:i="";break;case"clickNode":r=handler.onClickNode}switch(d){case"mousedown":s=handler.onZTreeMousedown;break;case"mouseup":s=handler.onZTreeMouseup;break;case"dblclick":s=handler.onZTreeDblclick;break;case"contextmenu":s=handler.onZTreeContextmenu}return{stop:!1,node:a,nodeEventType:i,nodeEventCallback:r,treeEventType:d,treeEventCallback:s}},_initNode=function(e,t,n,o,a,i,d){if(n){var r=data.getRoot(e),s=data.nodeChildren(e,n);n.level=t,n.tId=e.treeId+"_"+ ++r.zId,n.parentTId=o?o.tId:null,n.open="string"==typeof n.open?tools.eqs(n.open,"true"):!!n.open;var l=data.nodeIsParent(e,n);tools.isArray(s)?(data.nodeIsParent(e,n,!0),n.zAsync=!0):(l=data.nodeIsParent(e,n,l),n.open=!(!l||e.async.enable)&&n.open,n.zAsync=!l),n.isFirstNode=a,n.isLastNode=i,n.getParentNode=function(){return data.getNodeCache(e,n.parentTId)},n.getPreNode=function(){return data.getPreNode(e,n)},n.getNextNode=function(){return data.getNextNode(e,n)},n.getIndex=function(){return data.getNodeIndex(e,n)},n.getPath=function(){return data.getNodePath(e,n)},n.isAjaxing=!1,data.fixPIdKeyValue(e,n)}},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(e,t){data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=t},getNodeCacheId:function(e){return e.substring(e.lastIndexOf("_")+1)},addAfterA:function(e){_init.afterA.push(e)},addBeforeA:function(e){_init.beforeA.push(e)},addInnerAfterA:function(e){_init.innerAfterA.push(e)},addInnerBeforeA:function(e){_init.innerBeforeA.push(e)},addInitBind:function(e){_init.bind.push(e)},addInitUnBind:function(e){_init.unbind.push(e)},addInitCache:function(e){_init.caches.push(e)},addInitNode:function(e){_init.nodes.push(e)},addInitProxy:function(e,t){t?_init.proxys.splice(0,0,e):_init.proxys.push(e)},addInitRoot:function(e){_init.roots.push(e)},addNodesData:function(e,t,n,o){var a,i=data.nodeChildren(e,t);i?n>=i.length&&(n=-1):(i=data.nodeChildren(e,t,[]),n=-1),i.length>0&&0===n?(i[0].isFirstNode=!1,view.setNodeLineIcos(e,i[0])):i.length>0&&n<0&&(i[i.length-1].isLastNode=!1,view.setNodeLineIcos(e,i[i.length-1])),data.nodeIsParent(e,t,!0),n<0?data.nodeChildren(e,t,i.concat(o)):(a=[n,0].concat(o),i.splice.apply(i,a))},addSelectedNode:function(e,t){var n=data.getRoot(e);data.isSelectedNode(e,t)||n.curSelectedList.push(t)},addCreatedNode:function(e,t){(e.callback.onNodeCreated||e.view.addDiyDom)&&data.getRoot(e).createdNodes.push(t)},addZTreeTools:function(e){_init.zTreeTools.push(e)},exSetting:function(e){$.extend(!0,_setting,e)},fixPIdKeyValue:function(e,t){e.data.simpleData.enable&&(t[e.data.simpleData.pIdKey]=t.parentTId?t.getParentNode()[e.data.simpleData.idKey]:e.data.simpleData.rootPId)},getAfterA:function(e,t,n){for(var o=0,a=_init.afterA.length;o<a;o++)_init.afterA[o].apply(this,arguments)},getBeforeA:function(e,t,n){for(var o=0,a=_init.beforeA.length;o<a;o++)_init.beforeA[o].apply(this,arguments)},getInnerAfterA:function(e,t,n){for(var o=0,a=_init.innerAfterA.length;o<a;o++)_init.innerAfterA[o].apply(this,arguments)},getInnerBeforeA:function(e,t,n){for(var o=0,a=_init.innerBeforeA.length;o<a;o++)_init.innerBeforeA[o].apply(this,arguments)},getCache:function(e){return caches[e.treeId]},getNodeIndex:function(e,t){if(!t)return null;for(var n=t.parentTId?t.getParentNode():data.getRoot(e),o=data.nodeChildren(e,n),a=0,i=o.length-1;a<=i;a++)if(o[a]===t)return a;return-1},getNextNode:function(e,t){if(!t)return null;for(var n=t.parentTId?t.getParentNode():data.getRoot(e),o=data.nodeChildren(e,n),a=0,i=o.length-1;a<=i;a++)if(o[a]===t)return a==i?null:o[a+1];return null},getNodeByParam:function(e,t,n,o){if(!t||!n)return null;for(var a=0,i=t.length;a<i;a++){var d=t[a];if(d[n]==o)return t[a];var r=data.nodeChildren(e,d),s=data.getNodeByParam(e,r,n,o);if(s)return s}return null},getNodeCache:function(e,t){if(!t)return null;var n=caches[e.treeId].nodes[data.getNodeCacheId(t)];return n||null},getNodePath:function(e,t){return t?((n=t.parentTId?t.getParentNode().getPath():[])&&n.push(t),n):null;var n},getNodes:function(e){return data.nodeChildren(e,data.getRoot(e))},getNodesByParam:function(e,t,n,o){if(!t||!n)return[];for(var a=[],i=0,d=t.length;i<d;i++){var r=t[i];r[n]==o&&a.push(r);var s=data.nodeChildren(e,r);a=a.concat(data.getNodesByParam(e,s,n,o))}return a},getNodesByParamFuzzy:function(e,t,n,o){if(!t||!n)return[];var a=[];o=o.toLowerCase();for(var i=0,d=t.length;i<d;i++){var r=t[i];"string"==typeof r[n]&&t[i][n].toLowerCase().indexOf(o)>-1&&a.push(r);var s=data.nodeChildren(e,r);a=a.concat(data.getNodesByParamFuzzy(e,s,n,o))}return a},getNodesByFilter:function(e,t,n,o,a){if(!t)return o?null:[];for(var i=o?null:[],d=0,r=t.length;d<r;d++){var s=t[d];if(tools.apply(n,[s,a],!1)){if(o)return s;i.push(s)}var l=data.nodeChildren(e,s),c=data.getNodesByFilter(e,l,n,o,a);if(o&&c)return c;i=o?c:i.concat(c)}return i},getPreNode:function(e,t){if(!t)return null;for(var n=t.parentTId?t.getParentNode():data.getRoot(e),o=data.nodeChildren(e,n),a=0,i=o.length;a<i;a++)if(o[a]===t)return 0==a?null:o[a-1];return null},getRoot:function(e){return e?roots[e.treeId]:null},getRoots:function(){return roots},getSetting:function(e){return settings[e]},getSettings:function(){return settings},getZTreeTools:function(e){var t=this.getRoot(this.getSetting(e));return t?t.treeTools:null},initCache:function(e){for(var t=0,n=_init.caches.length;t<n;t++)_init.caches[t].apply(this,arguments)},initNode:function(e,t,n,o,a,i){for(var d=0,r=_init.nodes.length;d<r;d++)_init.nodes[d].apply(this,arguments)},initRoot:function(e){for(var t=0,n=_init.roots.length;t<n;t++)_init.roots[t].apply(this,arguments)},isSelectedNode:function(e,t){for(var n=data.getRoot(e),o=0,a=n.curSelectedList.length;o<a;o++)if(t===n.curSelectedList[o])return!0;return!1},nodeChildren:function(e,t,n){if(!t)return null;var o=e.data.key.children;return void 0!==n&&(t[o]=n),t[o]},nodeIsParent:function(e,t,n){if(!t)return!1;var o=e.data.key.isParent;return void 0!==n?("string"==typeof n&&(n=tools.eqs(n,"true")),n=!!n,t[o]=n):"string"==typeof t[o]?t[o]=tools.eqs(t[o],"true"):t[o]=!!t[o],t[o]},nodeName:function(e,t,n){var o=e.data.key.name;return void 0!==n&&(t[o]=n),""+t[o]},nodeTitle:function(e,t){return""+t[""===e.data.key.title?e.data.key.name:e.data.key.title]},removeNodeCache:function(e,t){var n=data.nodeChildren(e,t);if(n)for(var o=0,a=n.length;o<a;o++)data.removeNodeCache(e,n[o]);data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=null},removeSelectedNode:function(e,t){for(var n=data.getRoot(e),o=0,a=n.curSelectedList.length;o<a;o++)t!==n.curSelectedList[o]&&data.getNodeCache(e,n.curSelectedList[o].tId)||(n.curSelectedList.splice(o,1),e.treeObj.trigger(consts.event.UNSELECTED,[e.treeId,t]),o--,a--)},setCache:function(e,t){caches[e.treeId]=t},setRoot:function(e,t){roots[e.treeId]=t},setZTreeTools:function(e,t){for(var n=0,o=_init.zTreeTools.length;n<o;n++)_init.zTreeTools[n].apply(this,arguments)},transformToArrayFormat:function(e,t){if(!t)return[];var n=[];if(tools.isArray(t))for(var o=0,a=t.length;o<a;o++){i(t[o])}else i(t);return n;function i(t){n.push(t);var o=data.nodeChildren(e,t);o&&(n=n.concat(data.transformToArrayFormat(e,o)))}},transformTozTreeFormat:function(e,t){var n,o,a=e.data.simpleData.idKey,i=e.data.simpleData.pIdKey;if(!a||""==a||!t)return[];if(tools.isArray(t)){var d=[],r={};for(n=0,o=t.length;n<o;n++)r[t[n][a]]=t[n];for(n=0,o=t.length;n<o;n++){var s=r[t[n][i]];if(s&&t[n][a]!=t[n][i]){var l=data.nodeChildren(e,s);l||(l=data.nodeChildren(e,s,[])),l.push(t[n])}else d.push(t[n])}return d}return[t]}},event={bindEvent:function(e){for(var t=0,n=_init.bind.length;t<n;t++)_init.bind[t].apply(this,arguments)},unbindEvent:function(e){for(var t=0,n=_init.unbind.length;t<n;t++)_init.unbind[t].apply(this,arguments)},bindTree:function(e){var t={treeId:e.treeId},n=e.treeObj;e.view.txtSelectedEnable||n.bind("selectstart",handler.onSelectStart).css({"-moz-user-select":"-moz-none"}),n.bind("click",t,event.proxy),n.bind("dblclick",t,event.proxy),n.bind("mouseover",t,event.proxy),n.bind("mouseout",t,event.proxy),n.bind("mousedown",t,event.proxy),n.bind("mouseup",t,event.proxy),n.bind("contextmenu",t,event.proxy)},unbindTree:function(e){e.treeObj.unbind("selectstart",handler.onSelectStart).unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){for(var t=[],n=0,o=_init.proxys.length;n<o;n++){var a=_init.proxys[n].apply(this,arguments);if(t.push(a),a.stop)break}return t},proxy:function(e){var t=data.getSetting(e.data.treeId);if(!tools.uCanDo(t,e))return!0;for(var n=event.doProxy(e),o=!0,a=0,i=n.length;a<i;a++){var d=n[a];d.nodeEventCallback&&(!0,o=d.nodeEventCallback.apply(d,[e,d.node])&&o),d.treeEventCallback&&(!0,o=d.treeEventCallback.apply(d,[e,d.node])&&o)}return o}},handler={onSwitchNode:function(e,t){var n=data.getSetting(e.data.treeId);if(t.open){if(0==tools.apply(n.callback.beforeCollapse,[n.treeId,t],!0))return!0;data.getRoot(n).expandTriggerFlag=!0,view.switchNode(n,t)}else{if(0==tools.apply(n.callback.beforeExpand,[n.treeId,t],!0))return!0;data.getRoot(n).expandTriggerFlag=!0,view.switchNode(n,t)}return!0},onClickNode:function(e,t){var n=data.getSetting(e.data.treeId),o=n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&data.isSelectedNode(n,t)?0:n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&n.view.selectedMulti?2:1;return 0==tools.apply(n.callback.beforeClick,[n.treeId,t,o],!0)||(0===o?view.cancelPreSelectedNode(n,t):view.selectNode(n,t,2===o),n.treeObj.trigger(consts.event.CLICK,[e,n.treeId,t,o])),!0},onZTreeMousedown:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeMouseDown,[n.treeId,t],!0)&&tools.apply(n.callback.onMouseDown,[e,n.treeId,t]),!0},onZTreeMouseup:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeMouseUp,[n.treeId,t],!0)&&tools.apply(n.callback.onMouseUp,[e,n.treeId,t]),!0},onZTreeDblclick:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeDblClick,[n.treeId,t],!0)&&tools.apply(n.callback.onDblClick,[e,n.treeId,t]),!0},onZTreeContextmenu:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeRightClick,[n.treeId,t],!0)&&tools.apply(n.callback.onRightClick,[e,n.treeId,t]),"function"!=typeof n.callback.onRightClick},onSelectStart:function(e){var t=e.originalEvent.srcElement.nodeName.toLowerCase();return"input"===t||"textarea"===t}},tools={apply:function(e,t,n){return"function"==typeof e?e.apply(zt,t||[]):n},canAsync:function(e,t){var n=data.nodeChildren(e,t),o=data.nodeIsParent(e,t);return e.async.enable&&t&&o&&!(t.zAsync||n&&n.length>0)},clone:function(e){if(null===e)return null;var t=tools.isArray(e)?[]:{};for(var n in e)t[n]=e[n]instanceof Date?new Date(e[n].getTime()):"object"==typeof e[n]?tools.clone(e[n]):e[n];return t},eqs:function(e,t){return e.toLowerCase()===t.toLowerCase()},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},$:function(e,t,n){return t&&"string"!=typeof t&&(n=t,t=""),"string"==typeof e?$(e,n?n.treeObj.get(0).ownerDocument:null):$("#"+e.tId+t,n?n.treeObj:null)},getMDom:function(e,t,n){if(!t)return null;for(;t&&t.id!==e.treeId;){for(var o=0,a=n.length;t.tagName&&o<a;o++)if(tools.eqs(t.tagName,n[o].tagName)&&null!==t.getAttribute(n[o].attrName))return t;t=t.parentNode}return null},getNodeMainDom:function(e){return $(e).parent("li").get(0)||$(e).parentsUntil("li").parent().get(0)},isChildOrSelf:function(e,t){return $(e).closest("#"+t).length>0},uCanDo:function(e,t){return!0}},view={addNodes:function(e,t,n,o,a){var i=data.nodeIsParent(e,t);if(!e.data.keep.leaf||!t||i)if(tools.isArray(o)||(o=[o]),e.data.simpleData.enable&&(o=data.transformTozTreeFormat(e,o)),t){var d=$$(t,consts.id.SWITCH,e),r=$$(t,consts.id.ICON,e),s=$$(t,consts.id.UL,e);t.open||(view.replaceSwitchClass(t,d,consts.folder.CLOSE),view.replaceIcoClass(t,r,consts.folder.CLOSE),t.open=!1,s.css({display:"none"})),data.addNodesData(e,t,n,o),view.createNodes(e,t.level+1,o,t,n),a||view.expandCollapseParentNode(e,t,!0)}else data.addNodesData(e,data.getRoot(e),n,o),view.createNodes(e,0,o,null,n)},appendNodes:function(e,t,n,o,a,i,d){if(!n)return[];var r,s,l=[],c=o||data.getRoot(e),u=data.nodeChildren(e,c);(!u||a>=u.length-n.length)&&(a=-1);for(var p=0,g=n.length;p<g;p++){var h=n[p];i&&(r=(0===a||u.length==n.length)&&0==p,s=a<0&&p==n.length-1,data.initNode(e,t,h,o,r,s,d),data.addNodeCache(e,h));var f=data.nodeIsParent(e,h),m=[],v=data.nodeChildren(e,h);v&&v.length>0&&(m=view.appendNodes(e,t+1,v,h,-1,i,d&&h.open)),d&&(view.makeDOMNodeMainBefore(l,e,h),view.makeDOMNodeLine(l,e,h),data.getBeforeA(e,h,l),view.makeDOMNodeNameBefore(l,e,h),data.getInnerBeforeA(e,h,l),view.makeDOMNodeIcon(l,e,h),data.getInnerAfterA(e,h,l),view.makeDOMNodeNameAfter(l,e,h),data.getAfterA(e,h,l),f&&h.open&&view.makeUlHtml(e,h,l,m.join("")),view.makeDOMNodeMainAfter(l,e,h),data.addCreatedNode(e,h))}return l},appendParentULDom:function(e,t){var n=[],o=$$(t,e);!o.get(0)&&t.parentTId&&(view.appendParentULDom(e,t.getParentNode()),o=$$(t,e));var a=$$(t,consts.id.UL,e);a.get(0)&&a.remove();var i=data.nodeChildren(e,t),d=view.appendNodes(e,t.level+1,i,t,-1,!1,!0);view.makeUlHtml(e,t,n,d.join("")),o.append(n.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l,isParent=data.nodeIsParent(setting,node);if(node&&!isParent)return tools.apply(callback),!1;if(node&&node.isAjaxing)return!1;if(0==tools.apply(setting.callback.beforeAsync,[setting.treeId,node],!0))return tools.apply(callback),!1;if(node){node.isAjaxing=!0;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"",class:consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={},autoParam=tools.apply(setting.async.autoParam,[setting.treeId,node],setting.async.autoParam);for(i=0,l=autoParam.length;node&&i<l;i++){var pKey=autoParam[i].split("="),spKey=pKey;pKey.length>1&&(spKey=pKey[1],pKey=pKey[0]),tmpParam[spKey]=node[pKey]}var otherParam=tools.apply(setting.async.otherParam,[setting.treeId,node],setting.async.otherParam);if(tools.isArray(otherParam))for(i=0,l=otherParam.length;i<l;i+=2)tmpParam[otherParam[i]]=otherParam[i+1];else for(var p in otherParam)tmpParam[p]=otherParam[p];var _tmpV=data.getRoot(setting)._ver;return $.ajax({contentType:setting.async.contentType,cache:!1,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:setting.async.contentType.indexOf("application/json")>-1?JSON.stringify(tmpParam):tmpParam,dataType:setting.async.dataType,headers:setting.async.headers,xhrFields:setting.async.xhrFields,success:function(msg){if(_tmpV==data.getRoot(setting)._ver){var newNodes=[];try{newNodes=msg&&0!=msg.length?"string"==typeof msg?eval("("+msg+")"):msg:[]}catch(e){newNodes=msg}node&&(node.isAjaxing=null,node.zAsync=!0),view.setNodeLineIcos(setting,node),newNodes&&""!==newNodes?(newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes),view.addNodes(setting,node,-1,newNodes?tools.clone(newNodes):[],!!isSilent)):view.addNodes(setting,node,-1,[],!!isSilent),setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]),tools.apply(callback)}},error:function(e,t,n){_tmpV==data.getRoot(setting)._ver&&(node&&(node.isAjaxing=null),view.setNodeLineIcos(setting,node),setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,e,t,n]))}}),!0},cancelPreSelectedNode:function(e,t,n){var o,a,i=data.getRoot(e).curSelectedList;for(o=i.length-1;o>=0;o--)if(t===(a=i[o])||!t&&(!n||n!==a)){if($$(a,consts.id.A,e).removeClass(consts.node.CURSELECTED),t){data.removeSelectedNode(e,t);break}i.splice(o,1),e.treeObj.trigger(consts.event.UNSELECTED,[e.treeId,a])}},createNodeCallback:function(e){if(e.callback.onNodeCreated||e.view.addDiyDom)for(var t=data.getRoot(e);t.createdNodes.length>0;){var n=t.createdNodes.shift();tools.apply(e.view.addDiyDom,[e.treeId,n]),e.callback.onNodeCreated&&e.treeObj.trigger(consts.event.NODECREATED,[e.treeId,n])}},createNodes:function(e,t,n,o,a){if(n&&0!=n.length){var i=data.getRoot(e),d=!o||o.open||!!$$(data.nodeChildren(e,o)[0],e).get(0);i.createdNodes=[];var r,s,l=view.appendNodes(e,t,n,o,a,!0,d);if(o){var c=$$(o,consts.id.UL,e);c.get(0)&&(r=c)}else r=e.treeObj;r&&(a>=0&&(s=r.children()[a]),a>=0&&s?$(s).before(l.join("")):r.append(l.join(""))),view.createNodeCallback(e)}},destroy:function(e){e&&(data.initCache(e),data.initRoot(e),event.unbindTree(e),event.unbindEvent(e),e.treeObj.empty(),delete settings[e.treeId])},expandCollapseNode:function(e,t,n,o,a){var i,d=data.getRoot(e);if(t){var r=data.nodeChildren(e,t),s=data.nodeIsParent(e,t);if(d.expandTriggerFlag&&(i=a,a=function(){i&&i(),t.open?e.treeObj.trigger(consts.event.EXPAND,[e.treeId,t]):e.treeObj.trigger(consts.event.COLLAPSE,[e.treeId,t])},d.expandTriggerFlag=!1),!t.open&&s&&(!$$(t,consts.id.UL,e).get(0)||r&&r.length>0&&!$$(r[0],e).get(0))&&(view.appendParentULDom(e,t),view.createNodeCallback(e)),t.open!=n){var l=$$(t,consts.id.UL,e),c=$$(t,consts.id.SWITCH,e),u=$$(t,consts.id.ICON,e);s?(t.open=!t.open,t.iconOpen&&t.iconClose&&u.attr("style",view.makeNodeIcoStyle(e,t)),t.open?(view.replaceSwitchClass(t,c,consts.folder.OPEN),view.replaceIcoClass(t,u,consts.folder.OPEN),0==o||""==e.view.expandSpeed?(l.show(),tools.apply(a,[])):r&&r.length>0?l.slideDown(e.view.expandSpeed,a):(l.show(),tools.apply(a,[]))):(view.replaceSwitchClass(t,c,consts.folder.CLOSE),view.replaceIcoClass(t,u,consts.folder.CLOSE),0!=o&&""!=e.view.expandSpeed&&r&&r.length>0?l.slideUp(e.view.expandSpeed,a):(l.hide(),tools.apply(a,[])))):tools.apply(a,[])}else tools.apply(a,[])}else tools.apply(a,[])},expandCollapseParentNode:function(e,t,n,o,a){t&&(t.parentTId?(view.expandCollapseNode(e,t,n,o),t.parentTId&&view.expandCollapseParentNode(e,t.getParentNode(),n,o,a)):view.expandCollapseNode(e,t,n,o,a))},expandCollapseSonNode:function(e,t,n,o,a){var i=data.getRoot(e),d=t?data.nodeChildren(e,t):data.nodeChildren(e,i),r=!t&&o,s=data.getRoot(e).expandTriggerFlag;if(data.getRoot(e).expandTriggerFlag=!1,d)for(var l=0,c=d.length;l<c;l++)d[l]&&view.expandCollapseSonNode(e,d[l],n,r);data.getRoot(e).expandTriggerFlag=s,view.expandCollapseNode(e,t,n,o,a)},isSelectedNode:function(e,t){if(!t)return!1;var n,o=data.getRoot(e).curSelectedList;for(n=o.length-1;n>=0;n--)if(t===o[n])return!0;return!1},makeDOMNodeIcon:function(e,t,n){var o=data.nodeName(t,n),a=t.view.nameIsHTML?o:o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=""+n.id;e.push("<span id='",i.replace(".","-"),consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",i.replace(".","-"),"_icon ",view.makeNodeIcoClass(t,n),"' style='",view.makeNodeIcoStyle(t,n),"'></span><span id='",n.tId,consts.id.SPAN,"' class='",consts.className.NAME,"'>",a,"</span>")},makeDOMNodeLine:function(e,t,n){e.push("<span id='",n.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(t,n),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(e,t,n){e.push("</li>")},makeDOMNodeMainBefore:function(e,t,n){e.push("<li id='",n.tId,"' class='",consts.className.LEVEL,n.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(e,t,n){e.push("</a>")},makeDOMNodeNameBefore:function(e,t,n){var o=data.nodeTitle(t,n),a=view.makeNodeUrl(t,n),i=view.makeNodeFontCss(t,n),d=[];for(var r in i)d.push(r,":",i[r],";");e.push("<a id='",n.tId,consts.id.A,"' class='",consts.className.LEVEL,n.level,"' treeNode",consts.id.A,' onclick="',n.click||"",'" ',null!=a&&a.length>0?"href='"+a+"'":""," target='",view.makeNodeTarget(n),"' style='",d.join(""),"'"),tools.apply(t.view.showTitle,[t.treeId,n],t.view.showTitle)&&o&&e.push("title='",o.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'"),e.push(">")},makeNodeFontCss:function(e,t){var n=tools.apply(e.view.fontCss,[e.treeId,t],e.view.fontCss);return n&&"function"!=typeof n?n:{}},makeNodeIcoClass:function(e,t){var n=["ico"];if(!t.isAjaxing){var o=data.nodeIsParent(e,t);n[0]=(t.iconSkin?t.iconSkin+"_":"")+n[0],o?n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE):n.push(consts.folder.DOCU)}return t.class+" "+n.join("_")},makeNodeIcoStyle:function(e,t){var n=[];if(!t.isAjaxing){var o=data.nodeIsParent(e,t)&&t.iconOpen&&t.iconClose?t.open?t.iconOpen:t.iconClose:t[e.data.key.icon];o&&n.push("background:url(",o,") 0 0 no-repeat;"),0!=e.view.showIcon&&tools.apply(e.view.showIcon,[e.treeId,t],!0)||n.push("width:0px;height:0px;")}return n.join("")},makeNodeLineClass:function(e,t){var n=[];return e.view.showLine?0==t.level&&t.isFirstNode&&t.isLastNode?n.push(consts.line.ROOT):0==t.level&&t.isFirstNode?n.push(consts.line.ROOTS):t.isLastNode?n.push(consts.line.BOTTOM):n.push(consts.line.CENTER):n.push(consts.line.NOLINE),data.nodeIsParent(e,t)?n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE):n.push(consts.folder.DOCU),view.makeNodeLineClassEx(t)+n.join("_")},makeNodeLineClassEx:function(e){return consts.className.BUTTON+" "+consts.className.LEVEL+e.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(e){return e.target||"_blank"},makeNodeUrl:function(e,t){var n=e.data.key.url;return t[n]?t[n]:null},makeUlHtml:function(e,t,n,o){n.push("<ul id='",t.tId,consts.id.UL,"' class='",consts.className.LEVEL,t.level," ",view.makeUlLineClass(e,t),"' style='display:",t.open?"block":"none","'>"),n.push(o),n.push("</ul>")},makeUlLineClass:function(e,t){return e.view.showLine&&!t.isLastNode?consts.line.LINE:""},removeChildNodes:function(e,t){if(t){var n=data.nodeChildren(e,t);if(n){for(var o=0,a=n.length;o<a;o++)data.removeNodeCache(e,n[o]);if(data.removeSelectedNode(e),delete t[e.data.key.children],e.data.keep.parent)$$(t,consts.id.UL,e).empty();else{data.nodeIsParent(e,t,!1),t.open=!1;var i=$$(t,consts.id.SWITCH,e),d=$$(t,consts.id.ICON,e);view.replaceSwitchClass(t,i,consts.folder.DOCU),view.replaceIcoClass(t,d,consts.folder.DOCU),$$(t,consts.id.UL,e).remove()}}}},scrollIntoView:function(e,t){if(t)if("undefined"!=typeof Element)Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){"use strict";function t(e,t){return{start:e,length:t,end:e+t}}function n(t,n){return!1===e||n.start<t.end&&t.start<n.end?Math.max(t.end-n.length,Math.min(n.start,t.start)):(t.start+t.end-n.length)/2}function o(e,t){return{x:e,y:t,translate:function(n,a){return o(e+n,t+a)}}}function a(e,t){for(;e;)t=t.translate(e.offsetLeft,e.offsetTop),e=e.offsetParent;return t}for(var i,d=a(this,o(0,0)),r=o(this.offsetWidth,this.offsetHeight),s=this.parentNode;s instanceof HTMLElement;)i=a(s,o(s.clientLeft,s.clientTop)),s.scrollLeft=n(t(d.x-i.x,r.x),t(s.scrollLeft,s.clientWidth)),s.scrollTop=n(t(d.y-i.y,r.y),t(s.scrollTop,s.clientHeight)),d=d.translate(-s.scrollLeft,-s.scrollTop),s=s.parentNode}),t.scrollIntoViewIfNeeded();else{var n=e.treeObj.get(0).getBoundingClientRect(),o=t.getBoundingClientRect();(o.top<n.top||o.bottom>n.bottom||o.right>n.right||o.left<n.left)&&t.scrollIntoView()}},setFirstNode:function(e,t){var n=data.nodeChildren(e,t);n.length>0&&(n[0].isFirstNode=!0)},setLastNode:function(e,t){var n=data.nodeChildren(e,t);n.length>0&&(n[n.length-1].isLastNode=!0)},removeNode:function(e,t){var n=data.getRoot(e),o=t.parentTId?t.getParentNode():n;if(t.isFirstNode=!1,t.isLastNode=!1,t.getPreNode=function(){return null},t.getNextNode=function(){return null},data.getNodeCache(e,t.tId)){$$(t,e).remove(),data.removeNodeCache(e,t),data.removeSelectedNode(e,t);for(var a=data.nodeChildren(e,o),i=0,d=a.length;i<d;i++)if(a[i].tId==t.tId){a.splice(i,1);break}view.setFirstNode(e,o),view.setLastNode(e,o);var r,s,l,c=a.length;if(e.data.keep.parent||0!=c){if(e.view.showLine&&c>0){var u=a[c-1];if(r=$$(u,consts.id.UL,e),s=$$(u,consts.id.SWITCH,e),l=$$(u,consts.id.ICON,e),o==n)if(1==a.length)view.replaceSwitchClass(u,s,consts.line.ROOT);else{var p=$$(a[0],consts.id.SWITCH,e);view.replaceSwitchClass(a[0],p,consts.line.ROOTS),view.replaceSwitchClass(u,s,consts.line.BOTTOM)}else view.replaceSwitchClass(u,s,consts.line.BOTTOM);r.removeClass(consts.line.LINE)}}else data.nodeIsParent(e,o,!1),o.open=!1,delete o[e.data.key.children],r=$$(o,consts.id.UL,e),s=$$(o,consts.id.SWITCH,e),l=$$(o,consts.id.ICON,e),view.replaceSwitchClass(o,s,consts.folder.DOCU),view.replaceIcoClass(o,l,consts.folder.DOCU),r.css("display","none")}},replaceIcoClass:function(e,t,n){if(t&&!e.isAjaxing){var o=t.attr("class");if(null!=o){var a=o.split("_");switch(n){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:a[a.length-1]=n}t.attr("class",a.join("_"))}}},replaceSwitchClass:function(e,t,n){if(t){var o=t.attr("class");if(null!=o){var a=o.split("_");switch(n){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:a[0]=view.makeNodeLineClassEx(e)+n;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:a[1]=n}t.attr("class",a.join("_")),n!==consts.folder.DOCU?t.removeAttr("disabled"):t.attr("disabled","disabled")}}},selectNode:function(e,t,n){n||view.cancelPreSelectedNode(e,null,t),$$(t,consts.id.A,e).addClass(consts.node.CURSELECTED),data.addSelectedNode(e,t),e.treeObj.trigger(consts.event.SELECTED,[e.treeId,t])},setNodeFontCss:function(e,t){var n=$$(t,consts.id.A,e),o=view.makeNodeFontCss(e,t);o&&n.css(o)},setNodeLineIcos:function(e,t){if(t){var n=$$(t,consts.id.SWITCH,e),o=$$(t,consts.id.UL,e),a=$$(t,consts.id.ICON,e),i=view.makeUlLineClass(e,t);0==i.length?o.removeClass(consts.line.LINE):o.addClass(i),n.attr("class",view.makeNodeLineClass(e,t)),data.nodeIsParent(e,t)?n.removeAttr("disabled"):n.attr("disabled","disabled"),a.removeAttr("style"),a.attr("style",view.makeNodeIcoStyle(e,t)),a.attr("class",view.makeNodeIcoClass(e,t))}},setNodeName:function(e,t){var n=data.nodeTitle(e,t),o=$$(t,consts.id.SPAN,e);(o.empty(),e.view.nameIsHTML?o.html(data.nodeName(e,t)):o.text(data.nodeName(e,t)),tools.apply(e.view.showTitle,[e.treeId,t],e.view.showTitle))&&$$(t,consts.id.A,e).attr("title",n||"")},setNodeTarget:function(e,t){$$(t,consts.id.A,e).attr("target",view.makeNodeTarget(t))},setNodeUrl:function(e,t){var n=$$(t,consts.id.A,e),o=view.makeNodeUrl(e,t);null==o||0==o.length?n.removeAttr("href"):n.attr("href",o)},switchNode:function(e,t){if(t.open||!tools.canAsync(e,t))view.expandCollapseNode(e,t,!t.open);else if(e.async.enable){if(!view.asyncNode(e,t))return void view.expandCollapseNode(e,t,!t.open)}else t&&view.expandCollapseNode(e,t,!t.open)}},tree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(e){var t=data.getZTreeTools(e);return t||null},destroy:function(e){if(e&&e.length>0)view.destroy(data.getSetting(e));else for(var t in settings)view.destroy(settings[t])},init:function(e,t,n){var o=tools.clone(_setting);$.extend(!0,o,t),o.treeId=e.attr("id"),o.treeObj=e,o.treeObj.empty(),settings[o.treeId]=o,void 0===document.body.style.maxHeight&&(o.view.expandSpeed=""),data.initRoot(o);var a=data.getRoot(o);n=n?tools.clone(tools.isArray(n)?n:[n]):[],o.data.simpleData.enable?data.nodeChildren(o,a,data.transformTozTreeFormat(o,n)):data.nodeChildren(o,a,n),data.initCache(o),event.unbindTree(o),event.bindTree(o),event.unbindEvent(o),event.bindEvent(o);var i={setting:o,addNodes:function(e,t,n,a){e||(e=null);var i=data.nodeIsParent(o,e);if(e&&!i&&o.data.keep.leaf)return null;var d=parseInt(t,10);if(isNaN(d)?(a=!!n,n=t,t=-1):t=d,!n)return null;var r=tools.clone(tools.isArray(n)?n:[n]);function s(){view.addNodes(o,e,t,r,1==a)}return tools.canAsync(o,e)?view.asyncNode(o,e,a,s):s(),r},cancelSelectedNode:function(e){view.cancelPreSelectedNode(o,e)},destroy:function(){view.destroy(o)},expandAll:function(e){return e=!!e,view.expandCollapseSonNode(o,null,e,!0),e},expandNode:function(e,t,n,a,i){return e&&data.nodeIsParent(o,e)?(!0!==t&&!1!==t&&(t=!e.open),(i=!!i)&&t&&0==tools.apply(o.callback.beforeExpand,[o.treeId,e],!0)||i&&!t&&0==tools.apply(o.callback.beforeCollapse,[o.treeId,e],!0)?null:(t&&e.parentTId&&view.expandCollapseParentNode(o,e.getParentNode(),t,!1),t!==e.open||n?(data.getRoot(o).expandTriggerFlag=i,!tools.canAsync(o,e)&&n?view.expandCollapseSonNode(o,e,t,!0,d):(e.open=!t,view.switchNode(this.setting,e),d()),t):null)):null;function d(){var t=$$(e,o).get(0);t&&!1!==a&&view.scrollIntoView(o,t)}},getNodes:function(){return data.getNodes(o)},getNodeByParam:function(e,t,n){return e?data.getNodeByParam(o,n?data.nodeChildren(o,n):data.getNodes(o),e,t):null},getNodeByTId:function(e){return data.getNodeCache(o,e)},getNodesByParam:function(e,t,n){return e?data.getNodesByParam(o,n?data.nodeChildren(o,n):data.getNodes(o),e,t):null},getNodesByParamFuzzy:function(e,t,n){return e?data.getNodesByParamFuzzy(o,n?data.nodeChildren(o,n):data.getNodes(o),e,t):null},getNodesByFilter:function(e,t,n,a){return t=!!t,e&&"function"==typeof e?data.getNodesByFilter(o,n?data.nodeChildren(o,n):data.getNodes(o),e,t,a):t?null:[]},getNodeIndex:function(e){if(!e)return null;for(var t=e.parentTId?e.getParentNode():data.getRoot(o),n=data.nodeChildren(o,t),a=0,i=n.length;a<i;a++)if(n[a]==e)return a;return-1},getSelectedNodes:function(){for(var e=[],t=data.getRoot(o).curSelectedList,n=0,a=t.length;n<a;n++)e.push(t[n]);return e},getSelectedNode:function(){return i.getSelectedNodes()[0]},isSelectedNode:function(e){return data.isSelectedNode(o,e)},reAsyncChildNodesPromise:function(e,t,n){return new Promise((function(o,a){try{i.reAsyncChildNodes(e,t,n,(function(){o(e)}))}catch(e){a(e)}}))},reAsyncChildNodes:function(e,t,n,a){if(this.setting.async.enable){var i=!e;if(i&&(e=data.getRoot(o)),"refresh"==t){for(var d=data.nodeChildren(o,e),r=0,s=d?d.length:0;r<s;r++)data.removeNodeCache(o,d[r]);if(data.removeSelectedNode(o),data.nodeChildren(o,e,[]),i)this.setting.treeObj.empty();else $$(e,consts.id.UL,o).empty()}view.asyncNode(this.setting,i?null:e,!!n,a)}},refresh:function(){this.setting.treeObj.empty();var e=data.getRoot(o),t=data.nodeChildren(o,e);data.initRoot(o),data.nodeChildren(o,e,t),data.initCache(o),view.createNodes(o,0,data.nodeChildren(o,e),null,-1)},removeChildNodes:function(e){if(!e)return null;var t=data.nodeChildren(o,e);return view.removeChildNodes(o,e),t||null},removeNode:function(e,t){e&&((t=!!t)&&0==tools.apply(o.callback.beforeRemove,[o.treeId,e],!0)||(view.removeNode(o,e),t&&this.setting.treeObj.trigger(consts.event.REMOVE,[o.treeId,e])))},selectNode:function(e,t,n){if(e&&tools.uCanDo(o)){if(t=o.view.selectedMulti&&t,e.parentTId)view.expandCollapseParentNode(o,e.getParentNode(),!0,!1,(function(){if(n)return;var t=$$(e,o).get(0);view.scrollIntoView(o,t)}));else if(!n)try{$$(e,o).focus().blur()}catch(e){}view.selectNode(o,e,t)}},transformTozTreeNodes:function(e){return data.transformTozTreeFormat(o,e)},transformToArray:function(e){return data.transformToArrayFormat(o,e)},updateNode:function(e,t){e&&($$(e,o).get(0)&&tools.uCanDo(o)&&(view.setNodeName(o,e),view.setNodeTarget(o,e),view.setNodeUrl(o,e),view.setNodeLineIcos(o,e),view.setNodeFontCss(o,e)))}};a.treeTools=i,data.setZTreeTools(o,i);var d=data.nodeChildren(o,a);return d&&d.length>0?view.createNodes(o,0,d,null,-1):o.async.enable&&o.async.url&&""!==o.async.url&&view.asyncNode(o),i}};var zt=tree,$$=tools.$,consts=zt.consts;return{tree:tree,consts:consts,tools:tools.$}}(),excheck=function(){var e={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},t={check:{enable:!1,autoCheckTrigger:!1,chkStyle:e.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:e.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},n={onCheckNode:function(e,t){if(!0===t.chkDisabled)return!1;var n=s.getSetting(e.data.treeId);if(0==i.apply(n.callback.beforeCheck,[n.treeId,t],!0))return!0;var o=s.nodeChecked(n,t);s.nodeChecked(n,t,!o),r.checkNodeRelation(n,t);var a=l(t,d.id.CHECK,n);return r.setChkClass(n,a,t),r.repairParentChkClassWithSelf(n,t),n.treeObj.trigger(d.event.CHECK,[e,n.treeId,t]),!0},onMouseoverCheck:function(e,t){if(!0===t.chkDisabled)return!1;var n=s.getSetting(e.data.treeId),o=l(t,d.id.CHECK,n);return t.check_Focus=!0,r.setChkClass(n,o,t),!0},onMouseoutCheck:function(e,t){if(!0===t.chkDisabled)return!1;var n=s.getSetting(e.data.treeId),o=l(t,d.id.CHECK,n);return t.check_Focus=!1,r.setChkClass(n,o,t),!0}},o={tools:{},view:{checkNodeRelation:function(e,t){var n,o,a,i=d.radio,c=s.nodeChecked(e,t);if(e.check.chkStyle==i.STYLE){var u=s.getRadioCheckedList(e);if(c)if(e.check.radioType==i.TYPE_ALL){for(o=u.length-1;o>=0;o--){n=u[o],s.nodeChecked(e,n)&&n!=t&&(s.nodeChecked(e,n,!1),u.splice(o,1),r.setChkClass(e,l(n,d.id.CHECK,e),n),n.parentTId!=t.parentTId&&r.repairParentChkClassWithSelf(e,n))}u.push(t)}else{var p=t.parentTId?t.getParentNode():s.getRoot(e);for(o=0,a=(g=s.nodeChildren(e,p)).length;o<a;o++){n=g[o],s.nodeChecked(e,n)&&n!=t&&(s.nodeChecked(e,n,!1),r.setChkClass(e,l(n,d.id.CHECK,e),n))}}else if(e.check.radioType==i.TYPE_ALL)for(o=0,a=u.length;o<a;o++)if(t==u[o]){u.splice(o,1);break}}else{var g=s.nodeChildren(e,t);c&&(!g||0==g.length||e.check.chkboxType.Y.indexOf("s")>-1)&&r.setSonNodeCheckBox(e,t,!0),c||g&&0!=g.length&&!(e.check.chkboxType.N.indexOf("s")>-1)||r.setSonNodeCheckBox(e,t,!1),c&&e.check.chkboxType.Y.indexOf("p")>-1&&r.setParentNodeCheckBox(e,t,!0),!c&&e.check.chkboxType.N.indexOf("p")>-1&&r.setParentNodeCheckBox(e,t,!1)}},makeChkClass:function(e,t){var n=d.checkbox,o=d.radio,a="",i=s.nodeChecked(e,t);a=!0===t.chkDisabled?n.DISABLED:t.halfCheck?n.PART:e.check.chkStyle==o.STYLE?t.check_Child_State<1?n.FULL:n.PART:i?2===t.check_Child_State||-1===t.check_Child_State?n.FULL:n.PART:t.check_Child_State<1?n.FULL:n.PART;var r=e.check.chkStyle+"_"+(i?n.TRUE:n.FALSE)+"_"+a;return r=t.check_Focus&&!0!==t.chkDisabled?r+"_"+n.FOCUS:r,d.className.BUTTON+" "+n.DEFAULT+" "+r},repairAllChk:function(e,t){if(e.check.enable&&e.check.chkStyle===d.checkbox.STYLE)for(var n=s.getRoot(e),o=s.nodeChildren(e,n),a=0,i=o.length;a<i;a++){var l=o[a];!0!==l.nocheck&&!0!==l.chkDisabled&&s.nodeChecked(e,l,t),r.setSonNodeCheckBox(e,l,t)}},repairChkClass:function(e,t){if(t&&(s.makeChkFlag(e,t),!0!==t.nocheck)){var n=l(t,d.id.CHECK,e);r.setChkClass(e,n,t)}},repairParentChkClass:function(e,t){if(t&&t.parentTId){var n=t.getParentNode();r.repairChkClass(e,n),r.repairParentChkClass(e,n)}},repairParentChkClassWithSelf:function(e,t){if(t){var n=s.nodeChildren(e,t);n&&n.length>0?r.repairParentChkClass(e,n[0]):r.repairParentChkClass(e,t)}},repairSonChkDisabled:function(e,t,n,o){if(t){t.chkDisabled!=n&&(t.chkDisabled=n),r.repairChkClass(e,t);var a=s.nodeChildren(e,t);if(a&&o)for(var i=0,d=a.length;i<d;i++){var l=a[i];r.repairSonChkDisabled(e,l,n,o)}}},repairParentChkDisabled:function(e,t,n,o){t&&(t.chkDisabled!=n&&o&&(t.chkDisabled=n),r.repairChkClass(e,t),r.repairParentChkDisabled(e,t.getParentNode(),n,o))},setChkClass:function(e,t,n){t&&(!0===n.nocheck?t.hide():t.show(),t.attr("class",r.makeChkClass(e,n)))},setParentNodeCheckBox:function(e,t,n,o){var a=l(t,d.id.CHECK,e);if(o||(o=t),s.makeChkFlag(e,t),!0!==t.nocheck&&!0!==t.chkDisabled&&(s.nodeChecked(e,t,n),r.setChkClass(e,a,t),e.check.autoCheckTrigger&&t!=o&&e.treeObj.trigger(d.event.CHECK,[null,e.treeId,t])),t.parentTId){var i=!0;if(!n)for(var c=s.nodeChildren(e,t.getParentNode()),u=0,p=c.length;u<p;u++){var g=c[u],h=s.nodeChecked(e,g);if(!0!==g.nocheck&&!0!==g.chkDisabled&&h||(!0===g.nocheck||!0===g.chkDisabled)&&g.check_Child_State>0){i=!1;break}}i&&r.setParentNodeCheckBox(e,t.getParentNode(),n,o)}},setSonNodeCheckBox:function(e,t,n,o){if(t){var a=l(t,d.id.CHECK,e);o||(o=t);var i=!1,c=s.nodeChildren(e,t);if(c)for(var u=0,p=c.length;u<p;u++){var g=c[u];r.setSonNodeCheckBox(e,g,n,o),!0===g.chkDisabled&&(i=!0)}t!=s.getRoot(e)&&!0!==t.chkDisabled&&(i&&!0!==t.nocheck&&s.makeChkFlag(e,t),!0!==t.nocheck&&!0!==t.chkDisabled?(s.nodeChecked(e,t,n),i||(t.check_Child_State=c&&c.length>0?n?2:0:-1)):t.check_Child_State=-1,r.setChkClass(e,a,t),e.check.autoCheckTrigger&&t!=o&&!0!==t.nocheck&&!0!==t.chkDisabled&&e.treeObj.trigger(d.event.CHECK,[null,e.treeId,t]))}}},event:{},data:{getRadioCheckedList:function(e){for(var t=s.getRoot(e).radioCheckedList,n=0,o=t.length;n<o;n++)s.getNodeCache(e,t[n].tId)||(t.splice(n,1),n--,o--);return t},getCheckStatus:function(e,t){if(!e.check.enable||t.nocheck||t.chkDisabled)return null;var n=s.nodeChecked(e,t);return{checked:n,half:t.halfCheck?t.halfCheck:e.check.chkStyle==d.radio.STYLE?2===t.check_Child_State:n?t.check_Child_State>-1&&t.check_Child_State<2:t.check_Child_State>0}},getTreeCheckedNodes:function(e,t,n,o){if(!t)return[];var a=n&&e.check.chkStyle==d.radio.STYLE&&e.check.radioType==d.radio.TYPE_ALL;o=o||[];for(var i=0,r=t.length;i<r;i++){var l=t[i],c=s.nodeChildren(e,l),u=s.nodeChecked(e,l);if(!0!==l.nocheck&&!0!==l.chkDisabled&&u==n&&(o.push(l),a))break;if(s.getTreeCheckedNodes(e,c,n,o),a&&o.length>0)break}return o},getTreeChangeCheckedNodes:function(e,t,n){if(!t)return[];n=n||[];for(var o=0,a=t.length;o<a;o++){var i=t[o],d=s.nodeChildren(e,i),r=s.nodeChecked(e,i);!0!==i.nocheck&&!0!==i.chkDisabled&&r!=i.checkedOld&&n.push(i),s.getTreeChangeCheckedNodes(e,d,n)}return n},makeChkFlag:function(e,t){if(t){var n=-1,o=s.nodeChildren(e,t);if(o)for(var a=0,i=o.length;a<i;a++){var r=o[a],l=s.nodeChecked(e,r),c=-1;if(e.check.chkStyle==d.radio.STYLE){if(2==(c=!0===r.nocheck||!0===r.chkDisabled?r.check_Child_State:!0===r.halfCheck||l||r.check_Child_State>0?2:0)){n=2;break}0==c&&(n=0)}else if(e.check.chkStyle==d.checkbox.STYLE){if(1===(c=!0===r.nocheck||!0===r.chkDisabled?r.check_Child_State:!0===r.halfCheck?1:l?-1===r.check_Child_State||2===r.check_Child_State?2:1:r.check_Child_State>0?1:0)){n=1;break}if(2===c&&n>-1&&a>0&&c!==n){n=1;break}if(2===n&&c>-1&&c<2){n=1;break}c>-1&&(n=c)}}t.check_Child_State=n}}}};$.extend(!0,tree.tree.consts,e),$.extend(!0,tree.tree._z,o);var a=tree.tree,i=a._z.tools,d=a.consts,r=a._z.view,s=a._z.data,l=(a._z.event,i.$);s.nodeChecked=function(e,t,n){if(!t)return!1;var o=e.data.key.checked;return void 0!==n?("string"==typeof n&&(n=i.eqs(n,"true")),n=!!n,t[o]=n):"string"==typeof t[o]?t[o]=i.eqs(t[o],"true"):t[o]=!!t[o],t[o]},s.exSetting(t),s.addInitBind((function(e){var t=e.treeObj,n=d.event;t.bind(n.CHECK,(function(t,n,o,a){t.srcEvent=n,i.apply(e.callback.onCheck,[t,o,a])}))})),s.addInitUnBind((function(e){var t=e.treeObj,n=d.event;t.unbind(n.CHECK)})),s.addInitCache((function(e){})),s.addInitNode((function(e,t,n,o,a,r,l){if(n){var c=s.nodeChecked(e,n);if(n.checkedOld=c,"string"==typeof n.nocheck&&(n.nocheck=i.eqs(n.nocheck,"true")),n.nocheck=!!n.nocheck||e.check.nocheckInherit&&o&&!!o.nocheck,"string"==typeof n.chkDisabled&&(n.chkDisabled=i.eqs(n.chkDisabled,"true")),n.chkDisabled=!!n.chkDisabled||e.check.chkDisabledInherit&&o&&!!o.chkDisabled,"string"==typeof n.halfCheck&&(n.halfCheck=i.eqs(n.halfCheck,"true")),n.halfCheck=!!n.halfCheck,n.check_Child_State=-1,n.check_Focus=!1,n.getCheckStatus=function(){return s.getCheckStatus(e,n)},e.check.chkStyle==d.radio.STYLE&&e.check.radioType==d.radio.TYPE_ALL&&c)s.getRoot(e).radioCheckedList.push(n)}})),s.addInitProxy((function(e){var t=e.target,o=s.getSetting(e.data.treeId),a="",r=null,l="",c=null;if(i.eqs(e.type,"mouseover")?o.check.enable&&i.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+d.id.CHECK)&&(a=i.getNodeMainDom(t).id,l="mouseoverCheck"):i.eqs(e.type,"mouseout")?o.check.enable&&i.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+d.id.CHECK)&&(a=i.getNodeMainDom(t).id,l="mouseoutCheck"):i.eqs(e.type,"click")&&o.check.enable&&i.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+d.id.CHECK)&&(a=i.getNodeMainDom(t).id,l="checkNode"),a.length>0)switch(r=s.getNodeCache(o,a),l){case"checkNode":c=n.onCheckNode;break;case"mouseoverCheck":c=n.onMouseoverCheck;break;case"mouseoutCheck":c=n.onMouseoutCheck}return{stop:"checkNode"===l,node:r,nodeEventType:l,nodeEventCallback:c,treeEventType:"",treeEventCallback:null}}),!0),s.addInitRoot((function(e){s.getRoot(e).radioCheckedList=[]})),s.addBeforeA((function(e,t,n){e.check.enable&&(s.makeChkFlag(e,t),n.push("<span ID='",t.tId,d.id.CHECK,"' class='",r.makeChkClass(e,t),"' treeNode",d.id.CHECK,!0===t.nocheck?" style='display:none;'":"","></span>"))})),s.addZTreeTools((function(e,t){t.checkNode=function(t,n,o,a){var c=s.nodeChecked(e,t);if(!0!==t.chkDisabled&&(!0!==n&&!1!==n&&(n=!c),a=!!a,(c!==n||o)&&(!a||0!=i.apply(this.setting.callback.beforeCheck,[this.setting.treeId,t],!0))&&i.uCanDo(this.setting)&&this.setting.check.enable&&!0!==t.nocheck)){s.nodeChecked(e,t,n);var u=l(t,d.id.CHECK,this.setting);(o||this.setting.check.chkStyle===d.radio.STYLE)&&r.checkNodeRelation(this.setting,t),r.setChkClass(this.setting,u,t),r.repairParentChkClassWithSelf(this.setting,t),a&&this.setting.treeObj.trigger(d.event.CHECK,[null,this.setting.treeId,t])}},t.checkAllNodes=function(e){r.repairAllChk(this.setting,!!e)},t.getCheckedNodes=function(t){t=!1!==t;var n=s.nodeChildren(e,s.getRoot(this.setting));return s.getTreeCheckedNodes(this.setting,n,t)},t.getChangeCheckedNodes=function(){var t=s.nodeChildren(e,s.getRoot(this.setting));return s.getTreeChangeCheckedNodes(this.setting,t)},t.setChkDisabled=function(e,t,n,o){t=!!t,n=!!n,o=!!o,r.repairSonChkDisabled(this.setting,e,t,o),r.repairParentChkDisabled(this.setting,e.getParentNode(),t,n)};var n=t.updateNode;t.updateNode=function(e,o){if((n&&n.apply(t,arguments),e&&this.setting.check.enable)&&(l(e,this.setting).get(0)&&i.uCanDo(this.setting))){var a=l(e,d.id.CHECK,this.setting);1!=o&&this.setting.check.chkStyle!==d.radio.STYLE||r.checkNodeRelation(this.setting,e),r.setChkClass(this.setting,a,e),r.repairParentChkClassWithSelf(this.setting,e)}}}));var c=r.createNodes;r.createNodes=function(e,t,n,o,a){c&&c.apply(r,arguments),n&&r.repairParentChkClassWithSelf(e,o)};var u=r.removeNode;r.removeNode=function(e,t){var n=t.getParentNode();u&&u.apply(r,arguments),t&&n&&(r.repairChkClass(e,n),r.repairParentChkClass(e,n))};var p=r.appendNodes;r.appendNodes=function(e,t,n,o,a,i,d){var l="";return p&&(l=p.apply(r,arguments)),o&&s.makeChkFlag(e,o),l}}(),exedit=function(){var e={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}};_initCache=function(e){},_bindEvent=function(e){var t=e.treeObj,a=o.event;t.bind(a.RENAME,(function(t,o,a,i){n.apply(e.callback.onRename,[t,o,a,i])})),t.bind(a.DRAG,(function(t,o,a,i){n.apply(e.callback.onDrag,[o,a,i])})),t.bind(a.DRAGMOVE,(function(t,o,a,i){n.apply(e.callback.onDragMove,[o,a,i])})),t.bind(a.DROP,(function(t,o,a,i,d,r,s){n.apply(e.callback.onDrop,[o,a,i,d,r,s])}))},_unbindEvent=function(e){var t=e.treeObj,n=o.event;t.unbind(n.RENAME),t.unbind(n.DRAG),t.unbind(n.DRAGMOVE),t.unbind(n.DROP)},_eventProxy=function(e){var t=e.target,a=i.getSetting(e.data.treeId),d=e.relatedTarget,r="",s=null,l="",c=null,u=null;if(n.eqs(e.type,"mouseover")?(u=n.getMDom(a,t,[{tagName:"a",attrName:"treeNode"+o.id.A}]))&&(r=n.getNodeMainDom(u).id,l="hoverOverNode"):n.eqs(e.type,"mouseout")?(u=n.getMDom(a,d,[{tagName:"a",attrName:"treeNode"+o.id.A}]))||(r="remove",l="hoverOutNode"):n.eqs(e.type,"mousedown")&&(u=n.getMDom(a,t,[{tagName:"a",attrName:"treeNode"+o.id.A}]))&&(r=n.getNodeMainDom(u).id,l="mousedownNode"),r.length>0)switch(s=i.getNodeCache(a,r),l){case"mousedownNode":c=_handler.onMousedownNode;break;case"hoverOverNode":c=_handler.onHoverOverNode;break;case"hoverOutNode":c=_handler.onHoverOutNode}return{stop:!1,node:s,nodeEventType:l,nodeEventCallback:c,treeEventType:"",treeEventCallback:null}},_initNode=function(e,t,n,o,a,i,d){n&&(n.isHover=!1,n.editNameFlag=!1)},_zTreeTools=function(e,t){t.cancelEditName=function(e){i.getRoot(this.setting).curEditNode&&a.cancelCurEditNode(this.setting,e||null,!0)},t.copyNode=function(t,d,r,s){if(!d)return null;var l=i.nodeIsParent(e,t);if(t&&!l&&this.setting.data.keep.leaf&&r===o.move.TYPE_INNER)return null;var c=this,u=n.clone(d);if(t||(t=null,r=o.move.TYPE_INNER),r==o.move.TYPE_INNER){function p(){a.addNodes(c.setting,t,-1,[u],s)}n.canAsync(this.setting,t)?a.asyncNode(this.setting,t,s,p):p()}else a.addNodes(this.setting,t.parentNode,-1,[u],s),a.moveNode(this.setting,t,u,r,!1,s);return u},t.editName=function(e){e&&e.tId&&e===i.getNodeCache(this.setting,e.tId)&&(e.parentTId&&a.expandCollapseParentNode(this.setting,e.getParentNode(),!0),a.editNode(this.setting,e))},t.moveNode=function(t,r,s,l){if(!r)return r;var c=i.nodeIsParent(e,t);if(t&&!c&&this.setting.data.keep.leaf&&s===o.move.TYPE_INNER)return null;if(t&&(r.parentTId==t.tId&&s==o.move.TYPE_INNER||d(r,this.setting).find("#"+t.tId).length>0))return null;t||(t=null);var u=this;function p(){a.moveNode(u.setting,t,r,s,!1,l)}return n.canAsync(this.setting,t)&&s===o.move.TYPE_INNER?a.asyncNode(this.setting,t,l,p):p(),r},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}},_data={setSonNodeLevel:function(e,t,n){if(n){var o=i.nodeChildren(e,n);if(n.level=t?t.level+1:0,o)for(var a=0,d=o.length;a<d;a++)o[a]&&i.setSonNodeLevel(e,n,o[a])}}},_event={},_handler={onHoverOverNode:function(e,t){var n=i.getSetting(e.data.treeId),o=i.getRoot(n);o.curHoverNode!=t&&_handler.onHoverOutNode(e),o.curHoverNode=t,a.addHoverDom(n,t)},onHoverOutNode:function(e,t){var n=i.getSetting(e.data.treeId),o=i.getRoot(n);o.curHoverNode&&!i.isSelectedNode(n,o.curHoverNode)&&(a.removeTreeDom(n,o.curHoverNode),o.curHoverNode=null)},onMousedownNode:function(t,r){var s,l,c=i.getSetting(t.data.treeId),u=i.getRoot(c),p=i.getRoots();if(2==t.button||!c.edit.enable||!c.edit.drag.isCopy&&!c.edit.drag.isMove)return!0;var g=t.target,h=i.getRoot(c).curSelectedList,f=[];if(i.isSelectedNode(c,r))for(s=0,l=h.length;s<l;s++){if(h[s].editNameFlag&&n.eqs(g.tagName,"input")&&null!==g.getAttribute("treeNode"+o.id.INPUT))return!0;if(f.push(h[s]),f[0].parentTId!==h[s].parentTId){f=[r];break}}else f=[r];a.editNodeBlur=!0,a.cancelCurEditNode(c);var m,v,b,N,y,C=$(c.treeObj.get(0).ownerDocument),k=$(c.treeObj.get(0).ownerDocument.body),w=!1,T=c,E=c,I=null,P=null,D=null,x=o.move.TYPE_INNER,_=t.clientX,S=t.clientY,R=(new Date).getTime();function A(t){if(0==u.dragFlag&&Math.abs(_-t.clientX)<c.edit.drag.minMoveSize&&Math.abs(S-t.clientY)<c.edit.drag.minMoveSize)return!0;var r,s,l,g,h;if(k.css("cursor","pointer"),0==u.dragFlag){if(0==n.apply(c.callback.beforeDrag,[c.treeId,f],!0))return O(t),!0;for(r=0,s=f.length;r<s;r++)0==r&&(u.dragNodeShowBefore=[]),l=f[r],i.nodeIsParent(c,l)&&l.open?(a.expandCollapseNode(c,l,!l.open),u.dragNodeShowBefore[l.tId]=!0):u.dragNodeShowBefore[l.tId]=!1;u.dragFlag=1,p.showHoverDom=!1,n.showIfameMask(c,!0);var E=!0,A=-1;if(f.length>1){var L=f[0].parentTId?i.nodeChildren(c,f[0].getParentNode()):i.getNodes(c);for(h=[],r=0,s=L.length;r<s;r++)if(void 0!==u.dragNodeShowBefore[L[r].tId]&&(E&&A>-1&&A+1!==r&&(E=!1),h.push(L[r]),A=r),f.length===h.length){f=h;break}}for(E&&(N=f[0].getPreNode(),y=f[f.length-1].getNextNode()),m=d("<ul class='zTreeDragUL'></ul>",c),r=0,s=f.length;r<s;r++)(l=f[r]).editNameFlag=!1,a.selectNode(c,l,r>0),a.removeTreeDom(c,l),r>c.edit.drag.maxShowNodeNum-1||((g=d("<li id='"+l.tId+"_tmp'></li>",c)).append(d(l,o.id.A,c).clone()),g.css("padding","0"),g.children("#"+l.tId+o.id.A).removeClass(o.node.CURSELECTED),m.append(g),r==c.edit.drag.maxShowNodeNum-1&&(g=d("<li id='"+l.tId+"_moretmp'><a>  ...  </a></li>",c),m.append(g)));m.attr("id",f[0].tId+o.id.UL+"_tmp"),m.addClass(c.treeObj.attr("class")),m.appendTo(k),(v=d("<span class='tmpzTreeMove_arrow'></span>",c)).attr("id","zTreeMove_arrow_tmp"),v.appendTo(k),c.treeObj.trigger(o.event.DRAG,[t,c.treeId,f])}if(1==u.dragFlag){if(b&&v.attr("id")==t.target.id&&D&&t.clientX+C.scrollLeft()+2>$("#"+D+o.id.A,b).offset().left){var M=$("#"+D+o.id.A,b);t.target=M.length>0?M.get(0):t.target}else b&&(b.removeClass(o.node.TMPTARGET_TREE),D&&$("#"+D+o.id.A,b).removeClass(o.node.TMPTARGET_NODE+"_"+o.move.TYPE_PREV).removeClass(o.node.TMPTARGET_NODE+"_"+e.move.TYPE_NEXT).removeClass(o.node.TMPTARGET_NODE+"_"+e.move.TYPE_INNER));b=null,D=null,w=!1,T=c;var j=i.getSettings();for(var B in j)j[B].treeId&&j[B].edit.enable&&j[B].treeId!=c.treeId&&(t.target.id==j[B].treeId||$(t.target).parents("#"+j[B].treeId).length>0)&&(w=!0,T=j[B]);var z=C.scrollTop(),X=C.scrollLeft(),U=T.treeObj.offset(),F=T.treeObj.get(0).scrollHeight,H=T.treeObj.get(0).scrollWidth,Y=t.clientY+z-U.top,W=T.treeObj.height()+U.top-t.clientY-z,V=t.clientX+X-U.left,K=T.treeObj.width()+U.left-t.clientX-X,q=Y<c.edit.drag.borderMax&&Y>c.edit.drag.borderMin,G=W<c.edit.drag.borderMax&&W>c.edit.drag.borderMin,Z=V<c.edit.drag.borderMax&&V>c.edit.drag.borderMin,Q=K<c.edit.drag.borderMax&&K>c.edit.drag.borderMin,J=Y>c.edit.drag.borderMin&&W>c.edit.drag.borderMin&&V>c.edit.drag.borderMin&&K>c.edit.drag.borderMin,ee=q&&T.treeObj.scrollTop()<=0,te=G&&T.treeObj.scrollTop()+T.treeObj.height()+10>=F,ne=Z&&T.treeObj.scrollLeft()<=0,oe=Q&&T.treeObj.scrollLeft()+T.treeObj.width()+10>=H;if(t.target&&n.isChildOrSelf(t.target,T.treeId)){for(var ae=t.target;ae&&ae.tagName&&!n.eqs(ae.tagName,"li")&&ae.id!=T.treeId;)ae=ae.parentNode;var ie=!0;for(r=0,s=f.length;r<s;r++){if(l=f[r],ae.id===l.tId){ie=!1;break}if(d(l,c).find("#"+ae.id).length>0){ie=!1;break}}ie&&t.target&&n.isChildOrSelf(t.target,ae.id+o.id.A)&&(b=$(ae),D=ae.id)}l=f[0],J&&n.isChildOrSelf(t.target,T.treeId)&&(!b&&(t.target.id==T.treeId||ee||te||ne||oe)&&(w||!w&&l.parentTId)&&(b=T.treeObj),q?T.treeObj.scrollTop(T.treeObj.scrollTop()-10):G&&T.treeObj.scrollTop(T.treeObj.scrollTop()+10),Z?T.treeObj.scrollLeft(T.treeObj.scrollLeft()-10):Q&&T.treeObj.scrollLeft(T.treeObj.scrollLeft()+10),b&&b!=T.treeObj&&b.offset().left<T.treeObj.offset().left&&T.treeObj.scrollLeft(T.treeObj.scrollLeft()+b.offset().left-T.treeObj.offset().left)),m.css({top:t.clientY+z+3+"px",left:t.clientX+X+3+"px"});var de=0,re=0;if(b&&b.attr("id")!=T.treeId){var se=null==D?null:i.getNodeCache(T,D),le=(t.ctrlKey||t.metaKey)&&c.edit.drag.isMove&&c.edit.drag.isCopy||!c.edit.drag.isMove&&c.edit.drag.isCopy,ce=!(!N||D!==N.tId),ue=!(!y||D!==y.tId),pe=l.parentTId&&l.parentTId==D,ge=(le||!ue)&&n.apply(T.edit.drag.prev,[T.treeId,f,se],!!T.edit.drag.prev),he=(le||!ce)&&n.apply(T.edit.drag.next,[T.treeId,f,se],!!T.edit.drag.next),fe=(le||!pe)&&!(T.data.keep.leaf&&!i.nodeIsParent(c,se))&&n.apply(T.edit.drag.inner,[T.treeId,f,se],!!T.edit.drag.inner);function me(){b=null,D="",x=o.move.TYPE_INNER,v.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)}if(ge||he||fe){var ve=$("#"+D+o.id.A,b),be=se.isLastNode?null:$("#"+se.getNextNode().tId+o.id.A,b.next()),Ne=ve.offset().top,ye=ve.offset().left,Ce=ge?fe?.25:he?.5:1:-1,ke=he?fe?.75:ge?.5:0:-1,we=(t.clientY+z-Ne)/ve.height();if((1==Ce||we<=Ce&&we>=-.2)&&ge?(de=1-v.width(),re=Ne-v.height()/2,x=o.move.TYPE_PREV):(0==ke||we>=ke&&we<=1.2)&&he?(de=1-v.width(),re=null==be||i.nodeIsParent(c,se)&&se.open?Ne+ve.height()-v.height()/2:be.offset().top-v.height()/2,x=o.move.TYPE_NEXT):fe?(de=5-v.width(),re=Ne,x=o.move.TYPE_INNER):me(),b&&(v.css({display:"block",top:re+"px",left:ye+de+"px"}),ve.addClass(o.node.TMPTARGET_NODE+"_"+x),I==D&&P==x||(R=(new Date).getTime()),se&&i.nodeIsParent(c,se)&&x==o.move.TYPE_INNER)){var Te=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==se.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===se.tId&&(Te=!1),Te&&(window.zTreeMoveTimer=setTimeout((function(){x==o.move.TYPE_INNER&&se&&i.nodeIsParent(c,se)&&!se.open&&(new Date).getTime()-R>T.edit.drag.autoOpenTime&&n.apply(T.callback.beforeDragOpen,[T.treeId,se],!0)&&(a.switchNode(T,se),T.edit.drag.autoExpandTrigger&&T.treeObj.trigger(o.event.EXPAND,[T.treeId,se]))}),T.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=se.tId)}}else me()}else x=o.move.TYPE_INNER,b&&n.apply(T.edit.drag.inner,[T.treeId,f,null],!!T.edit.drag.inner)?b.addClass(o.node.TMPTARGET_TREE):b=null,v.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);I=D,P=x,c.treeObj.trigger(o.event.DRAGMOVE,[t,c.treeId,f])}return!1}function O(t){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),I=null,P=null,C.unbind("mousemove",A),C.unbind("mouseup",O),C.unbind("selectstart",L),k.css("cursor",""),b&&(b.removeClass(o.node.TMPTARGET_TREE),D&&$("#"+D+o.id.A,b).removeClass(o.node.TMPTARGET_NODE+"_"+o.move.TYPE_PREV).removeClass(o.node.TMPTARGET_NODE+"_"+e.move.TYPE_NEXT).removeClass(o.node.TMPTARGET_NODE+"_"+e.move.TYPE_INNER)),n.showIfameMask(c,!1),p.showHoverDom=!0,0!=u.dragFlag){var r,s,l;for(u.dragFlag=0,r=0,s=f.length;r<s;r++)l=f[r],i.nodeIsParent(c,l)&&u.dragNodeShowBefore[l.tId]&&!l.open&&(a.expandCollapseNode(c,l,!l.open),delete u.dragNodeShowBefore[l.tId]);m&&m.remove(),v&&v.remove();var g=(t.ctrlKey||t.metaKey)&&c.edit.drag.isMove&&c.edit.drag.isCopy||!c.edit.drag.isMove&&c.edit.drag.isCopy;if(!g&&b&&D&&f[0].parentTId&&D==f[0].parentTId&&x==o.move.TYPE_INNER&&(b=null),b){var h=null==D?null:i.getNodeCache(T,D);if(0==n.apply(c.callback.beforeDrop,[T.treeId,f,h,x,g],!0))return void a.selectNodes(E,f);var N=g?n.clone(f):f;function y(){if(w){if(!g)for(var e=0,n=f.length;e<n;e++)a.removeNode(c,f[e]);x==o.move.TYPE_INNER?a.addNodes(T,h,-1,N):a.addNodes(T,h.getParentNode(),x==o.move.TYPE_PREV?h.getIndex():h.getIndex()+1,N)}else if(g&&x==o.move.TYPE_INNER)a.addNodes(T,h,-1,N);else if(g)a.addNodes(T,h.getParentNode(),x==o.move.TYPE_PREV?h.getIndex():h.getIndex()+1,N);else if(x!=o.move.TYPE_NEXT)for(e=0,n=N.length;e<n;e++)a.moveNode(T,h,N[e],x,!1);else for(e=-1,n=N.length-1;e<n;n--)a.moveNode(T,h,N[n],x,!1);a.selectNodes(T,N);var i=d(N[0],c).get(0);a.scrollIntoView(c,i),c.treeObj.trigger(o.event.DROP,[t,T.treeId,N,h,x,g])}x==o.move.TYPE_INNER&&n.canAsync(T,h)?a.asyncNode(T,h,!1,y):y()}else a.selectNodes(E,f),c.treeObj.trigger(o.event.DROP,[t,c.treeId,f,null,null,null])}}function L(){return!1}return n.uCanDo(c)&&C.bind("mousemove",A),C.bind("mouseup",O),C.bind("selectstart",L),!0}},_tools={getAbs:function(e){var t=e.getBoundingClientRect(),n=document.body.scrollTop+document.documentElement.scrollTop,o=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+o,t.top+n]},inputFocus:function(e){e.get(0)&&(e.focus(),n.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}},showIfameMask:function(e,t){for(var o=i.getRoot(e);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var a=d("iframe",e),r=0,s=a.length;r<s;r++){var l=a.get(r),c=n.getAbs(l),u=d("<div id='zTreeMask_"+r+"' class='zTreeMask' style='top:"+c[1]+"px; left:"+c[0]+"px; width:"+l.offsetWidth+"px; height:"+l.offsetHeight+"px;'></div>",e);u.appendTo(d("body",e)),o.dragMaskList.push(u)}}},_view={addEditBtn:function(e,t){if(!(t.editNameFlag||d(t,o.id.EDIT,e).length>0)&&n.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var i=d(t,o.id.A,e),r="<span class='"+o.className.BUTTON+" edit' id='"+t.tId+o.id.EDIT+"' title='"+n.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+o.id.EDIT+" style='display:none;'></span>";i.append(r),d(t,o.id.EDIT,e).bind("click",(function(){return!(!n.uCanDo(e)||0==n.apply(e.callback.beforeEditName,[e.treeId,t],!0))&&(a.editNode(e,t),!1)})).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||d(t,o.id.REMOVE,e).length>0)&&n.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var i=d(t,o.id.A,e),r="<span class='"+o.className.BUTTON+" remove' id='"+t.tId+o.id.REMOVE+"' title='"+n.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+o.id.REMOVE+" style='display:none;'></span>";i.append(r),d(t,o.id.REMOVE,e).bind("click",(function(){return!(!n.uCanDo(e)||0==n.apply(e.callback.beforeRemove,[e.treeId,t],!0))&&(a.removeNode(e,t),e.treeObj.trigger(o.event.REMOVE,[e.treeId,t]),!1)})).bind("mousedown",(function(e){return!0})).show()}},addHoverDom:function(e,t){i.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(a.addEditBtn(e,t),a.addRemoveBtn(e,t)),n.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,r){var s=i.getRoot(e),l=s.curEditNode;if(l){var c=s.curEditInput,u=t||(r?i.nodeName(e,l):c.val());if(!1===n.apply(e.callback.beforeRename,[e.treeId,l,u,r],!0))return!1;i.nodeName(e,l,u),d(l,o.id.A,e).removeClass(o.node.CURSELECTED_EDIT),c.unbind(),a.setNodeName(e,l),l.editNameFlag=!1,s.curEditNode=null,s.curEditInput=null,a.selectNode(e,l,!1),e.treeObj.trigger(o.event.RENAME,[e.treeId,l,r])}return s.noSelection=!0,!0},editNode:function(e,t){var r=i.getRoot(e);if(a.editNodeBlur=!1,i.isSelectedNode(e,t)&&r.curEditNode==t&&t.editNameFlag)setTimeout((function(){n.inputFocus(r.curEditInput)}),0);else{t.editNameFlag=!0,a.removeTreeDom(e,t),a.cancelCurEditNode(e),a.selectNode(e,t,!1),d(t,o.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+o.id.INPUT+"' treeNode"+o.id.INPUT+" >");var s=d(t,o.id.INPUT,e);s.attr("value",i.nodeName(e,t)),e.edit.editNameSelectAll?n.inputSelect(s):n.inputFocus(s),s.bind("blur",(function(t){a.editNodeBlur||a.cancelCurEditNode(e)})).bind("keydown",(function(t){"13"==t.keyCode?(a.editNodeBlur=!0,a.cancelCurEditNode(e)):"27"==t.keyCode&&a.cancelCurEditNode(e,null,!0)})).bind("click",(function(e){return!1})).bind("dblclick",(function(e){return!1})),d(t,o.id.A,e).addClass(o.node.CURSELECTED_EDIT),r.curEditInput=s,r.noSelection=!1,r.curEditNode=t}},moveNode:function(e,t,n,r,s,l){var c=i.getRoot(e);if(t!=n&&(!e.data.keep.leaf||!t||i.nodeIsParent(e,t)||r!=o.move.TYPE_INNER)){var u=n.parentTId?n.getParentNode():c,p=null===t||t==c;p&&null===t&&(t=c),p&&(r=o.move.TYPE_INNER);var g,h,f=t.parentTId?t.getParentNode():c;if(r!=o.move.TYPE_PREV&&r!=o.move.TYPE_NEXT&&(r=o.move.TYPE_INNER),r==o.move.TYPE_INNER&&(p?n.parentTId=null:(i.nodeIsParent(e,t)||(i.nodeIsParent(e,t,!0),t.open=!!t.open,a.setNodeLineIcos(e,t)),n.parentTId=t.tId)),p)h=g=e.treeObj;else{if(l||r!=o.move.TYPE_INNER?l||a.expandCollapseNode(e,t.getParentNode(),!0,!1):a.expandCollapseNode(e,t,!0,!1),g=d(t,e),h=d(t,o.id.UL,e),g.get(0)&&!h.get(0)){var m=[];a.makeUlHtml(e,t,m,""),g.append(m.join(""))}h=d(t,o.id.UL,e)}var v=d(n,e);v.get(0)?g.get(0)||v.remove():v=a.appendNodes(e,n.level,[n],null,-1,!1,!0).join(""),h.get(0)&&r==o.move.TYPE_INNER?h.append(v):g.get(0)&&r==o.move.TYPE_PREV?g.before(v):g.get(0)&&r==o.move.TYPE_NEXT&&g.after(v);var b,N,y=-1,C=0,k=null,w=null,T=n.level,E=i.nodeChildren(e,u),I=i.nodeChildren(e,f),P=i.nodeChildren(e,t);if(n.isFirstNode)y=0,E.length>1&&((k=E[1]).isFirstNode=!0);else if(n.isLastNode)(k=E[(y=E.length-1)-1]).isLastNode=!0;else for(b=0,N=E.length;b<N;b++)if(E[b].tId==n.tId){y=b;break}if(y>=0&&E.splice(y,1),r!=o.move.TYPE_INNER)for(b=0,N=I.length;b<N;b++)I[b].tId==t.tId&&(C=b);if(r==o.move.TYPE_INNER?(P||(P=i.nodeChildren(e,t,[])),P.length>0&&((w=P[P.length-1]).isLastNode=!1),P.splice(P.length,0,n),n.isLastNode=!0,n.isFirstNode=1==P.length):t.isFirstNode&&r==o.move.TYPE_PREV?(I.splice(C,0,n),(w=t).isFirstNode=!1,n.parentTId=t.parentTId,n.isFirstNode=!0,n.isLastNode=!1):t.isLastNode&&r==o.move.TYPE_NEXT?(I.splice(C+1,0,n),(w=t).isLastNode=!1,n.parentTId=t.parentTId,n.isFirstNode=!1,n.isLastNode=!0):(r==o.move.TYPE_PREV?I.splice(C,0,n):I.splice(C+1,0,n),n.parentTId=t.parentTId,n.isFirstNode=!1,n.isLastNode=!1),i.fixPIdKeyValue(e,n),i.setSonNodeLevel(e,n.getParentNode(),n),a.setNodeLineIcos(e,n),a.repairNodeLevelClass(e,n,T),!e.data.keep.parent&&E.length<1){i.nodeIsParent(e,u,!1),u.open=!1;var D=d(u,o.id.UL,e),x=d(u,o.id.SWITCH,e),_=d(u,o.id.ICON,e);a.replaceSwitchClass(u,x,o.folder.DOCU),a.replaceIcoClass(u,_,o.folder.DOCU),D.css("display","none")}else k&&a.setNodeLineIcos(e,k);w&&a.setNodeLineIcos(e,w),e.check&&e.check.enable&&a.repairChkClass&&(a.repairChkClass(e,u),a.repairParentChkClassWithSelf(e,u),u!=n.parent&&a.repairParentChkClassWithSelf(e,n)),l||a.expandCollapseParentNode(e,n.getParentNode(),!0,s)}},removeEditBtn:function(e,t){d(t,o.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){d(t,o.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,a.removeEditBtn(e,t),a.removeRemoveBtn(e,t),n.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,n){if(n!==t.level){var a=d(t,e),i=d(t,o.id.A,e),r=d(t,o.id.UL,e),s=o.className.LEVEL+n,l=o.className.LEVEL+t.level;a.removeClass(s),a.addClass(l),i.removeClass(s),i.addClass(l),r.removeClass(s),r.addClass(l)}},selectNodes:function(e,t){for(var n=0,o=t.length;n<o;n++)a.selectNode(e,t[n],n>0)}},_z={tools:_tools,view:_view,event:_event,data:_data},$.extend(!0,tree.tree.consts,e),$.extend(!0,tree.tree._z,_z);var t=tree.tree,n=t._z.tools,o=t.consts,a=t._z.view,i=t._z.data,d=(t._z.event,n.$);i.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),i.addInitBind(_bindEvent),i.addInitUnBind(_unbindEvent),i.addInitCache(_initCache),i.addInitNode(_initNode),i.addInitProxy(_eventProxy),i.addInitRoot((function(e){var t=i.getRoot(e),n=i.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,n.showHoverDom=!0})),i.addZTreeTools(_zTreeTools);var r=a.cancelPreSelectedNode;a.cancelPreSelectedNode=function(e,t){for(var n=i.getRoot(e).curSelectedList,o=0,d=n.length;o<d&&(t&&t!==n[o]||(a.removeTreeDom(e,n[o]),!t));o++);r&&r.apply(a,arguments)};var s=a.createNodes;a.createNodes=function(e,t,n,o,i){s&&s.apply(a,arguments),n&&a.repairParentChkClassWithSelf&&a.repairParentChkClassWithSelf(e,o)};var l=a.makeNodeUrl;a.makeNodeUrl=function(e,t){return e.edit.enable?null:l.apply(a,arguments)};var c=a.removeNode;a.removeNode=function(e,t){var n=i.getRoot(e);n.curEditNode===t&&(n.curEditNode=null),c&&c.apply(a,arguments)};var u=a.selectNode;a.selectNode=function(e,t,n){var o=i.getRoot(e);return(!i.isSelectedNode(e,t)||o.curEditNode!=t||!t.editNameFlag)&&(u&&u.apply(a,arguments),a.addHoverDom(e,t),!0)};var p=n.uCanDo;n.uCanDo=function(e,t){var o=i.getRoot(e);return!(!t||!(n.eqs(t.type,"mouseover")||n.eqs(t.type,"mouseout")||n.eqs(t.type,"mousedown")||n.eqs(t.type,"mouseup")))||(o.curEditNode&&(a.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(!p||p.apply(a,arguments)))}}();return{init:tree.tree.init,tree:tree.tree,tools:tree.tools}}(),XAPP.menu=function(){var e,t={};function n(t){"treemenu"==t.target.id||$(t.target).parents("#treemenu").length>0||e.css({display:"none"})}function o(e){var n=$("<li></li>");if(null===e)n.addClass("divider");else if(void 0===e.options){if(!e.display)return null;t[e.id]=e,$('<a id="'+e.id+'" class="no-dropdown"><i class="fa fa-'+e.class+'" style ="padding-right: 10px;font-size: 10px"></i>'+e.name+"</a>").on("click",(e=>{e.preventDefault(),$(e.target.parentElement).hasClass("disabled")||a(e.target.id)})).appendTo(n),e.disabled&&n.addClass("disabled")}else e.disabled&&n.addClass("disabled"),$('<a><i class="fa fa-'+e.class+'" style ="padding-right: 10px;font-size: 10px"></i>'+e.name+"</a>").appendTo(n),n.addClass("dropdown-submenu"),n.append(function(e){for(var n=$('<ul class="dropdown-menu"></ul>'),o=0;o<e.length;o++){var i=e[o];if(i.display){var d=$("<li></li>");t[i.id]=i,i.disabled&&d.addClass("disabled");var r=$("<a id="+i.id+'><i class="fa fa-'+i.class+'" style ="padding-right: 10px;font-size: 10px"></i>'+i.name+"</a>");$(r).appendTo(d).on("click",(e=>{e.preventDefault(),$(e.target.parentElement).hasClass("disabled")||a(e.target.id)})),d.appendTo(n)}}return n}(e.options));return n}function a(e,n){var o=t[e];if(o&&o.onselect){var a=o.onselect;"string"==typeof o.onselect&&(a=XAPP.actions.get(o.onselect)),a?a.call(o,n):console.log("No callback for",e,o.onselect)}}return{load:function(t){levelselectedNode=t.level;var n=[];e.empty();var a={id:"tree-new",name:"New",disabled:!0,display:!0,class:"plus",options:[]},i=[{id:"tree-new-connection",name:"Connection",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-connection",type:"connection",class:"plug"},{id:"tree-new-tag-group",name:"Groupe",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-group",type:"groupe",class:"cube"},{id:"tree-new-tag-archive",name:"Tag",disabled:!1,display:3==levelselectedNode,onselect:"core:tree-new-tag-archive",type:"tag",class:"tag"}],d=[{id:"tree-new-ui-tab",name:"Tab",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-ui-tab",class:"cubes"},{id:"tree-new-ui-gauge",name:"Gauge",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-ui-gauge",class:"tachometer-alt"},{id:"tree-new-tag-ui-piechart",name:"Pie Chart",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-ui-piechart",class:"pie-chart"},{id:"tree-new-tag-ui-barchart",name:"Bar Chart",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-ui-barchart",class:"bar-chart"},{id:"tree-new-tag-ui-template",name:"template",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-ui-template",class:"file-code"},{id:"tree-new-tag-ui-uispark",name:"Spark",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-ui-uispark",class:"line-chart"},{id:"tree-new-ui-statemachine",name:"State Machine",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-statemachine",class:"server"}],r=[{id:"tree-new-ui-db",name:"Data Base",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-db",class:"database"},{id:"tree-new-ui-coll",name:"Collection",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-coll",class:"cube"}],s=[{id:"core:tree-new-mmobile",name:"Mobile",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-mmobile",class:"mobile"},{id:"core:tree-new-mwidget",name:"Widgets",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-mwidget",class:"progressbar"},{id:"core:tree-new-mpiechart",name:"Pei Chart",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-mpiechart",class:"pie-chart"},{id:"core:tree-new-mbarchart",name:"Bar Chart",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-mbarchart",class:"bar-chart"}],l=[{id:"core:tree-new-rpreport",name:"Report",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-rpreport",class:"mobile"},{id:"core:tree-new-rpwidget",name:"Widget",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-rpwidget",class:"progressbar"},{id:"core:tree-new-rptemplate",name:"Template",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-rptemplate",class:"progressbar"},{id:"core:tree-new-rpchart",name:"Chart",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-rpchart",class:"progressbar"}],c=[{id:"tree-new-ui-statemachine",name:"State Machine",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-statemachine",class:"datapoint"},{id:"tree-new-ui-batch",name:"Batch List",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-batch",class:"datapoint"},{id:"tree-new-tag-status",name:"Status",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-status",type:"alarm",class:"bolt"},{id:"tree-new-tag-phase",name:"Phase",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-phase",type:"alarm",class:"bolt"},{id:"tree-new-tag-alarm",name:"Alarms",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-alarm",type:"alarm",class:"bolt"},{id:"tree-new-tag-trend",name:"Trend",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-trend",type:"alarm",class:"bar-chart"},{id:"tree-new-ui-datapoint",name:"Data Point",disabled:!1,display:1==levelselectedNode,onselect:"core:tree-new-datapoint",class:"datapoint"},{id:"tree-new-ui-calc",name:"Calculator",disabled:!1,display:2==levelselectedNode,onselect:"core:tree-new-calculator",class:"calculator"}],u=[];switch(XAPP.treelist.actions.getRoot(t).name){case"Configuration":u=i;break;case"Data Base":u=r;break;case"Dashboard":u=d;break;case"Mobile":u=s;break;case"Data Point":u=c;break;case"Report":u=l;break;default:u=[]}0===u.length||void 0===u?a.disabled=!0:a.options.push(...u),u.forEach((e=>{e.display&&(a.disabled=!1)})),n.push(a),n.push(null),n.push({id:"tree-node-refresh",name:"Refresh",disabled:!1,display:!0,onselect:"core:tree-node-refresh",class:"exchange"}),n.push(null),n.push({id:"tree-node-cut",name:"Cut",disabled:!1,display:!0,onselect:"core:tree-node-cut",class:"cut"}),n.push({id:"tree-node-copy",name:"Copy",disabled:!1,display:!0,onselect:"core:tree-node-copy",class:"copy"}),n.push({id:"tree-node-paste",name:"Paste",disabled:!1,display:!0,onselect:"core:tree-node-paste",class:"paste"}),n.push(null),n.push({id:"tree-node-delete",name:"Delete",disabled:!1,display:!0,onselect:"core:tree-node-delete",class:"eraser"}),n.push(null),n.push({id:"tree-node-export",name:"Export",disabled:!1,display:!0,onselect:"core:tree-node-export",class:"file-export"}),n.push({id:"core:tree-import",name:"Import",disabled:!1,display:!0,onselect:"core:tree-node-import",class:"file-import"}),function(e){for(var t=$("<ul/>",{class:"dropdown-menu",style:"display:none"}),n=0;n<e.length;n++){var a=o(e[n]);a&&t.append(a)}return t}(n).appendTo(e)},init:function(){e=$('<div id="treemenu" class="treemenu"></div>').appendTo("#red-ui-editor")},show:function(t,o,a){$("#treemenu ul").show(),e.css({top:a+"px",left:o+"px",display:"block"}),e.find(".dropdown-submenu > ul").css({display:"none"}),e.find(".dropdown-submenu > a").on("mouseover",(function(){e.find(".dropdown-submenu > ul").css({display:"none"}),console.log(this),$(this).parent().hasClass("disabled")||$(this).next("ul").css({display:"block"})})),e.find("a.no-dropdown").on("mouseenter",(function(){e.find(".dropdown-submenu > ul").css({display:"none"})})),$("body").on("click",n)},hide:function(){e&&e.css({display:"none"}),$("body").unbind("click",n)}}}(),XAPP.navbar=function(){var e=[];function t(t,n){var o=e[t];if(o&&o.onselect){var a=o.onselect;"string"==typeof o.onselect&&(a=XAPP.actions.get(o.onselect)),a?a.call(o,n):console.log("No callback for",t,o.onselect)}}function n(o){var d;if(null===o)d=$('<li class="divider"></li>');else{d=$("<li></li>"),o.group&&d.addClass("red-ui-menu-group-"+o.group);var r="<a "+(o.id?'id="'+o.id+'" ':"")+'tabindex="-1" href="#">';o.toggle&&(r+='<i class="fa fa-square pull-'+o.position+'"></i>',r+='<i class="fa fa-check-square pull-'+o.position+'"></i>'),void 0!==o.icon&&(/\.(png|svg)/.test(o.icon)?r+='<img src="'+o.icon+'"/> ':r+='<i class="'+(o.icon?o.icon:'" style="display: inline-block;"')+'"></i> '),o.sublabel?r+='<span class="red-ui-menu-label-container"><span class="red-ui-menu-label">'+o.label+'</span><span class="red-ui-menu-sublabel">'+o.sublabel+"</span></span>":r+='<span class="red-ui-menu-label">'+o.label+"</span>",r+="</a>";var s=$(r).appendTo(d);if(e[o.id]=o,o.onselect?(s.on("click",(function(e){e.preventDefault(),console.log("click"),$(this).parent().hasClass("disabled")||(o.toggle?!0===o.toggle?i(o.id,!a(o.id)):i(o.id,!0):t(o.id))})),o.toggle):o.href?s.attr("target","_blank").attr("href",o.href):o.options||(d.addClass("disabled"),s.on("click",(function(e){e.preventDefault()}))),o.options){d.addClass("dropdown-submenu");for(var l=$('<ul id="'+o.id+'-submenu" class="dropdown-menu"></ul>').appendTo(d),c=0;c<o.options.length;c++){var u=n(o.options[c]);u&&u.appendTo(l)}}o.disabled&&d.addClass("disabled")}return d}function o(e){var t=$("<ul/>",{class:"dropdown-menu"});if(e.id){t.attr({id:e.id+"-submenu"});var o=$("#"+e.id);1===o.length&&(t.insertAfter(o),o.on("click",(function(e){e.stopPropagation(),e.preventDefault(),t.is(":visible")?(console.log("Visible"),$(document).off("click.red-ui-menu"),t.hide()):(console.log("Not visible"),$(document).on("click.red-ui-menu",(function(e){$(document).off("click.red-ui-menu"),activeMenu=null,t.hide()})),$(".red-ui-menu").hide(),t.show())})))}for(var a=!1,i=0;i<e.options.length;i++){var d=e.options[i];if(null!==d||!a){var r=n(d);r&&(r.appendTo(t),a=null===d)}}return t}function a(e){return $("#"+e).hasClass("active")}function i(n,o){var d=!1;a(n)==o&&(d=!0);var r=e[n];if(o?$("#"+n).addClass("active"):$("#"+n).removeClass("active"),r){if(r.toggle&&"string"==typeof r.toggle&&o)for(var s in e)if(e.hasOwnProperty(s)){var l=e[s];l.id!=r.id&&r.toggle==l.toggle&&i(l.id,!1)}!d&&r.onselect&&t(r.id,o),r.local||d||RED.settings.set(r.setting||"menu-"+r.id,o)}}function d(){var e=[],t=[],n=$("#menu-left");e.push({id:"menu-item-system",label:"System"}),e.push({id:"menu-item-users",label:"Users"}),e.push({id:"menu-item-extensions",label:"Extensions"}),e.push({id:"menu-item-options",label:"Options"}),e.push({id:"menu-item-help",label:"Help"});for(var a=0;a<e.length;a++){var i=e[a],d=$('<li class="dropdown"><a '+(i.id?'id="'+i.id+'" ':"")+'href="#">'+i.label+'<span class="caret"></span></a></li>');$(d).appendTo(n).on("mouseenter",(function(){n.find("> li > ul").css("display","none")}))}XAPP.actions.add("core:toggle-control-panel",(function(){console.log("core:toggle-control-panel")})),XAPP.actions.add("core:toggle-global-configuration",(function(){console.log("core:toggle-global-configuration")})),XAPP.actions.add("core:toggle-global-check-in",(function(){console.log("core:toggle-global-check-in")})),XAPP.actions.add("core:toggle-clear-cache",(function(){console.log("core:toggle-clear-cache")})),XAPP.actions.add("core:toggle-clear-epired-cache",(function(){console.log("core:toggle-clear-epired-cache")})),XAPP.actions.add("core:toggle-add-new-user",(function(){console.log("core:toggle-add-new-user")})),XAPP.actions.add("core:toggle-add-new-group",(function(){console.log("core:toggle-add-new-group")})),(t=[]).push({id:"menu-item-control-panel",label:"Control Panel",onselect:"core:toggle-control-panel",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-global-configuration",label:"Global Configuration",onselect:"core:toggle-global-configuration",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-global-check-in",label:"Global Check-in",onselect:"core:toggle-global-check-in",display:null,selected:!0}),t.push({id:"menu-item-clear-cache",label:"Clear Cache",onselect:"core:toggle-clear-cache",display:null,selected:!0}),t.push({id:"menu-item-clear-expired-cache",label:"Clear Expired Cache",onselect:"core:toggle-clear-epired-cache",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-system-information",label:"System Information",onselect:"core:toggle-system-information",display:null,selected:!0}),o({id:"menu-item-system",options:t}),(t=[]).push({id:"menu-item-manage",label:"Manage",onselect:"core:toggle-manage",display:null,selected:!0,options:[{id:"menu-item-add-new-user",label:"Add New User",onselect:"core:toggle-add-new-user",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Add New Group",onselect:"core:toggle-add-new-group",display:null,selected:!0}]}),t.push({id:"menu-item-access-levels",label:"Access Levels",onselect:"core:toggle-access-levels",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-fields",label:"Fields",onselect:"core:toggle-fields",display:null,selected:!0}),t.push({id:"menu-item-field-groups",label:"Field Groups",onselect:"core:toggle-field-group",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-user-notes",label:"User Notes",onselect:"core:toggle-user-notes",display:null,selected:!0}),t.push({id:"menu-item-user-note-categories",label:"User Note Categories",onselect:"core:toggle-user-note-categories",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-privacy",label:"Privacy",onselect:"core:toggle-privacy",display:null,selected:!0}),t.push({id:"menu-item-user-actions-log",label:"User Actions Log",onselect:"core:toggle-user-actions-log",display:null,selected:!0}),t.push(null),t.push({id:"menu-item-mass-mail-users",label:"Mass Mail Users",onselect:"core:toggle-mass-mail-users",display:null,selected:!0}),o({id:"menu-item-users",options:t}),(t=[]).push({id:"menu-item-manage",label:"Manage",onselect:"core:toggle-manage",display:null,selected:!0,options:[{id:"menu-item-add-new-user",label:"Install",onselect:"core:toggle-add-new-user",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Update",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Manage",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Discover",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Database",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Warning",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Install languages",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Updates Sites",onselect:"core:toggle-add-new-group",display:null,selected:!0}]}),t.push(null),t.push({id:"menu-item-access-levels",label:"Modules",onselect:"core:toggle-access-levels",display:null,selected:!0}),t.push({id:"menu-item-access-levels",label:"Plugins",onselect:"core:toggle-access-levels",display:null,selected:!0}),t.push({id:"menu-item-manage",label:"Templates",onselect:"core:toggle-manage",display:null,selected:!0,options:[{id:"menu-item-add-new-user",label:"Styles",onselect:"core:toggle-add-new-user",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Templates",onselect:"core:toggle-add-new-group",display:null,selected:!0}]}),t.push({id:"menu-item-manage",label:"Language(s)",onselect:"core:toggle-manage",display:null,selected:!0,options:[{id:"menu-item-add-new-user",label:"Installed",onselect:"core:toggle-add-new-user",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Overrides",onselect:"core:toggle-add-new-group",display:null,selected:!0},{id:"menu-item-add-new-group",label:"Content Languages",onselect:"core:toggle-add-new-group",display:null,selected:!0}]}),o({id:"menu-item-extensions",options:t}),(t=[]).push({id:"menu-item-projects-menu",label:"Project",options:[{id:"menu-item-projects-new",label:"New",disabled:!1,onselect:"core:new-project"},{id:"menu-item-projects-open",label:"Open",disabled:!1,onselect:"core:open-project"},{id:"menu-item-projects-settings",label:"Settings",disabled:!1,onselect:"core:show-project-settings"}]}),t.push(null),t.push({id:"menu-item-view-menu",label:"View",options:[{id:"menu-item-palette",label:"Palette Show",toggle:!0,position:"right",onselect:"core:toggle-palette",selected:!0},{id:"menu-item-sidebar",label:"Sidebar Show",toggle:!0,position:"right",onselect:"core:toggle-sidebar",selected:!0},{id:"menu-item-event-log",label:"EventLog title",onselect:"core:show-event-log"},{id:"menu-item-action-list",label:"Keyboard Action List",onselect:"core:show-action-list"}]}),t.push(null),t.push({id:"menu-item-import",label:"Import",onselect:"core:show-import-dialog"}),t.push({id:"menu-item-export",label:"Export",onselect:"core:show-export-dialog"}),t.push(null),t.push({id:"menu-item-search",label:"Search",onselect:"core:search"}),t.push(null),t.push({id:"menu-item-config-nodes",label:"Display Config",onselect:"core:show-config-tab"}),t.push({id:"menu-item-workspace",label:"Flows",options:[{id:"menu-item-workspace-add",label:"Add",onselect:"core:add-flow"},{id:"menu-item-workspace-edit",label:"Rename",onselect:"core:edit-flow"},{id:"menu-item-workspace-delete",label:"Delete",onselect:"core:remove-flow"}]}),t.push({id:"menu-item-subflow",label:"Subflows",options:[{id:"menu-item-subflow-create",label:"Create Sub Flow",onselect:"core:create-subflow"},{id:"menu-item-subflow-convert",label:"Selection To Subflow",disabled:!0,onselect:"core:convert-to-subflow"}]}),t.push(null),t.push({id:"menu-item-edit-palette",label:"Edit Palette",onselect:"core:manage-palette"}),t.push(null),t.push({id:"menu-item-user-settings",label:"Settings",onselect:"core:show-user-settings"}),t.push(null),t.push({id:"menu-item-keyboard-shortcuts",label:"Keyboard Shortcuts",onselect:"core:show-help"}),t.push({id:"menu-item-node-red-version",label:"Version",onselect:"core:show-about"}),o({id:"menu-item-options",options:t}),(t=[]).push({id:"menu-item-access-levels",label:"Community Portal",onselect:"core:toggle-access-levels",display:null,selected:!0}),t.push({id:"menu-item-access-levels",label:"Security Centre",onselect:"core:toggle-access-levels",display:null,selected:!0}),t.push({id:"menu-item-access-levels",label:"Official Support Forume",onselect:"core:toggle-access-levels",display:null,selected:!0}),t.push({id:"menu-item-access-levels",label:"Developer Resources",onselect:"core:toggle-access-levels",display:null,selected:!0}),o({id:"menu-item-help",options:t})}return{build:d,init:function(e){$('\n                                \x3c!-- Top Navigation --\x3e\n                                <nav class="j-navbar j-navbar-inverse j-navbar-fixed-top">\n                                    <div class="j-navbar-inner">\n                                        <div class="j-container-fluid">\n                                            <a href="#" class="btn btn-j-navbar collapsed" data-toggle="collapse" data-target=".j-nav-collapse">\n                                                <span class="element-invisible">Toggle Navigation</span>\n                                                <span class="j-icon-bar"></span>\n                                                <span class="j-icon-bar"></span>\n                                                <span class="j-icon-bar"></span>\n                                            </a>\n                                            <a class="element-invisible" href="#skiptarget">Skip to Main Content</a>\n\n                                            <a class="admin-logo" href="#">\n                                            <img class="fit-picture" width="64" height="64"src="xapp/images/logo_xapp.png" alt="Grapefruit slice atop a pile of other slices">\n                                                <div class="element-invisible">Control Panel</div>\n                                            </a>\n\n                                            <a class="brand hidden-desktop hidden-tablet" href="#" title="Preview Siemens S7" target="_blank">XAPP</a>\n\n                                            <div class="j-nav-collapse j-collapse">\n                                                <ul id="menu-left" class="nav menu-left"></ul>\n                                                <ul id="menu-right" class="nav menu-right pull-right"></ul>\n                                                <ul id="nav-empty" class="dropdown-menu nav-empty hidden-phone" style="display: none;"></ul>\n                                                <span class="icon-out-2 small"></span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </nav>\n                                \x3c!-- Top Navigation --\x3e\n                               ').appendTo(e.target),d(),function(){var e=$("#menu-right"),t=[];t.push({id:"menu-item-user",label:"System",icon:"fa fa-user",caret:!0}),t.push({id:"menu-item-more-options",label:"Users",icon:"fa fa-bars",caret:!1});for(var n=0;n<t.length;n++){var a=t[n],i='<li class="dropdown"><a '+(a.id?'id="'+a.id+'" ':"")+'href="#"><i class="'+a.icon+'">';a.caret&&(i+='<span class="caret"></span>'),i+="</a></li>",$(i).appendTo(e).on("mouseenter",(function(){e.find("> li > ul").css("display","none")}))}menuOptions=[],menuOptions.push({id:"menu-item-access-levels",label:"Super user",onselect:"core:toggle-access-levels",display:null,selected:!0}),menuOptions.push(null),menuOptions.push({id:"menu-item-access-levels",label:"Edit Account",onselect:"core:toggle-access-levels",display:null,selected:!0}),menuOptions.push(null),menuOptions.push({id:"menu-item-access-levels",label:"Logout",onselect:"core:user-log-out",display:null,selected:!0}),o({id:"menu-item-user",options:menuOptions}),XAPP.actions.add("core:user-log-out",(function(){RED.user.logout()})),menuOptions=[],menuOptions.push({id:"menu-item-projects-menu",label:"Project",options:[{id:"menu-item-projects-new",label:"New",disabled:!1,onselect:"core:new-project"},{id:"menu-item-projects-open",label:"Open",disabled:!1,onselect:"core:open-project"},{id:"menu-item-projects-settings",label:"Settings",disabled:!1,onselect:"core:show-project-settings"}]}),menuOptions.push(null),menuOptions.push({id:"menu-item-view-menu",label:"View",options:[{id:"menu-item-palette",label:"Palette Show",toggle:!0,position:"left",onselect:"core:toggle-palette",selected:!0},{id:"menu-item-sidebar",label:"Sidebar Show",toggle:!0,position:"left",onselect:"core:toggle-sidebar",selected:!0},{id:"menu-item-event-log",label:"EventLog title",onselect:"core:show-event-log"},{id:"menu-item-action-list",label:"Keyboard Action List",onselect:"core:show-action-list"}]}),menuOptions.push(null),menuOptions.push({id:"menu-item-import",label:"Import",onselect:"core:show-import-dialog"}),menuOptions.push({id:"menu-item-export",label:"Export",onselect:"core:show-export-dialog"}),menuOptions.push(null),menuOptions.push({id:"menu-item-search",label:"Search",onselect:"core:search"}),menuOptions.push(null),menuOptions.push({id:"menu-item-config-nodes",label:"Display Config",onselect:"core:show-config-tab"}),menuOptions.push({id:"menu-item-workspace",label:"Flows",options:[{id:"menu-item-workspace-add",label:"Add",onselect:"core:add-flow"},{id:"menu-item-workspace-edit",label:"Rename",onselect:"core:edit-flow"},{id:"menu-item-workspace-delete",label:"Delete",onselect:"core:remove-flow"}]}),o({id:"menu-item-more-options",options:menuOptions})}()},setSelected:i,isSelected:a,toggleSelected:function(e){i(e,!a(e))},setDisabled:function(e,t){t?$("#"+e).parent().addClass("disabled"):$("#"+e).parent().removeClass("disabled")},addItem:function(e,t){var o=n(t);if(null!==t&&t.group){var a=$("#"+e+"-submenu").children(".red-ui-menu-group-"+t.group);if(0===a.length)o.appendTo("#"+e+"-submenu");else{for(var i=0;i<a.length;i++){var d=a[i],r=$(d).find(".red-ui-menu-label").html();if(t.label<r){$(d).before(o);break}}i===a.length&&o.appendTo("#"+e+"-submenu")}}else o.appendTo("#"+e+"-submenu")},removeItem:function(e){$("#"+e).parent().remove()},setAction:function(t,n){var o=e[t];o&&(o.onselect=n)}}}(),XAPP.toolbar=function(){var e={};function t(t){e[t.id]=t;var n=$('<div id ="'+t.id+'" class="j-btn-wrapper"></div>'),o='<button class="'+t.class+'">';o+='<span class="'+t.icon+'"aria-hidden="true"></span>'+t.label,o+="</button>";var a=$(o).appendTo(n);return t.onselect&&a.on("click",(function(n){n.preventDefault(),$(this).parent().hasClass("disabled")||function(t,n){var o=e[t],a=o.onselect;"string"==typeof o.onselect&&(a=XAPP.actions.get(o.onselect)),a?a.call(o,n):console.log("No callback for",t,o.onselect)}(t.id)})),n}function n(){var e=[],n=$("#j-toolbar");function o(e,t,n){return n?e===t?0:e.trim()===t.trime()?2:1:e===t?0:1}function a(e){var t=$("<tr>"),n=e.a,o=e.b,a=$('<td class="lineno">').text(2===n.type?"":n.i).appendTo(t),i=$('<td class="linetext">').text(n.line).appendTo(t);return 2===n.type?(a.addClass("blank"),i.addClass("blank")):4===n.type?(a.addClass("added"),i.addClass("added")):1===n.type&&(a.addClass("removed"),i.addClass("removed")),a=$('<td class="lineno">').text(2===o.type?"":o.i).appendTo(t),i=$('<td class="linetext">').text(o.line).appendTo(t),2===o.type?(a.addClass("blank"),i.addClass("blank")):4===o.type?(a.addClass("added"),i.addClass("added")):1===o.type&&(a.addClass("removed"),i.addClass("removed")),t}function i(e,t,n){diffRow=$('<tr class="red-ui-diff-text-header red-ui-diff-text-expand">');var o=$('<td colspan="4"> <i class="fa fa-arrows-v"></i> </td>').appendTo(diffRow),i=$("<span></span>").appendTo(o);return t<n.length-1&&i.text("@@ -"+(n[t-1].a.i+1)+" +"+(n[t-1].b.i+1)),diffRow.on("click",(function(o){if(t-e>20){var d=$(this).offset();if(e>0){for(var r=e;r<e+10;r++)a(n[r]).addClass("unchanged").insertBefore($(this));e+=10}if(t<n.length-1){for(r=t-1;r>t-11;r--)a(n[r]).addClass("unchanged").insertAfter($(this));t-=10}t<n.length-1&&i.text("@@ -"+(n[t-1].a.i+1)+" +"+(n[t-1].b.i+1));var s=$(this).offset().top-d.top;$(".red-ui-diff-text").scrollTop($(".red-ui-diff-text").scrollTop()+s)}else{for(r=e;r<t;r++)a(n[r]).addClass("unchanged").insertBefore($(this));$(this).remove()}})),diffRow}e.push({id:"toolbar-new",label:"New",display:!0,disabled:!1,icon:"j-icon-new j-icon-white",class:"btn btn-small button-new btn-success",onselect:"core:toggle-toolbar-new"}),e.push({id:"toolbar-edit",label:"Edit",display:!0,disabled:!1,icon:"j-icon-edit",class:"btn btn-small",onselect:"core:toggle-toolbar-edit"}),e.push({id:"toolbar-checkin",label:"Check-in",display:!0,disabled:!1,icon:"j-icon-checkin",class:"btn btn-small",onselect:"core:toggle-toolbar-checkin"}),e.push({id:"toolbar-default",label:"Home",display:!0,disabled:!1,icon:"j-icon-default",class:"btn btn-small",onselect:"core:toggle-toolbar-default"}),e.push({id:"toolbar-refresh",label:"Rebuild",display:!0,disabled:!1,icon:"j-icon-refresh",class:"btn btn-small",onselect:"core:toggle-toolbar-refresh"}),e.push({id:"toolbar-options",label:"Options",display:!0,disabled:!1,icon:"j-icon-options",class:"btn btn-small",onselect:"core:toggle-toolbar-options"}),e.push({id:"toolbar-help",label:"Help",display:!0,disabled:!1,icon:"j-icon-question-sign",class:"btn btn-small",onselect:"core:toggle-toolbar-help"}),XAPP.actions.add("core:toggle-toolbar-new",(function(){var e=RED.nodes.createCompleteNodeSet(),t=RED.nodes.originalFlow(),n=(JSON.stringify(e,null,4),JSON.stringify(t,null,4),{title:RED._("diff.compareChanges"),width:1/0,overlay:!0,buttons:[{text:RED._("common.label.close"),click:function(){RED.tray.close()}}],resize:function(e){},open:function(e){var t=e.find(".red-ui-tray-body"),n=$('<div class="red-ui-diff-text"></div>').appendTo(t),d=$("<table>",{class:"red-ui-diff-text-content"}).appendTo(n);$('<colgroup><col width="50"><col width="50%"><col width="50"><col width="50%"></colgroup>').appendTo(d);for(var r,s=$("<tbody>").appendTo(d),l=function(e,t,n){var a,i,d=e.split(/\r?\n/),r=t.split(/\r?\n/),s=d.length,l=r.length,c={a:[],b:[]},u=[];for(a=0;a<s+1;a++)for(u[a]=[],i=0;i<l+1;i++)u[a][i]=0;for(a=s-1;a>=0;a--)for(i=l-1;i>=0;i--)1!==o(d[a],r[i],n)?u[a][i]=u[a+1][i+1]+1:u[a][i]=Math.max(u[a+1][i],u[a][i+1]);for(a=0,i=0;a<s&&i<l;){var p=o(d[a],r[i],n);if(1!==p){var g=0;0===p?g=0:2==p&&(g=3),c.a.push({i:a+1,j:i+1,line:d[a],type:g}),c.b.push({i:i+1,j:a+1,line:r[i],type:g}),a++,i++}else u[a+1][i]>=u[a][i+1]?(c.a.push({i:a+1,line:d[a],type:1}),a++):(c.b.push({i:i+1,line:r[i],type:4}),i++)}for(;a<s||i<l;)a==s?(c.b.push({i:i+1,line:r[i],type:4}),i++):i==l&&(c.a.push({i:a+1,line:d[a],type:1}),a++);return c}("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22","1\nTWO\nTHREE\nEXTRA\n4\n5\n6\n7\n8\n9\n10\n11\n12\nTHIRTEEN\n14\n15\n16\n17\n18\n19\n20\n21\n22"),c=0,u=0,p=Math.max(l.a.length,l.b.length),g=[],h=[],f=0,m=0,v=0;v<p;v++){l[v];var b=c<l.a.length?l.a[c]:{type:2,line:""},N=u<l.b.length?l.b[u]:{type:2,line:""};0===b.type&&0!==N.type?(b={type:2,line:""},u++):0===N.type&&0!==b.type?(N={type:2,line:""},c++):(c++,u++),g.push({a:b,b:N}),void 0===r?(r={start:v,end:v},f=0,m=0===b.type&&0===N.type?0:1):0===b.type&&0===N.type?0===m?(r.end=v,f++):1===m?(r.end=v,m=2,f=0):2===m&&(r.end=v,8===++f&&(r.end-=5,h.push(r),r={start:v-5,end:v-5},m=0,f=0)):(r.end=v,f++,0===m?(r.end>3&&(r.end-=3,r.empty=!0,h.push(r),r={start:v-3,end:v-3}),m=1):2===m&&(m=1))}0===m&&(r.empty=!0),r.end=p,h.push(r),console.table(h);for(var y=0;y<h.length;y++)if((r=h[y]).empty)i(r.start,r.end,g).appendTo(s);else for(v=r.start;v<r.end;v++){var C=a(g[v]).appendTo(s);v===r.start?C.addClass("start-block"):v===r.end-1&&C.addClass("end-block")}},close:function(){diffVisible=!1},show:function(){}});RED.tray.show(n)})),XAPP.actions.add("core:toggle-toolbar-edit",(function(){console.log("treeNodes.actions.getSelectedNodeId :",treeNodes.actions.getSelectedNodeId());var e={},t=treeNodes.actions.getSelectedNodeId(),n=RED.nodes.node(t);n&&(e.id=n.id,e.width=n.width,e.height=n.height,e.widget=[],RED.nodes.eachNode((function(t){t.parentid===e.id&&e.widget.push({id:t.id,name:t.name,width:t.width,height:t.height,x:t.x,y:t.y})}))),console.log("Report :",e);var o={filename:"./node.pdf",options:{format:"A4",orientation:"portrait",paginationOffset:1,border:"0",header:{height:"10mm",contents:'<div style="text-align: center;">Author: Marc Bachmann</div>'},footer:{height:"10mm",contents:'<div style="text-align: center;">Author: Marc Bachmann</div>'},type:"pdf",quality:"75",base:"./template",httpHeaders:{Authorization:"Bearer ACEFAD8C-4B4D-4042-AB30-6C735F5BAC8B"},childProcessOptions:{detached:!0},renderDelay:1e3,httpCookies:[{name:"Valid-Cookie-Name",value:"Valid-Cookie-Value",domain:"localhost",path:"/foo",httponly:!0,secure:!1,expires:(new Date).getTime()+36e5}]},payload:'<div class="profile_info">\n                                <span>Welcome,</span>\n                                <h2>John Doe</h2>\n                            </div>'};console.log("msg.payload  :",o.payload),$.ajax({method:"POST",xhrFields:{responseType:"blob"},contentType:"application/json",url:"GenPDF",data:JSON.stringify(e),success:function(e){var t=new Blob([e]),n=window.webkitURL.createObjectURL(t),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","report.pdf"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)},error:function(e,t,n){RED.notify("Problme d'ecriture")}})})),XAPP.actions.add("core:toggle-toolbar-trash",(function(){var e=$("#system-main-container");e.empty();var t=$('<div class="red-ui-editableList-panel">').appendTo(e),n=($('<div class="red-ui-panel-headers">\n                                       <div>Breifing</div>\n                                       <div>Date</div>\n                                       <div>From</div>\n                                       <div>To</div>\n                                       <div>Duree</div>\n                                       <div>status</div>\n                                    </div>').appendTo(t),$('<div class="red-ui-editableList">').appendTo(t)),o=$('<div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;">').appendTo(n),a=$('<ol class="red-ui-list">').appendTo(o);a.editableList({addButton:!1,height:"auto",scrollOnAdd:!1,addItem:function(e,t,n){var o=$("<div>",{class:"red-ui-list-flow"}).appendTo(e);o.addClass("collapsed");var a=$("<div>",{class:"red-ui-list-flow-title"}).appendTo(o),i=$("<div>").appendTo(o),d=$("<div>",{class:"red-ui-list-node-cell"}).appendTo(a);$("<div>",{class:"red-ui-list-node-cell red-ui-list-node-local"}).appendTo(a),$("<div>",{class:"red-ui-list-node-cell red-ui-list-node-remote"}).appendTo(a),$("<div>",{class:"red-ui-list-node-cell red-ui-list-node-remote"}).appendTo(a),$("<div>",{class:"red-ui-list-node-cell red-ui-list-node-remote"}).appendTo(a),$("<div>",{class:"red-ui-list-node-cell red-ui-list-node-remote"}).appendTo(a),$("<div>",{class:"red-ui-list-node-cell red-ui-list-node-remote"}).appendTo(a);$('<span class="red-ui-list-chevron"><i class="fa fa-angle-down"></i></span>').appendTo(d);var r=$("<div>",{class:"red-ui-list-node collapsed"}).appendTo(i),s=$("<div>",{class:"red-ui-list-node-header"}).appendTo(r),l=$("<div>",{class:"red-ui-list-node-cell"}).appendTo(s),c=$("<div>",{class:""}).appendTo(s);$("<div>",{class:""}).appendTo(s),$("<div>",{class:""}).appendTo(s),$("<div>",{class:""}).appendTo(s),$("<div>",{class:""}).appendTo(s);$("<div>",{class:""}).appendTo(s).addClass("red-ui-empty"),c.addClass("red-ui-empty"),$('<span class="red-ui-list-chevron"><i class="fa fa-angle-down"></i></span>').appendTo(l),$("<span>").text(RED._("diff.flowProperties")).appendTo(l),s.on("click",(function(e){var t;e.preventDefault(),$(this).parent().toggleClass("collapsed"),0===$(this).siblings(".red-ui-list-node-properties").length&&(t=$("<div>",{class:"red-ui-list-node-properties"}),$('\n                            <div class="red-ui-list-node-properties-container">\n                                <div>id</div>\n                                <div>1</div>\n                                <div>2</div>\n                                <div>3</div>\n                                <div>4</div>\n                                <div>5</div>\n                                <div>6</div>\n                            </div>\n                            ').appendTo(t),$('\n                            <div class="red-ui-list-node-properties-container">\n                                <div>id</div>\n                                <div>1</div>\n                                <div>2</div>\n                                <div>3</div>\n                                <div>4</div>\n                                <div>5</div>\n                                <div>6</div>\n                            </div>\n                            ').appendTo(t),t).appendTo(r)})),a.on("click",(function(e){a.parent().toggleClass("collapsed"),$(this).parent().hasClass("collapsed")&&($(this).parent().find(".red-ui-list-node").addClass("collapsed"),$(this).parent().find(".red-ui-debug-msg-element").addClass("collapsed"))}))}});var i={def:{category:"config",color:"#f0f0f0"},tab:{n:{}},newTab:{n:{}}};a.editableList("addItem",i),a.editableList("addItem",i),a.editableList("addItem",i),a.editableList("addItem",i)})),XAPP.actions.add("core:toggle-toolbar-checkin",(function(){console.log('console.log("core:toggle-toolbar-checkin")  hhh')})),XAPP.actions.add("core:toggle-toolbar-default",(function(){console.log("core:toggle-toolbar-default")})),XAPP.actions.add("core:toggle-toolbar-refresh",(function(){console.log("Gen Data"),$.ajax({method:"POST",contentType:"application/json",url:"/insertdates/",data:JSON.stringify({}),success:function(e){RED.notify(RED._("inject tags.success"))},error:function(e,t,n){}})})),XAPP.actions.add("core:toggle-toolbar-publish",(function(){console.log("core:toggle-toolbar-publish")})),XAPP.actions.add("core:toggle-toolbar-unpublish",(function(){console.log("core:toggle-toolbar-unpublish")})),XAPP.actions.add("core:toggle-toolbar-options",(function(){console.log("core:toggle-toolbar-options")})),XAPP.actions.add("core:toggle-toolbar-help",(function(){console.log("core:toggle-toolbar-help")})),function(e,n){for(var o=0;o<n.length;o++){var a=t(n[o]);a&&e.append(a)}}(n,e)}return{init:function(e){$('\n                                    \x3c!-- Subheader --\x3e\n                                    <div class="j-subhead hidden-tablet hidden-phone">\n                                        <div class="j-container-fluid">\n                                            <div id="container-collapse" class="container-collapse"></div>\n                                            <div class="j-row-fluid">\n                                                <div class="span12">\n                                                    \x3c!-- target for skip to content link --\x3e\n                                                    <a id="skiptarget" class="element-invisible">Main content begins here</a>\n                                                    <div class="j-btn-toolbar" role="toolbar" aria-label="Toolbar" id="j-toolbar">\n                                                        <div id="toolbar-deploy" class="j-btn-wrapper"></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="header-control-down"><i class="fa fa-chevron-down"></i></div>\n                                    </div>\n                                    \x3c!-- End Subheader --\x3e\n                                ').appendTo(e.target),RED.deploy.init(RED.settings.theme("deployButton",null)),n()}}}(),XAPP.status=function(){function e(e,t){callback=XAPP.actions.get(e),callback?callback.call(e,t):console.log("No callback for",e,opt.onselect)}return{init:function(t){$('\n                                    \x3c!-- Status Module --\x3e\n                                    <div id="j-status" class="j-navbar j-navbar-fixed-bottom hidden-phone">\n                                        <div class="j-btn-toolbar">\n                                            <div class="j-btn-group pull-right">\n                                                <p>\n                                                    XAPP ! 4.0.2 &nbsp;&nbsp;  2024 Siemens S7\n                                                </p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \x3c!-- Status Module --\x3e\n                                ').appendTo(t.target),function(){var t=[],n=$("#j-status");t.push({id:"status-item-connections",label:"Connections",display:!0,link:!1,value:0,icon:"badge",class:"badge"}),t.push({id:"status-item-nodes",label:"Nodes",display:!0,link:!1,value:0,icon:"badge",class:"badge"}),t.push({id:"status-item-messages",label:"Messages",display:!0,link:!1,value:2,icon:"badge",class:"badge",onselect:"core:toggle-messages"}),t.push({id:"status-item-logout",label:"Log out",display:!0,link:!0,icon:"j-icon-minus-2",class:"j-icon-minus-2",onselect:"core:user-log-out"});for(var o=$('<div class="j-btn-toolbar"></div>'),a=0;a<t.length;a++){var i=t[a];if(i.link)d=$('<div class="j-btn-group"><a href="#"><span id="'+i.id+'" class="'+i.class+'">'+(i.value?i.value:"")+"</span>"+i.label+'</a><span class="j-btn-group separator"></span></div>').appendTo(o),i.onselect&&d.on("click",(function(t){t.preventDefault(),e(i.onselect)}));else var d=$('<div class="j-btn-group"><span id="'+i.id+'" class="'+i.class+'">'+i.value+"</span>"+i.label+'<span class="j-btn-group separator"></span></div>').appendTo(o)}n.append(o)}()}}}(),XAPP.dialog=function(){var e,t,n,o,a,i,d,r;function s(e,t){for(var n={},o=0;o<e.length;o++){var a=e[o];switch(a.type){case"s7.config":n={id:a.id,type:a.type,name:a.name,topic:a.topic,ip:a.ip,port:a.port,rack:a.rack,slot:a.slot,cycletime:a.cycletime,timeout:a.timeout,verbose:a.verbose,class:"icon-connection",users:[],payload:{}};break;case"s7.group":n={id:a.id,type:a.type,connection:a.connection,name:a.name,topic:a.topic,class:"icon-group",users:[]};break;case"s7.io":var i;a.id?i=a.id:(i=RED.nodes.id(),console.log("ID :",i)),e[o].id=i,n={id:i,type:a.type,z:t,connection:a.connection,name:a.name,payload:a.payload,group:a.group,topic:a.topic,none:a.none,repeat:a.repeat,db:a.db,operation:a.operation,dbnone:a.dbnone,dbrepeat:a.dbrepeat,once:a.once,maxvalue:a.maxvalue,color:a.color,unit:a.unit,class:"icon-tag",x:0,y:0};break;default:n={}}n._def=RED.nodes.getType(n.type),RED.nodes.add(n),RED.nodes.dirty(!0),a.children&&a.children.length>0&&s(a.children,t)}}function l(){e=$('<div id="red-ui-dialog" class="hide"><form class="dialog-form form-horizontal"></form></div>').appendTo("#red-ui-editor").dialog({modal:!0,autoOpen:!1,width:700,resizable:!1,classes:{"ui-dialog":"red-ui-editor-dialog","ui-dialog-titlebar-close":"hide","ui-widget-overlay":"red-ui-editor-dialog"},buttons:[{id:"red-ui-dialog-cancel",text:RED._("common.label.cancel"),click:function(){$(this).dialog("close")}},{id:"red-ui-dialog-download",class:"primary",text:RED._("clipboard.download"),click:function(){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent($("#red-ui-dialog-export-text").val())),e.setAttribute("download","Config.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),$(this).dialog("close")}},{id:"red-ui-dialog-ok",class:"primary",text:RED._("common.label.import"),click:function(){var e=$("#red-ui-dialog-import-text").val().trim(),t=JSON.parse(e);s(t,XAPP.treelist.actions.getWorkspaceId());var n=XAPP.treelist.tree();n.addNodes(n.getSelectedNodes()[0],t),$(this).dialog("close")}}],close:function(e){a&&(a.close(!0),i=null)}}),t=e.children(".dialog-form"),n='<div class="red-ui-clipboard-dialog-box">\n                                <div id="red-ui-dialog-export-tab-clipboard" class="red-ui-clipboard-dialog-tab-clipboard">\n                                    <div class="form-row">\n                                        <textarea readonly id="red-ui-dialog-export-text"></textarea>\n                                    </div>\n                                    <div class="form-row" style="text-align: right;">\n                                        <span id="red-ui-dialog-export-fmt-group" class="button-group">\n                                            <a id="red-ui-dialog-export-fmt-mini" class="red-ui-button red-ui-button-small toggle" href="#" data-i18n="clipboard.export.compact"></a>\n                                            <a id="red-ui-dialog-export-fmt-full" class="red-ui-button red-ui-button-small toggle" href="#" data-i18n="clipboard.export.formatted"></a>\n                                        </span>\n                                    </div>\n                                </div>\n                        </div>',o='<div class="red-ui-clipboard-dialog-box" style="margin-bottom: 12px;">\n                <div id="red-ui-dialog-import-tab-clipboard" class="red-ui-clipboard-dialog-tab-clipboard">\n                    <div class="form-row">\n                        <span data-i18n="clipboard.pasteNodes"></span>\n                        <a class="red-ui-button" id="red-ui-dialog-import-file-upload-btn"><i class="fa fa-upload"></i> <span data-i18n="clipboard.selectFile"></span></a>\n                        <input type="file" id="red-ui-dialog-import-file-upload" accept=".json" style="display: none;" />\n                    </div>\n                    <div class="form-row">\n                        <textarea id="red-ui-dialog-import-text"></textarea>\n                    </div>\n                </div>\n            </div>'}function c(){d&&clearTimeout(d),d=setTimeout((function(){var e=$("#red-ui-dialog-tab-library-name"),t=e.val().trim();t.length>0&&!/[\/\\]/.test(t)?(e.removeClass("input-error"),$("#red-ui-dialog-export").button("enable")):(e.addClass("input-error"),$("#red-ui-dialog-export").button("disable"))}),100)}function u(){r&&clearTimeout(r),r=setTimeout((function(){var e=$("#red-ui-dialog-import-text"),t=e.val().trim();if(""===t)return a.close(!0),i=null,e.removeClass("input-error"),void $("#red-ui-dialog-ok").button("disable");try{if(!/^\[[\s\S]*\]$/m.test(t))throw new Error(RED._("clipboard.import.errors.notArray"));for(var n=JSON.parse(t),o=0;o<n.length;o++)if("object"!=typeof n[o])throw new Error(RED._("clipboard.import.errors.itemNotObject",{index:o}));i=null,a.close(!0),e.removeClass("input-error"),e.val(t),$("#red-ui-dialog-ok").button("enable")}catch(n){if(""!==t){e.addClass("input-error");var d=n.toString();if(d!==i){var r,s=$('<div class="red-ui-clipboard-import-error"></div>').text(d),l=/at position (\d+)/i.exec(d);if(l)r=parseInt(l[1]);else if(l=/at line (\d+) column (\d+)/i.exec(d)){var c=parseInt(l[1])-1,u=parseInt(l[2])-1,p=t.split("\n");r=0;for(o=0;o<c;o++)r+=p[o].length+1;r+=u}if(void 0!==r){t=t.replace(/\n/g,"");parseInt(l[1]);var g=$("<div>").appendTo(s),h=$("<pre>").appendTo(g);$("<span>").text(t.substring(r-12,r)).appendTo(h),$('<span class="error">').text(t.charAt(r)).appendTo(h),$("<span>").text(t.substring(r+1,r+12)).appendTo(h)}a.close(!0).setContent(s).open(),i=d}}else i=null;$("#red-ui-dialog-ok").button("disable")}}),100)}function p(e){for(var t={},n=[],o=0;o<e.length;o++){var a=e[o];if(RED.nodes.node(a.id)){var i=RED.nodes.node(a.id);switch(i.type){case"s7.config":t={id:i.id,type:i.type,name:i.name,topic:i.topic,ip:i.ip,port:i.port,rack:i.rack,slot:i.slot,cycletime:i.cycletime,timeout:i.timeout,verbose:i.verbose,class:"icon-connection"};break;case"s7.group":t={id:i.id,type:i.type,connection:i.connection,name:i.name,topic:i.topic,class:"icon-group"};break;case"s7.io":t={id:i.id,type:i.type,z:i.z,connection:i.connection,name:i.name,payload:i.payload,group:i.group,topic:i.topic,none:i.none,repeat:i.repeat,db:i.db,operation:i.operation,dbnone:i.dbnone,dbrepeat:i.dbrepeat,once:i.once,maxvalue:i.maxvalue,color:i.color,unit:i.unit,class:"icon-tag"};break;default:t={}}a.children&&a.children.length>0&&(console.log("With Children",a.children),t.children=p(a.children))}n.push(t)}return n}return{init:function(){l()},import:function(n){n=n||"clipboard",t.empty(),t.append($(o)),$("#red-ui-dialog-ok").show(),$("#red-ui-dialog-cancel").show(),$("#red-ui-dialog-download").hide(),$("#red-ui-dialog-ok").button("disable"),t.i18n(),$("#red-ui-dialog-import-text").on("keyup",u),$("#red-ui-dialog-import-text").on("paste",(function(){setTimeout(u,10)})),$("#red-ui-dialog-import-file-upload").on("change",(function(){var e=new FileReader;e.onload=function(){$("#red-ui-dialog-import-text").val(e.result),u()},e.readAsText($(this).prop("files")[0])})),$("#red-ui-dialog-import-file-upload-btn").on("click",(function(e){e.preventDefault(),$("#red-ui-dialog-import-file-upload").trigger("click")})),setTimeout((function(){$("#red-ui-dialog-import-text").trigger("focus")}),100),e.dialog("option","title",RED._("clipboard.importNodes")).dialog("open"),a=RED.popover.create({target:$("#red-ui-dialog-import-text"),trigger:"manual",direction:"bottom",content:""})},export:function(o){t.empty(),t.append($(n)),$("#red-ui-dialog-tab-library-name").on("keyup",c),$("#red-ui-dialog-tab-library-name").on("paste",(function(){setTimeout(c,10)})),$("#red-ui-dialog-export").button("enable"),$("#red-ui-dialog-tab-library-name").val("flows.json").select(),t.i18n();var a,i=RED.settings.flowFilePretty?"red-ui-dialog-export-fmt-full":"red-ui-dialog-export-fmt-mini";a=p(o.getSelectedNodes()),i=$(this).attr("id"),flow="red-ui-dialog-export-fmt-full"===i?JSON.stringify(a,null,4):JSON.stringify(a),$("#red-ui-dialog-export-text").val(flow),setTimeout((function(){$("#red-ui-dialog-export-text").scrollTop(0)}),50),$("#red-ui-dialog-export-text").trigger("focus"),$("#red-ui-dialog-export-fmt-group > a").on("click",(function(e){if(e.preventDefault(),$(this).hasClass("disabled")||$(this).hasClass("selected"))$("#red-ui-dialog-export-text").trigger("focus");else{$(this).parent().children().removeClass("selected"),$(this).addClass("selected");var t=$("#red-ui-dialog-export-text").val();if(t.length>0){var n=JSON.parse(t);t="red-ui-dialog-export-fmt-full"===(i=$(this).attr("id"))?JSON.stringify(n,null,4):JSON.stringify(n),$("#red-ui-dialog-export-text").val(t),setTimeout((function(){$("#red-ui-dialog-export-text").scrollTop(0)}),50),$("#red-ui-dialog-export-text").trigger("focus")}}})),$("#red-ui-dialog-export-rng-group > a").on("click",(function(e){if(e.preventDefault(),!$(this).hasClass("disabled")&&!$(this).hasClass("selected")){$(this).parent().children().removeClass("selected"),$(this).addClass("selected");var t=$(this).attr("id"),n="",o=null;if("red-ui-dialog-export-rng-selected"===t){var a=RED.workspaces.selection();a.length>0?(o=[],a.forEach((function(e){o.push(e),o=o.concat(RED.nodes.filterNodes({z:e.id}))}))):o=RED.view.selection().nodes||[]}else if("red-ui-dialog-export-rng-flow"===t){var d=RED.workspaces.active();o=RED.nodes.filterNodes({z:d});var r=RED.nodes.workspace(d)||RED.nodes.subflow(d);o.unshift(r)}else"red-ui-dialog-export-rng-full"===t&&(o=RED.nodes.createCompleteNodeSet(!1));null!==o&&(n="red-ui-dialog-export-fmt-full"===i?JSON.stringify(o,null,4):JSON.stringify(o)),n.length>0?$("#red-ui-dialog-export").removeClass("disabled"):$("#red-ui-dialog-export").addClass("disabled"),$("#red-ui-dialog-export-text").val(n),setTimeout((function(){$("#red-ui-dialog-export-text").scrollTop(0)}),50),$("#red-ui-dialog-export-text").trigger("focus")}})),$("#red-ui-dialog-ok").hide(),$("#red-ui-dialog-cancel").hide(),$("#red-ui-dialog-download").hide();var d=RED.workspaces.selection();d.length>0||(d=RED.view.selection()).nodes?$("#red-ui-dialog-export-rng-selected").trigger("click"):($("#red-ui-dialog-export-rng-selected").addClass("disabled").removeClass("selected"),$("#red-ui-dialog-export-rng-flow").trigger("click")),"red-ui-dialog-export-fmt-full"===i?$("#red-ui-dialog-export-fmt-full").trigger("click"):$("#red-ui-dialog-export-fmt-mini").trigger("click"),e.dialog("option","title",RED._("clipboard.exportNodes")).dialog("open"),$("#red-ui-dialog-export-text").trigger("focus"),$("#red-ui-dialog-cancel").show(),$("#red-ui-dialog-download").show()}}}(),XAPP.view={redrawStatus:function(e){var t={color:{red:"#c00",green:"#32CD32",yellow:"#F9DF31",blue:"#53A3F3",grey:"#d3d3d3"},text:{connected:"success",connecting:"success","missing configuration":"warning",error:"important",unknown:"important",disconnected:"warning"},icon:{connected:"check-circle",connecting:"check","missing configuration":"warning",error:"times-circle",unknown:"close",disconnected:"bolt"}};e._def.onredrawnode&&e._def.onredrawnode.call(e);var n,o=e.id.replace(".","-");(n=$(`.${o}_icon`)).length>0&&n.each((function(n,o){$(this).is("span")&&$(this).css("color",t.color[e.status.fill])}))}},XAPP.demo={start:function(){setInterval((function(){}),2e3)}};var CardWidget=function(e){var t="CardWidget",n="lte.cardwidget",o="."+n,a=e.fn[t],i={EXPANDED:"expanded"+o,COLLAPSED:"collapsed"+o,MAXIMIZED:"maximized"+o,MINIMIZED:"minimized"+o,REMOVED:"removed"+o},d="card",r="collapsed-card",s="collapsing-card",l="expanding-card",c="was-collapsed",u="maximized-card",p={DATA_REMOVE:'[data-card-widget="remove"]',DATA_COLLAPSE:'[data-card-widget="collapse"]',DATA_MAXIMIZE:'[data-card-widget="maximize"]',CARD:"."+d,CARD_HEADER:".card-header",CARD_BODY:".card-body",CARD_FOOTER:".card-footer",COLLAPSED:"."+r},g={animationSpeed:"normal",collapseTrigger:p.DATA_COLLAPSE,removeTrigger:p.DATA_REMOVE,maximizeTrigger:p.DATA_MAXIMIZE,collapseIcon:"fa-minus",expandIcon:"fa-plus",maximizeIcon:"fa-expand",minimizeIcon:"fa-compress"},h=function(){function t(t,n){this._element=t,this._parent=t.parents(p.CARD).first(),t.hasClass(d)&&(this._parent=t),this._settings=e.extend({},g,n)}var o=t.prototype;return o.collapse=function(){var t=this;this._parent.addClass(s).children(p.CARD_BODY+", "+p.CARD_FOOTER).slideUp(this._settings.animationSpeed,(function(){t._parent.addClass(r).removeClass(s)})),this._parent.find("> "+p.CARD_HEADER+" "+this._settings.collapseTrigger+" ."+this._settings.collapseIcon).addClass(this._settings.expandIcon).removeClass(this._settings.collapseIcon);var n=e.Event(i.COLLAPSED);this._element.trigger(n,this._parent)},o.expand=function(){var t=this;this._parent.addClass(l).children(p.CARD_BODY+", "+p.CARD_FOOTER).slideDown(this._settings.animationSpeed,(function(){t._parent.removeClass(r).removeClass(l)})),this._parent.find("> "+p.CARD_HEADER+" "+this._settings.collapseTrigger+" ."+this._settings.expandIcon).addClass(this._settings.collapseIcon).removeClass(this._settings.expandIcon);var n=e.Event(i.EXPANDED);this._element.trigger(n,this._parent)},o.remove=function(){this._parent.slideUp();var t=e.Event(i.REMOVED);this._element.trigger(t,this._parent)},o.toggle=function(){this._parent.hasClass(r)?this.expand():this.collapse()},o.maximize=function(){this._parent.find(this._settings.maximizeTrigger+" ."+this._settings.maximizeIcon).addClass(this._settings.minimizeIcon).removeClass(this._settings.maximizeIcon),this._parent.css({height:this._parent.height(),width:this._parent.width(),transition:"all .15s"}).delay(150).queue((function(){e(this).addClass(u),e("html").addClass(u),e(this).hasClass(r)&&e(this).addClass(c),e(this).dequeue()}));var t=e.Event(i.MAXIMIZED);this._element.trigger(t,this._parent)},o.minimize=function(){this._parent.find(this._settings.maximizeTrigger+" ."+this._settings.minimizeIcon).addClass(this._settings.maximizeIcon).removeClass(this._settings.minimizeIcon),this._parent.css("cssText","height:"+this._parent[0].style.height+" !important;width:"+this._parent[0].style.width+" !important; transition: all .15s;").delay(10).queue((function(){e(this).removeClass(u),e("html").removeClass(u),e(this).css({height:"inherit",width:"inherit"}),e(this).hasClass(c)&&e(this).removeClass(c),e(this).dequeue()}));var t=e.Event(i.MINIMIZED);this._element.trigger(t,this._parent)},o.toggleMaximize=function(){this._parent.hasClass(u)?this.minimize():this.maximize()},o._init=function(t){var n=this;this._parent=t,e(this).find(this._settings.collapseTrigger).click((function(){n.toggle()})),e(this).find(this._settings.maximizeTrigger).click((function(){n.toggleMaximize()})),e(this).find(this._settings.removeTrigger).click((function(){n.remove()}))},t._jQueryInterface=function(o){var a=e(this).data(n),i=e.extend({},g,e(this).data());a||(a=new t(e(this),i),e(this).data(n,"string"==typeof o?a:o)),"string"==typeof o&&o.match(/collapse|expand|remove|toggle|maximize|minimize|toggleMaximize/)?a[o]():"object"==typeof o&&a._init(e(this))},t}();return e(document).on("click",p.DATA_COLLAPSE,(function(t){t&&t.preventDefault(),h._jQueryInterface.call(e(this),"toggle")})),e(document).on("click",p.DATA_REMOVE,(function(t){t&&t.preventDefault(),h._jQueryInterface.call(e(this),"remove")})),e(document).on("click",p.DATA_MAXIMIZE,(function(t){t&&t.preventDefault(),h._jQueryInterface.call(e(this),"toggleMaximize")})),e.fn[t]=h._jQueryInterface,e.fn[t].Constructor=h,e.fn[t].noConflict=function(){return e.fn[t]=a,h._jQueryInterface},h}(jQuery),CardRefresh=function(e){var t="CardRefresh",n="lte.cardrefresh",o="."+n,a=e.fn[t],i={LOADED:"loaded"+o,OVERLAY_ADDED:"overlay.added"+o,OVERLAY_REMOVED:"overlay.removed"+o},d="card",r={CARD:"."+d,DATA_REFRESH:'[data-card-widget="card-refresh"]'},s={source:"",sourceSelector:"",params:{},trigger:r.DATA_REFRESH,content:".card-body",loadInContent:!0,loadOnInit:!0,responseType:"",overlayTemplate:'<div class="overlay"><i class="fas fa-2x fa-sync-alt fa-spin"></i></div>',onLoadStart:function(){},onLoadDone:function(e){return e}},l=function(){function t(t,n){if(this._element=t,this._parent=t.parents(r.CARD).first(),this._settings=e.extend({},s,n),this._overlay=e(this._settings.overlayTemplate),t.hasClass(d)&&(this._parent=t),""===this._settings.source)throw new Error("Source url was not defined. Please specify a url in your CardRefresh source option.");this._init(),this._settings.loadOnInit&&this.load()}var o=t.prototype;return o.load=function(){this._addOverlay(),this._settings.onLoadStart.call(e(this)),e.get(this._settings.source,this._settings.params,function(t){this._settings.loadInContent&&(""!=this._settings.sourceSelector&&(t=e(t).find(this._settings.sourceSelector).html()),this._parent.find(this._settings.content).html(t)),this._settings.onLoadDone.call(e(this),t),this._removeOverlay()}.bind(this),""!==this._settings.responseType&&this._settings.responseType);var t=e.Event(i.LOADED);e(this._element).trigger(t)},o._addOverlay=function(){this._parent.append(this._overlay);var t=e.Event(i.OVERLAY_ADDED);e(this._element).trigger(t)},o._removeOverlay=function(){this._parent.find(this._overlay).remove();var t=e.Event(i.OVERLAY_REMOVED);e(this._element).trigger(t)},o._init=function(t){var n=this;e(this).find(this._settings.trigger).on("click",(function(){n.load()}))},t._jQueryInterface=function(o){var a=e(this).data(n),i=e.extend({},s,e(this).data());a||(a=new t(e(this),i),e(this).data(n,"string"==typeof o?a:o)),"string"==typeof o&&o.match(/load/)?a[o]():"object"==typeof o&&a._init(e(this))},t}();return e(document).on("click",r.DATA_REFRESH,(function(t){t&&t.preventDefault(),l._jQueryInterface.call(e(this),"load")})),e.fn[t]=l._jQueryInterface,e.fn[t].Constructor=l,e.fn[t].noConflict=function(){return e.fn[t]=a,l._jQueryInterface},l}(jQuery),ElementSizer=function(e){e.widget("nodereddashboard.elementSizerByNum",{_create:function(){var t=this,n=this.options.has_height,o=this.options.pos,a=n?"15%":"6%",i=e("<div>").css({position:"absolute",background:"white",padding:"10px 10px 10px 10px",border:"1px solid grey",zIndex:"20",borderRadius:"4px",display:"none",width:a}).appendTo(document.body),d=e("<div>").css({fontSize:"13px",color:"#aaa",float:"left",paddingTop:"1px"}).appendTo(i),r=e(this.options.width).val(),s=n?e(this.options.height).val():void 0,l="",c=this.options.groupNode;c&&(l='max="'+c.width+'"'),r=r>0?r:1,s=s>0?s:1;var u,p=e('<input type="number" min="1" '+l+">").css("width",n?"45%":"100%").val(r).appendTo(d);if(n){e("<span>").text(" x ").appendTo(d);var g=e('<input type="number" min="1">').css("width","45%").val(s).appendTo(d)}var h=function(){var o=p.val(),a=n?g.val():void 0;t.options.label.text(o+(n?" x "+a:"")),e(t.options.width).val(o).change(),n&&e(t.options.height).val(a).change(),t.destroy()};i.keypress((function(e){13===e.which&&i.fadeOut(100,h)})),i.on("mouseleave",(function(e){u=setTimeout((function(){i.fadeOut(200,h)}),100)})),i.on("mouseenter",(function(e){clearTimeout(u)})),i.css({top:o.top-10+"px",left:o.left+10+"px"}),i.fadeIn(200)}}),e.widget("nodereddashboard.elementSizer",{_create:function(){var t=this,n=6,o=parseInt(e(this.options.width).val()||0),a=parseInt(this.options.hasOwnProperty("height")?e(this.options.height).val():"1")||0,i=!this.options.hasOwnProperty("auto")||this.options.auto;this.element.css({minWidth:this.element.height()+4});var d="auto",r=0===o&&0===a?d:o+(this.options.hasOwnProperty("height")?" x "+a:"");this.element.text(r).on("mousedown",(function(o){o.stopPropagation(),o.preventDefault();var a,r=parseInt(e(t.options.width).val()||0),s=parseInt(t.options.hasOwnProperty("height")?e(t.options.height).val():"1")||0,l=0,c=!1,u=!1,p=e(t.options.group).val();if(p){var g=RED.nodes.node(p);g&&(n=Math.max(6,g.width,+r),l=g.width||n,c=!0),a=Math.max(6,+s+1)}else n=Math.max(12,+r),l=t.options.maxWidth,a=t.options.maxHeight,u=t.options.fixedHeight,c=t.options.fixedWidth;var h,f=e(this).offset(),m=e("<div>").css({position:"absolute",background:"white",padding:"5px 10px 10px 10px",border:"1px solid grey",zIndex:"20",borderRadius:"4px",display:"none"}).appendTo(document.body);m.on("mouseleave",(function(t){h=setTimeout((function(){m.fadeOut(200,(function(){e(this).remove()}))}),100)})),m.on("mouseenter",(function(){clearTimeout(h)}));var v=e("<div>").css({fontSize:"13px",color:"#aaa",float:"left",paddingTop:"1px"}).appendTo(m).text(0===r&&0===s?d:r+(t.options.hasOwnProperty("height")?" x "+s:""));v.hover((function(){e(this).css("text-decoration","underline")}),(function(){e(this).css("text-decoration","none")})),v.click((function(n){var o=e(t.options.group).val(),a=null;o&&null===(a=RED.nodes.node(o))||(e(t).elementSizerByNum({width:t.options.width,height:t.options.height,groupNode:a,pos:f,label:t.element,has_height:t.options.hasOwnProperty("height")}),h=setTimeout((function(){m.fadeOut(200,(function(){e(this).remove()}))}),100))}));var b=e("<div>",{style:"text-align:right; height:25px;"}).appendTo(m);if(i)e("<a>",{href:"#",class:"editor-button editor-button-small",style:"margin-bottom:5px"}).text(d).appendTo(b).on("mouseup",(function(n){t.element.text(d),e(t.options.width).val(0).change(),e(t.options.height).val(0).change(),n.preventDefault(),m.fadeOut(200,(function(){e(this).remove()}))}));var N="1px dashed lightGray",y="1px solid gray",C="1px dashed black",k=[];function w(t){var o=e("<div>").css({padding:0,margin:0,height:"25px","box-sizing":"border-box"}).appendTo(m);k.push(o),E.push([]);for(var a=0;a<n;a++)T(t,a)}function T(o,i){var d=k[o],p=e("<div>").css({display:"inline-block",width:"25px",height:"25px",borderRight:i===r-1&&o<s?y:N,borderBottom:o===s-1&&i<r?y:N,boxSizing:"border-box",cursor:"pointer",background:i<l?"#fff":"#eee"}).appendTo(d);E[o].push(p),0===i&&p.css({borderLeft:o<=s-1?y:N}),0===o&&p.css({borderTop:i<=r-1?y:N}),i<l&&(p.data("w",i),p.data("h",o),p.on("mouseup",(function(){t.element.text(e(this).data("w")+1+(t.options.hasOwnProperty("height")?" x "+(e(this).data("h")+1):"")),e(t.options.width).val(e(this).data("w")+1).change(),e(t.options.height).val(e(this).data("h")+1).change(),m.fadeOut(200,(function(){e(this).remove()}))})),p.on("mouseover",(function(){var o=e(this).data("w"),i=e(this).data("h");v.text(o+1+(t.options.hasOwnProperty("height")?" x "+(i+1):""));for(var d=0;d<a;d++)for(var p=0;p<l;p++)E[d][p].css({background:d<=i&&p<=o?"#ddd":"#fff",borderLeft:0===p&&d<=i?C:0===p?d<=s-1?y:N:"",borderTop:0===d&&p<=o?C:0===d?p<=r-1?y:N:"",borderRight:p===o&&d<=i?C:p===r-1&&d<=s-1?y:N,borderBottom:d===i&&p<=o?C:d===s-1&&p<=r-1?y:N});if(u||i!==a-1||w(a++),!c&&o===l-1){l++,n++;for(var g=0;g<a;g++)T(g,l-1)}})))}for(var E=[],I=0;I<a;I++)w(I);m.css({top:f.top+"px",left:f.left+"px"}),m.fadeIn(200)}))}})}(jQuery);